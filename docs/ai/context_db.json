{
  "backlog": [],
  "current_state": {
    "notes": [
      "PlacesHeroV2 compile and tests passing after last hotfix.",
      "iOS app icon visibility remains a backlog item."
    ],
    "status": "green"
  },
  "decisions": [],
  "design_system": {
    "notes": [
      "Audit text styles across pages for contrast and hierarchy."
    ],
    "theme": "Dracula-inspired"
  },
  "file_map": {
    "context_db": "docs/ai/context_db.json",
    "handoff": "docs/ai/handoff/CURRENT_HANDOFF.md",
    "next_prompt": "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
    "places_hero_v2": "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
    "workflow": "docs/ai/reference/WORKFLOW.md"
  },
  "ground_rules": [
    "Every code change must include a docs/ai patch note entry (patch_id, summary, files_changed).",
    "Keep docs/ai small and canonical: avoid duplicate prompts and parallel copies.",
    "Prefer updating existing canonical files over creating new variants."
  ],
  "last_updated": "2025-12-31",
  "patch_log": [
    {
      "id": "patch_2025-12-31_sliceH_hotfix_tests_scroll_scope",
      "date": "2025-12-31",
      "slice": "H",
      "title": "Tests: scope ToolPicker scrollUntilVisible to bottom sheet scrollable",
      "summary": [
        "Updated dashboard tool insertion/removal widget tests to pass an explicit scrollable Finder to scrollUntilVisible().",
        "Scoped scrolling to the modal BottomSheet's Scrollable to avoid 'Too many elements' errors when multiple scrollables exist (dashboard grid + bottom sheet list)."
      ],
      "files_changed": [
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json"
      ],
      "notes": {
        "reason": "ToolPickerSheet now includes additional top content (most recent + search), and the app surface contains multiple scrollables during modal tests.",
        "risk": "Low; test-only behavior change."
      }
    },
    {
      "id": "patch_2025-12-31_sliceC_toolpicker_2level",
      "date": "2025-12-31",
      "slice": "C",
      "title": "ToolPickerSheet: two-level hierarchy (Activity Lenses -> Tools)",
      "summary": [
        "Implemented a collapsible, two-level ToolPickerSheet that lists Activity Lenses first and tools within each lens (ordered per spec).",
        "Added stable keys: lens headers use toolpicker_lens_<lensId>, tool rows use toolpicker_tool_<toolId>.",
        "Introduced ToolRegistry (dedup-first) to encode the canonical lens/tool inventory and ordering, including Quick Tools sections (Favorites placeholder, Recents from session, Odd-but-useful static list).",
        "Aligned Activity Lens IDs to the canonical spec (with backwards-compatible aliases) and updated the Height tile labeling.",
        "Updated widget tests to expand the Home and DIY lens before selecting Area from the picker."
      ],
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/activity_lenses.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_session_controller.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json"
      ],
      "notes": [
        "Slice B (Places Hero polish) remains complete; Slice D (AI docs workflow) is now reflected via this patch log entry.",
        "iOS icon visibility remains backlog-only per constraints."
      ]
    },
    {
      "id": "patch_2025-12-31_sliceF_G_bundle1",
      "date": "2025-12-31",
      "title": "Dashboard tool tiles: toolId-based persistence + Bundle 1 tools",
      "summary": [
        "Introduced generic tool tiles keyed by toolId (DashboardItemKind.tool) and added migration from legacy tool kinds.",
        "Enabled Bundle 1 tools (Distance, Speed, Temperature) end-to-end: tool registry -> picker -> tile -> modal -> history.",
        "Tool picker now prefers direct ToolDefinition lookup by toolId, reducing future work to adding definitions.",
        "Conversion history is now keyed by ToolDefinition.id (separate histories per user-facing tool), while canonicalToolId remains the conversion engine key."
      ],
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/dashboard_board_item.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_layout_controller.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ]
    },
    {
      "id": "patch_2025-12-31_sliceF_G_hotfix_tests",
      "date": "2025-12-31",
      "title": "Test fix: tool modal result/history keys use user-facing tool IDs",
      "summary": [
        "Updated Places Hero V2 widget test expectations to align with toolId-owned result/history keys (baking vs liquids).",
        "Confirmed Liquids and Baking maintain distinct user-facing histories even when sharing a canonical conversion engine."
      ],
      "files_changed": [
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "docs/ai/context_db.json"
      ]
    },
    {
      "id": "patch_2025-12-31_testfix_placeshero_default_tiles",
      "date": "2025-12-31",
      "title": "Test fix: Places Hero V2 default tile assertions (Height/Baking/Liquids/Area)",
      "summary": [
        "Updated Places Hero V2 widget test to assert the current default dashboard tiles (Height, Baking, Liquids, Area) rather than Distance.",
        "Distance remains an enabled tool in the registry but is not part of ToolDefinitions.defaultTiles."
      ],
      "files_changed": [
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "docs/ai/context_db.json"
      ]
    },
    {
      "id": "patch_2025-12-31_sliceH_toolpicker_search_accordion",
      "date": "2025-12-31",
      "title": "Tool picker UX: search, recent shortcut, and single-expanded lens",
      "summary": [
        "Removed the Favorites section from Quick Tools (no pinned/star workflow).",
        "Added a most-recent tool shortcut at the top of the picker plus a search field that filters tool rows.",
        "Changed lens sections to a single-expanded accordion: expanding one lens collapses the others.",
        "Kept stable keys for lens headers and tool rows to preserve persistence and tests."
      ],
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ]
    },
    {
      "id": "patch_2025-12-31_sliceH_hotfix_toolpicker_tests",
      "date": "2025-12-31",
      "slice": "H-hotfix",
      "summary": [
        "Fixed dashboard tool insertion/removal widget tests for the Slice H ToolPicker accordion by scrolling lens headers and tool rows into view before tapping.",
        "Replaced ensureVisible() on tool rows (which requires an already-built element) with scrollUntilVisible() to handle lazily-built list items."
      ],
      "files_changed": [
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart"
      ],
      "notes": {
        "reason": "ToolPicker lens headers and tool rows may be off-screen in tests after adding search + most-recent section and accordion behavior.",
        "risk": "Low; test-only change."
      }
    },
    {
      "id": "patch_2025-12-31_sliceH_hotfix_tests_scroll_scope",
      "date": "2025-12-31",
      "slice": "H-hotfix",
      "title": "Tests: scope ToolPicker scrollUntilVisible to bottom sheet scrollable",
      "summary": [
        "Updated dashboard tool insertion/removal widget tests to pass an explicit scrollable Finder scoped to the modal bottom sheet.",
        "Prevents scrollUntilVisible() from failing when multiple Scrollables exist in the widget tree (dashboard grid + bottom sheet list)."
      ],
      "files_changed": [
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json"
      ]
    }
  ],
  "project": {
    "docs_root": "docs/",
    "name": "Unitana",
    "primary_app_path": "app/unitana/",
    "repo_root": "unitana/",
    "tagline": "travel-first decoder ring; dual reality side-by-side"
  },
  "schema_version": "1.0"
}