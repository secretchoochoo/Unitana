{
  "backlog": [
    {
      "id": "PACK_A_city_data_platform_foundation",
      "title": "Pack A (P0): City data platform foundation (canonical geo/time/currency defaults)",
      "summary": "Design and implement a canonical city dataset model that fully supports product needs: lat/lon, timezone, country, currency, and default units/clock behavior for all in-scope cities. Include schema validation and tooling so missing/invalid records fail early.",
      "notes": [
        "Define canonical schema and ownership: city core fields, country mapping, currency mapping, unit defaults.",
        "Ensure every in-scope city has: lat, lon, timezone ID, country code, currency code, unit defaults, 12/24h default.",
        "Add validation tests/scripts that fail CI for missing required fields.",
        "Produce migration/normalization path for existing city data.",
        "Document schema contract in docs/ai/design_lock and docs/ai/reference."
      ],
      "priority": "P0",
      "size": "XL",
      "status": "done",
      "status_updated": "2026-02-08",
      "status_note": "Canonical city schema, strict validation, parse safety, and dataset tooling are shipped and covered by regression tests."
    },
    {
      "id": "PACK_B_live_data_e2e_weather_time_air",
      "title": "Pack B (P0): Live weather/time/AQI/pollen end-to-end for every city",
      "summary": "Complete and harden the live data pipeline so every city can resolve weather condition, temperature, time, AQI, and pollen data from configured providers with robust fallback and error handling.",
      "notes": [
        "Use Pack A dataset as source of truth for all provider calls and timezone display.",
        "Guarantee non-empty details pill behavior with deterministic fallback when providers fail.",
        "Add reliability instrumentation and cache policy for refresh/update UX.",
        "Add resilient tests for representative global cities and provider failure modes.",
        "Keep mock mode deterministic and aligned with contracts."
      ],
      "priority": "P0",
      "size": "XL",
      "status": "done",
      "status_updated": "2026-02-08",
      "status_note": "Closure-proof contracts now cover representative global weather/time/AQI/pollen success and fallback paths with deterministic tests."
    },
    {
      "id": "PACK_C_live_currency_global",
      "title": "Pack C (P0): Live currency conversion mapped by city/country",
      "summary": "Deliver complete currency conversion coverage by mapping each city to country/currency and wiring live exchange data with stable formatting, caching, and fallback behavior.",
      "notes": [
        "Source currency from canonical city/country mapping (Pack A).",
        "Support global city pairs with deterministic UI formatting rules.",
        "Add cache/refresh behavior and stale-data indicators.",
        "Add tests for high-variance currency pairs and provider outages."
      ],
      "priority": "P0",
      "size": "XL",
      "status": "done",
      "status_updated": "2026-02-08",
      "status_note": "Closure-proof contracts now cover global mapping plus outage/retry/cache preservation across representative multi-currency pairs."
    },
    {
      "id": "PACK_D_docs_repo_text_full_audit",
      "title": "Pack D (P1): Full repository text/docs audit and consolidation",
      "summary": "Audit and modernize all README/AI/docs/text artifacts across the repository for accuracy, consistency, and maintainability; validate Mermaid diagrams and consolidate redundant documentation sources.",
      "notes": [
        "Audit every README.md and text doc for current-product accuracy (not template drift).",
        "Validate and fix Mermaid diagrams so they render on GitHub.",
        "Consolidate overlapping retros/prompts/contracts into canonical sources.",
        "Define docs information architecture and archival strategy.",
        "Update contributor workflow docs for Codex-first operation."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "in_progress",
      "status_updated": "2026-02-08",
      "status_note": "XL Unit 2 started docs consolidation and backlog/prompt alignment; full repo-wide audit closure remains open."
    },
    {
      "id": "PACK_E_marquee_scene_v2_16bit",
      "title": "Pack E (P1): Marquee scene V2 facelift (readable 16-bit style)",
      "summary": "Refactor and redesign existing weather marquee scenes from 8-bit to a more readable, cohesive 16-bit visual system while preserving current scene taxonomy and behavior contracts.",
      "notes": [
        "Focus first on readability and consistency across existing scene types.",
        "Coordinate with external artist/design-agent workflow for scene specs and assets.",
        "Preserve animation performance and accessibility on small devices.",
        "During Pack E layout pass, evaluate vertical marquee expansion so the scene can extend further down into currently unused space above the Sunrise/Sunset and Wind/Gust pill row without breaking hero grid contracts.",
        "After V2 facelift, run discovery for location-based variants (city/rural/beach/region)."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "in_progress",
      "status_updated": "2026-02-08",
      "status_note": "Multiple readability/layout phases shipped; full V2 facelift and follow-up variants are not fully closed."
    },
    {
      "id": "PACK_F_tools_surface_completion",
      "title": "Pack F (P1): Tools surface completion and parity cleanup",
      "summary": "Resolve remaining “coming soon” surfaces, finish key tool UX parity, and normalize unit-matrix behavior between tools and widgets.",
      "notes": [
        "Run and execute a concrete coming-soon audit with owner and ETA per tool.",
        "Finish currency tool UX parity if any gaps remain after Pack C.",
        "Standardize From/To unit interaction model across tools/widgets.",
        "For table-like standards tools (paper/shoe/mattress), use dedicated lookup-table UX instead of forcing generic Convert flows."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "closed_with_defer",
      "status_updated": "2026-02-08",
      "status_note": "Activated tools shipped; `clothing_sizes` remains intentionally deferred behind explicit acceptance criteria."
    },
    {
      "id": "PACK_G_polish_compliance_release_readiness",
      "title": "Pack G (P2): Polish, compliance, and release readiness",
      "summary": "Final polish pass including About/Licenses, accessibility and interaction polish, and release readiness hardening after core platform/data packs are complete.",
      "notes": [
        "About + Licenses accuracy and legal completeness.",
        "Accessibility, haptics, and interaction consistency pass.",
        "Release checklist and QA signoff artifacts."
      ],
      "priority": "P2",
      "size": "XL",
      "status": "done",
      "status_updated": "2026-02-08",
      "status_note": "Compliance surfaces, accessibility follow-through, and Pack G release checklist artifacts are now shipped and test-covered."
    },
    {
      "id": "PACK_H_localization_i18n_l10n",
      "title": "Pack H (P1): Localization and language settings",
      "summary": "Add end-to-end localization (i18n/l10n) with a user-selectable language in Settings, localized tool/menu copy, date/time/number/currency formatting, and fallback policy.",
      "notes": [
        "Add app-level language selection under Settings (Tools menu entry point) with persisted preference and system-default option.",
        "Localize dashboard, wizard, tools, and error/empty-state text using ARB-based Flutter localization workflow.",
        "Apply locale-aware formatting for dates, times, numbers, and currencies while preserving city unit/time defaults.",
        "Define translation quality gate and fallback behavior for missing keys.",
        "Add regression tests for locale switching and key critical paths (hero, currency, tool modal, first-run)."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "done",
      "status_updated": "2026-02-08",
      "status_note": "Language settings, locale persistence, runtime fallback, and ARB/seed coverage are shipped."
    },
    {
      "id": "PACK_I_playful_tutorial_overlay_near_finalization",
      "title": "Pack I (P2): Playful in-app tutorial overlay (skippable)",
      "summary": "Add a skippable, guided tutorial overlay after primary UI contracts stabilize, focusing on key navigation and conversion interactions without increasing churn during active UI refactors.",
      "notes": [
        "Ship near finalization to avoid frequent maintenance against ongoing UI/layout changes.",
        "Tutorial must support skip/dismiss and resume policy (first-run only vs optional replay in Settings).",
        "Cover wizard Slide 2 Home/Destination selection and Slide 3 Save Profile action.",
        "Cover dashboard hero pills (Sunrise/Sunset, Wind/Gust, Pollen/AQI), tools menu access, add-widget flow, and settings entry.",
        "Visual direction: playful highlighted callouts/circles using Dracula palette; Cabin Sketch-style heading treatment is an optional design exploration."
      ],
      "priority": "P2",
      "size": "XL",
      "status": "planned",
      "status_updated": "2026-02-08",
      "status_note": "Tutorial overlays are intentionally deferred until finalization/readiness."
    },
    {
      "id": "PACK_J_weather_tool_full_redesign",
      "title": "Pack J (P1): Weather tool full redesign and product-positioning decision",
      "summary": "Replace the current generic converter-style Weather modal with a deliberate Weather experience aligned to Unitana’s travel intent, data contracts, and visual language.",
      "notes": [
        "Do not keep Weather as a placeholder converter UI.",
        "Run a decision workshop before implementation: weather-as-conversion utility vs richer weather cockpit with expanded API detail + marquee-first visual storytelling.",
        "Produce a short pitch doc with at least two concrete options, tradeoffs, and final recommendation.",
        "Recommended direction should align with Unitana's core use-case (home/destination context, time delta, readiness at-a-glance) and Dracula aesthetic.",
        "Include implementation sequencing, acceptance criteria, and regression test strategy before coding starts."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "in_progress",
      "status_updated": "2026-02-08",
      "status_note": "Weather cockpit redesign is substantially shipped; final product-positioning closure and checklist remain open."
    },
    {
      "id": "PACK_K_context_aware_profile_auto_select",
      "title": "Pack K (P1): Context-aware profile auto-selection (optional GPS assist)",
      "summary": "Add an optional Settings feature that uses device location plus recency to auto-select the most relevant profile without surprising users.",
      "notes": [
        "Feature must be explicit opt-in in Settings with clear permission copy and a hard off switch.",
        "Ranking policy: score each profile by destination/home geo match confidence and recency; prefer best score above threshold, else keep current profile; fallback to most-recent profile only when no reliable geo match exists.",
        "Do not silently switch while the user is actively editing widgets/tools; schedule switch at safe boundaries (app foreground, profile picker open, or explicit prompt).",
        "Require deterministic tie-breakers and explainability text (why this profile was selected).",
        "Add privacy guardrails: coarse geofence matching first, no raw location history retention by default, and explicit retention policy if telemetry is added.",
        "Add test matrix for permission denied, stale location, near-border ambiguity, and travel-day churn."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "in_progress",
      "status_updated": "2026-02-09",
      "status_note": "Phase-1 shipped: opt-in setting + deterministic suggestion engine + persistence contracts; no silent auto-switch behavior remains enforced."
    },
    {
      "id": "PACK_L_dual_theme_system_dark_light",
      "title": "Pack L (P1): Dual theme system (Dracula dark + Solarized light mapping)",
      "summary": "Introduce a first-class light theme option in Settings using a Solarized-inspired palette mapped against existing Dracula dark token roles.",
      "notes": [
        "Keep Dracula dark as default and add Settings theme mode: `System`, `Dark (Dracula)`, `Light (Solarized)`.",
        "Create semantic token mapping (surface, text roles, borders, accents, status colors) instead of ad hoc hex swaps.",
        "Preserve marquee art direction where appropriate, but ensure all text/controls meet contrast in light mode.",
        "Add regression coverage for both themes on key surfaces (dashboard hero, tool tile, tool modal, weather sheet).",
        "Document token map and accessibility constraints in a dedicated reference spec before implementation."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "in_progress",
      "status_updated": "2026-02-09",
      "status_note": "Theme mode scaffold is shipped (`System`/`Dracula Dark`/`Solarized Light`) with ongoing readability parity sweeps across dashboard/tool surfaces."
    },
    {
      "id": "PACK_M_jet_lag_tool_rethink_actionable_planning",
      "title": "Pack M (P1): Jet Lag tool redesign for actionable planning",
      "summary": "Redesign Jet Lag around plain-language travel facts + adaptation planning, with consistent tile/modal math and optional flight-time estimation from existing city coordinates.",
      "notes": [
        "Split Jet Lag UI into `Travel Facts` (objective) and `Adaptation Plan` (heuristic) cards.",
        "Use clear copy (`Time zone offset`, `Adjustment estimate`) and remove jargon-first phrasing.",
        "Enforce zero-shift contract: `same zone (0h)` + `no adjustment needed` with no conflicting hints.",
        "Centralize Jet Lag calculations in a shared engine so widget and modal never drift.",
        "Phase 1 flight-duration estimate should be free/offline-friendly using city lat/lon distance + deterministic heuristic model.",
        "Later phase can add route-aware data sources, but must keep deterministic fallback.",
        "Requires global timezone handling expansion beyond the current limited helper to avoid false `0h` outcomes."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "done",
      "status_updated": "2026-02-08",
      "status_note": "Jet Lag redesign phases (shared planner, facts/plan, schedule support, flight estimate) are shipped with tests."
    },
    {
      "id": "PACK_N_global_timezone_dataset_and_converter_support",
      "title": "Pack N (P1): Global timezone dataset + full converter support",
      "summary": "Expand timezone support from the current limited helper set to a complete IANA-backed city/timezone surface so Time-family and Jet Lag never produce misleading zero-offset outcomes.",
      "notes": [
        "Replace limited timezone pick lists with full, searchable timezone coverage (IANA zone IDs + friendly city/region labels).",
        "Prefer reusing canonical city dataset where possible; add a dedicated timezone catalog only for zones/cities not already represented.",
        "Ensure DST-aware offset correctness for any selected zone at arbitrary dates/times.",
        "Unify timezone source for Time, Time Zone Converter, and Jet Lag so all surfaces share identical offset math.",
        "Add tests for same-zone, opposite-direction, DST-boundary, and date-line edge cases.",
        "Document fallback behavior when timezone metadata is missing or ambiguous."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "done",
      "status_updated": "2026-02-08",
      "status_note": "Global timezone support and deterministic DST/date-line behavior are shipped with regression coverage."
    },
    {
      "id": "PACK_O_contextual_tutorial_overlays_by_tool_family",
      "title": "Pack O (P2): Contextual tutorial overlays by tool family",
      "summary": "Extend tutorial strategy beyond a single walkthrough by adding lightweight, skippable overlays tailored to major tool families and unique UX surfaces.",
      "notes": [
        "Keep profile wizard tutorial as a separate flow and do not merge it with in-context tool tutorials.",
        "Define tutorial categories (initial proposal): core converters, multi-unit/lookup tools, weather surfaces, time/jet-lag surfaces, and dashboard/widget editing flows.",
        "Each category overlay must include dismiss/never-show controls and optional replay entry from Settings.",
        "Copy should reference locked design contracts (layout, interaction, and terminology) to reduce user confusion on advanced tools.",
        "Add completion-state persistence per tutorial category so users are not repeatedly interrupted.",
        "Scope should remain lightweight: hints and interaction framing, not long-form onboarding."
      ],
      "priority": "P2",
      "size": "XL",
      "status": "planned",
      "status_updated": "2026-02-08",
      "status_note": "Contextual tutorial overlays remain unscheduled until post-core readiness."
    },
    {
      "id": "PACK_P_licenses_information_architecture",
      "title": "Pack P (P2): Licenses information architecture and readability",
      "summary": "Refactor licenses presentation from raw long-form text into a user-readable legal surface with concise summaries, grouped sections, and source links while preserving required notices.",
      "notes": [
        "Split legal-required copy from explanatory UX copy so mandatory text remains intact.",
        "Support collapsible sections by package/source family.",
        "Provide links to upstream license pages where allowed.",
        "Preserve deterministic About/Licenses test contracts.",
        "Keep full legal payload exportable for compliance."
      ],
      "priority": "P2",
      "size": "XL",
      "status": "planned",
      "status_updated": "2026-02-09",
      "status_note": "Queued from backlog expansion; implementation pending."
    },
    {
      "id": "PACK_Q_language_expansion_completion",
      "title": "Pack Q (P1): Language expansion and localization completion",
      "summary": "Extend localization beyond English/Spanish by adding French and European Portuguese, closing untranslated-key gaps, and hardening language QA gates.",
      "notes": [
        "Add locale options for `English`, `Spanish`, `French`, and `Portuguese (Portugal)`.",
        "Complete missing Spanish coverage and enforce no-silent-fallback policy in critical surfaces.",
        "Add ARB/seed/runtime contract tests for the new locales.",
        "Optionally show locale badges/icons in picker without conflating language and country semantics.",
        "Preserve deterministic runtime fallback behavior."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "done",
      "status_updated": "2026-02-09",
      "status_note": "XL-B shipped: locale picker/app wiring now supports EN/ES/FR/PT-PT with persistence, runtime seed coverage, and deterministic localization regression gates."
    },
    {
      "id": "PACK_R_matrix_global_standards_expansion",
      "title": "Pack R (P1): Matrix tools global standards expansion",
      "summary": "Expand Shoes, Paper, and Mattress datasets and semantics for broader global standards coverage with a coherent matrix model.",
      "notes": [
        "Extend shoes beyond current rows and add additional region standards where reliable mappings exist.",
        "Expand mattress standards beyond current subsets and clarify taxonomy semantics.",
        "Add paper standards beyond ISO/US (for example JIS and ANSI/ARCH families).",
        "Replace ambiguous column semantics (for example `Class`) with explicit canonical labels.",
        "Preserve matrix copy/tap and highlight behavior contracts."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "in_progress",
      "status_updated": "2026-02-09",
      "status_note": "XL-A phase 1 shipped: expanded Shoes/Paper/Mattress matrix datasets and regional columns with clearer first-column semantics."
    },
    {
      "id": "PACK_S_matrix_widget_last_selection_sync",
      "title": "Pack S (P1): Matrix widget last-selection sync",
      "summary": "Make Shoes, Paper, and Mattress widgets reflect the last matrix value row tapped/copied by the user.",
      "notes": [
        "Persist last copied row/key per matrix tool.",
        "Update widget previews and cards to show current selection deterministically.",
        "Handle no-selection defaults and migration from existing state safely.",
        "Add regression tests for tap-copy -> widget sync behavior."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "in_progress",
      "status_updated": "2026-02-09",
      "status_note": "XL-A phase 1 shipped: matrix cell copy now persists last selection payload and dashboard widgets can render matrix-driven preview labels."
    },
    {
      "id": "PACK_T_world_time_map_widget_reimagination",
      "title": "Pack T (P1): World Time Map widget reimagination",
      "summary": "Redesign World Time Map widget naming and readout density so the widget title fits and glance-value is materially useful.",
      "notes": [
        "Shorten/rename widget title to prevent truncation across sizes.",
        "Surface actionable timezone delta/readout values from map panel context.",
        "Keep map lane semantics consistent with modal behavior.",
        "Add small-size widget readability and overflow tests."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "planned",
      "status_updated": "2026-02-09",
      "status_note": "Queued from backlog expansion; implementation pending."
    },
    {
      "id": "PACK_U_theme_readability_finalization",
      "title": "Pack U (P1): Theme readability finalization and naming simplification",
      "summary": "Finish light/dark readability parity across tools/widgets and simplify theme naming in user-facing UI.",
      "notes": [
        "Rename Settings theme labels to `Light` and `Dark` while preserving internal token mapping docs.",
        "Adjust light-mode Convert CTA away from oversaturated pink to a contrast-safe accent.",
        "Sweep modal/header/input/readout contrast in both themes.",
        "Add regression checks for critical high-traffic tool surfaces."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "planned",
      "status_updated": "2026-02-09",
      "status_note": "Queued from backlog expansion; implementation pending."
    },
    {
      "id": "PACK_V_emergency_weather_system_and_marquee_states",
      "title": "Pack V (P1): Emergency weather system and marquee alert states",
      "summary": "Add emergency weather classification and dedicated marquee/UX responses for severe conditions.",
      "notes": [
        "Define deterministic emergency weather taxonomy and source mapping.",
        "Add alert-specific marquee scene variants with high-visibility but non-alarmist behavior.",
        "Add fallback behavior when provider alert metadata is missing.",
        "Gate with deterministic tests for alert priority and scene selection."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "planned",
      "status_updated": "2026-02-09",
      "status_note": "Queued from backlog expansion; implementation pending."
    },
    {
      "id": "PACK_W_lofi_audio_opt_in",
      "title": "Pack W (P2): Royalty-free lo-fi audio feature (opt-in)",
      "summary": "Introduce an optional royalty-free lo-fi audio feature, disabled by default, with simple controls and strict non-intrusive behavior.",
      "notes": [
        "Ship off by default with explicit user opt-in.",
        "Use only royalty-free/compliance-safe sources.",
        "Provide play/pause and volume controls with persisted preference.",
        "Avoid interfering with app performance or critical interactions."
      ],
      "priority": "P2",
      "size": "XL",
      "status": "planned",
      "status_updated": "2026-02-09",
      "status_note": "Moved out of icebox per reprioritization; implementation pending."
    },
    {
      "id": "PACK_X_full_app_retro_ux_ui_performance",
      "title": "Pack X (P1): Full-app UX/UI/interactivity/performance retro",
      "summary": "Run a structured retrospective across all app surfaces to evaluate tool usefulness, interaction consistency, visual uniformity, and performance opportunities.",
      "notes": [
        "Score each tool for usefulness, clarity, and completeness.",
        "Audit consistency of haptics, visual indicators, and micro-interactions.",
        "Audit light/dark uniformity and readability debt.",
        "Capture concrete performance hotspots and optimization candidates.",
        "Produce prioritized action list with effort/risk estimates."
      ],
      "priority": "P1",
      "size": "XL",
      "status": "planned",
      "status_updated": "2026-02-09",
      "status_note": "Queued from backlog expansion; implementation pending."
    },
    {
      "id": "PACK_Y_wearables_and_platform_addons",
      "title": "Pack Y (P3): Wearables and platform add-ons (final phase)",
      "summary": "Plan and later implement Apple Watch, Wear OS, and Android home-screen widget add-ons as post-core expansion work.",
      "notes": [
        "Keep this pack after core product readiness and audio feature stabilization.",
        "Define minimum viable glance surfaces per platform.",
        "Document sync/data contracts with mobile app state.",
        "Treat as end-of-roadmap expansion pack."
      ],
      "priority": "P3",
      "size": "XL",
      "status": "planned",
      "status_updated": "2026-02-09",
      "status_note": "Queued from backlog expansion; intentionally scheduled last."
    }
  ],
  "current_state": {
    "current_slice": "XL-B shipped: Pack Q language expansion + completeness gates (EN/ES/FR/PT-PT locale wiring and runtime localization contract hardening). Next is XL-C (Pack U + Pack L readability finalization).",
    "notes": [
      "XL-B follow-up shipped on 2026-02-09: localization application was extended across tool-picker labels, tool/widget display labels, and first-run wizard copy surfaces so locale changes affect menu/tools/widgets/wizard text consistently.",
      "XL-B follow-up shipped on 2026-02-09: fixed dashboard profile-edit crash from unmounted context access in `_editProfileFromBoard` by guarding `mounted` and capturing toast copy before async state transitions.",
      "XL-B follow-up shipped on 2026-02-09: first-run city picker modal background now uses active theme surfaces (light-mode readability fix).",
      "XL-B shipped on 2026-02-09: language settings now include `system`, `en`, `es`, `fr`, and `pt-PT`, with persistence normalization in `UnitanaAppState` and MaterialApp support for `fr` and `pt-PT`.",
      "XL-B shipped on 2026-02-09: runtime localization seed maps now include French and Portuguese (Portugal) coverage (`localization_seed_fr.dart`, `localization_seed_pt.dart`) with deterministic locale->seed resolution in `DashboardLocalizations`.",
      "XL-B shipped on 2026-02-09: localization contract tests updated for FR/PT coverage and locale fallback semantics; language/theme settings sheets were made scroll-safe to prevent option overflow regressions.",
      "XL-A shipped on 2026-02-09: Shoes matrix expanded with broader size range and AU mapping column; Paper matrix now includes JIS and ARCH/engineering coverage rows; Mattress matrix now includes US/EU/UK/AU families and expanded size rows.",
      "XL-A shipped on 2026-02-09: matrix first-column semantics retained as explicit neutral references (`Foot (cm)`, `Size`) with mattress `Class` wording removed.",
      "XL-A shipped on 2026-02-09: added persisted per-profile matrix selection state (`matrix_widget_selection_by_tool_v1`) in `DashboardSessionController`; dashboard tile previews can now render last-copied matrix values for Shoes/Paper/Mattress.",
      "XL-A shipped on 2026-02-09: added regression coverage for matrix standards expansion and matrix-selection persistence (`matrix_global_standards_expansion_test.dart`, `dashboard_session_matrix_selection_test.dart`).",
      "Backlog expanded on 2026-02-09 with Packs P/Q/R/S/T/U/V/W/X/Y and normalized so all backlog items explicitly carry `size: XL`.",
      "Music feature moved out of icebox into planned Pack W (`Royalty-free lo-fi audio feature (opt-in)`).",
      "XL-A selected on 2026-02-09: matrix global standards expansion (shoes/paper/mattress) plus matrix widget last-selection synchronization.",
      "XL Unit 10 shipped on 2026-02-09: World Time Map legend labels were simplified (city + UTC only; removed explicit Home/Destination tags) while preserving lane highlighting and Earth basemap.",
      "XL Unit 10 shipped on 2026-02-09: Pace gained Goal Planner controls (5K/10K/Half/Marathon chips, goal-time parsing, required pace output, split checkpoints, compact bar chart).",
      "XL Unit 10 shipped on 2026-02-09: pinned mini-hero was redesigned to a compact non-terminal 3-line composition (date folded into row 1, denser rows 2/3 with grouped weather+air+temp+FX data).",
      "Backlog audit refreshed on 2026-02-09: Packs K/L moved to in-progress based on shipped phase work; Pack D/J remain open for closure artifacts.",
      "XL Unit 8 shipped on 2026-02-08: app now persists preferred theme mode (`dark` default, `system`, `light`) and wires `MaterialApp.themeMode` from app state.",
      "XL Unit 8 shipped on 2026-02-08: Settings now includes a dedicated Theme picker (`System`, `Dracula Dark`, `Solarized Light`) with persisted storage contract `preferred_theme_mode_v1`.",
      "XL Unit 8 shipped on 2026-02-08: added initial light-theme token mapping in `UnitanaTheme.light()` while preserving Dracula dark as default.",
      "XL Unit 8 shipped on 2026-02-08: World Time Map now renders a true Earth map background via raster basemap asset (`assets/maps/world_outline.png`) with tinted overlay + graticule lanes.",
      "XL Unit 8 shipped on 2026-02-08: settings/about/licenses regression tests were hardened with `ensureVisible` to keep deterministic sheet interaction under scrollable settings content.",
      "XL Unit 7 shipped on 2026-02-08: Settings now includes persisted `Auto-suggest profile by location` opt-in (default off), with explainability copy and no silent profile switching.",
      "XL Unit 7 shipped on 2026-02-08: added deterministic profile auto-selector engine (`ProfileAutoSelector`) with geo-confidence scoring and recency tie-breakers; location-unavailable path remains inert by design.",
      "XL Unit 7 shipped on 2026-02-08: app-state/storage contracts now persist auto-suggest enablement, latest suggestion reason, suggested profile id, and per-profile activation recency map.",
      "XL Unit 7 shipped on 2026-02-08: World Time Map backdrop now uses lon/lat-projected continent outlines (including Antarctica) for recognizable Earth geometry under timezone lanes.",
      "XL Unit 7 shipped on 2026-02-08: forecast bar labels now use compact primary-unit values (`°C` or `°F`) to avoid narrow-width truncation while preserving dual-unit min/max axis context.",
      "XL Unit 6 shipped on 2026-02-08: full-matrix lookup tables now use canonical first-column semantics per tool (`Foot (cm)` for shoes, `Size` for paper, `Class` for mattresses) instead of duplicate reference labels.",
      "XL Unit 6 shipped on 2026-02-08: shoe matrix rows are now keyed by neutral foot-length baseline (`JP (cm)`) while mapped system columns remain explicit (`US Men`, `US Women`, `EU`, `UK`).",
      "XL Unit 6 shipped on 2026-02-08: paper matrix values now emphasize dimensional payloads in system columns, reducing repeated label noise and improving scanability.",
      "XL Unit 6 shipped on 2026-02-08: world timezone map backdrop was upgraded from abstract blobs to a recognizable Earth silhouette (continent geometry + denser graticule) while preserving lane-highlight interaction contracts.",
      "XL Unit 6 shipped on 2026-02-08: lookup matrix helper copy now reflects actual behavior (`Tap a row to focus. Tap any value cell to copy.`).",
      "XL Unit 4 shipped on 2026-02-08: weather high/low badge line text was reduced again for tighter fit stability on narrow city-banner widths.",
      "XL Unit 4 shipped on 2026-02-08: weather forecast bars now render explicit dual-unit per-bar labels so hourly temperatures and daily highs are visible directly on the chart panel.",
      "XL Unit 4 shipped on 2026-02-08: forecast mode pills now use stronger Dracula palette contrast (`Hourly` cyan, `7-day` pink) and mode-aware bar gradients.",
      "XL Unit 4 shipped on 2026-02-08: `World Clock Delta` was relabeled to `World Time Map`, and `world_clock_delta` now opens a dedicated UTC band map card within the time-family modal.",
      "XL Unit 4 shipped on 2026-02-08: pace input now includes deterministic `mm:ss` coaching copy and hint text to reduce novice UX confusion.",
      "XL Unit 4 shipped on 2026-02-08: unit-price helper now includes an inline how-to guidance panel before data entry cards.",
      "XL Unit 4 shipped on 2026-02-08: shoe-sizes modal accent was normalized to Dracula red for cross-tool aesthetic consistency.",
      "XL Unit 4 shipped on 2026-02-08: activation-bundle test contracts were updated for `World Time Map` naming while preserving `world_clock_delta` tool-id stability.",
      "XL Unit 3 shipped on 2026-02-08: added Pack G release checklist artifact `docs/ai/reference/PACK_G_RELEASE_CHECKLIST_XL3.md` with explicit compliance/accessibility/guardrail signoff rows.",
      "XL Unit 3 shipped on 2026-02-08: Pack B closure-proof coverage expanded with deterministic mixed success/fallback batch behavior in `dashboard_live_data_refresh_fallback_test.dart`.",
      "XL Unit 3 shipped on 2026-02-08: Pack C closure-proof coverage expanded with outage-preserved multi-currency conversion assertions in `dashboard_currency_retry_cache_semantics_test.dart`.",
      "XL Unit 2 shipped on 2026-02-08: Settings now exposes deterministic About + Licenses entry points and tests lock those dashboard->settings compliance paths.",
      "XL Unit 2 shipped on 2026-02-08: dashboard copy/seed/ARB coverage now includes settings/about/licenses keys with fallback-safe runtime localization coverage.",
      "Pack D follow-through in XL Unit 2: context/handoff/next-prompt alignment was refreshed to track shipped status and reduce stale planning drift.",
      "XL Unit 1 shipped on 2026-02-08: backlog entries now include explicit status metadata (`done`, `in_progress`, `planned`, `closed_with_defer`, `icebox`) to prevent drift between planning and shipped work.",
      "Backlog audit result: Packs A/H/M/N are marked done; Pack F is closed-with-defer (`clothing_sizes`); Packs B/C/E/G/J remain in progress; D/I/K/L/O remain planned.",
      "Pack G follow-up shipped on 2026-02-08: weather high/low badge temperatures were reduced for deterministic fit in tight-width card banners.",
      "Pack G follow-up shipped on 2026-02-08: forecast graph region now exposes a deterministic semantics container label key (`weather_summary_forecast_chart_semantics_<placeId>`) for screen-reader mode+units discoverability.",
      "Pack G follow-up shipped on 2026-02-08: narrow weather regression now locks forecast mode semantics selection state and swap tooltip copy contracts.",
      "Pack J phase 4 follow-up shipped on 2026-02-08: forecast panel now supports explicit mode-pill selection (`Hourly`/`7-day`) in addition to swap toggle, preserving deterministic mode keys while improving control discoverability.",
      "Pack G kickoff shipped on 2026-02-08: forecast controls now include stronger accessibility semantics (button + selected state labels), larger swap tap target, and improved legend contrast.",
      "Pack G kickoff shipped on 2026-02-08: added narrow-phone overflow regression lock in `weather_summary_narrow_layout_smoke_test.dart` to enforce no-render-overflow behavior at small widths.",
      "Pack J phase 3 shipped on 2026-02-08: Weather Summary cards now use a larger interactive forecast panel that toggles between Hourly and 7-day bar graphs with a pulsing swap affordance and non-scrolling layout.",
      "Pack J phase 3 shipped on 2026-02-08: forecast/badge cockpit copy is now routed through DashboardCopy contracts with runtime fallback (`dashboard.weather.banner.highLow`, `dashboard.weather.forecast.*`) instead of direct string literals in widget composition.",
      "Pack J phase 3 shipped on 2026-02-08: localization seeds and ARB maps were extended for new weather cockpit labels/tooltips, and runtime/seed regression tests were expanded to lock key presence and fallback behavior.",
      "Pack J phase 2 shipped on 2026-02-08: Weather Summary now includes a Travel readiness cockpit card with destination/home local clocks, day/night status, and deterministic call-overlap quality.",
      "Weather cockpit regression coverage expanded on 2026-02-08 in weather-sheet smoke/open-close and picker-launch paths to lock the new cockpit section while preserving existing weather card contracts.",
      "Tool modal units-row width regression fixed on 2026-02-08: swap control no longer steals a full column, preventing unit-label clipping/encroachment on narrow layouts.",
      "Pack F final deferred decision shipped on 2026-02-08: `clothing_sizes` remains deferred with explicit activation lock criteria (region/category matrix + confidence bands + fit uncertainty policy).",
      "Pack J kickoff shipped on 2026-02-08: Weather Summary now includes an at-a-glance comparison strip with deterministic destination-vs-home time delta and temperature delta rendering.",
      "Pack F follow-up round 4 shipped on 2026-02-07: activated `hydration` as a dedicated non-medical helper surface with deterministic intake estimate math and explicit guardrail copy.",
      "Pack F follow-up round 4 shipped on 2026-02-07: hydration interaction contracts are now covered in `hydration_tool_modal_interaction_test.dart` plus picker/registry activation tests.",
      "Pack F deferred inventory now narrows to `clothing_sizes` only pending quality-bar/uncertainty policy decision.",
      "Pack F follow-up round 3 shipped on 2026-02-07: activated `cups_grams_estimates` as an enabled lookup-style tool surface with core ingredient estimate matrix rows.",
      "Pack F follow-up round 3 shipped on 2026-02-07: lookup systems/contracts for cups/grams now use deterministic `Volume` and `Weight` labels plus approximation notes per ingredient.",
      "Pack F follow-up round 3 shipped on 2026-02-07: added matrix interaction regression coverage for cups/grams plus activation-contract updates in picker/registry tests.",
      "Pack F follow-up round 2 shipped on 2026-02-07: activated `pace` as an enabled converter surface (`min/km ↔ min/mi`) with deterministic pace parsing (`mm:ss`, `XmYs`, decimal).",
      "Pack F follow-up round 2 shipped on 2026-02-07: converter units row now uses mixed fit policy to preserve plain-text unit typography consistency while keeping interactive unit-pill rows overflow-safe/tappable on narrow layouts.",
      "Pack F follow-up round 2 shipped on 2026-02-07: added pace activation and interaction regression coverage, and updated deferred-matrix planning after activating both `energy` and `pace`.",
      "Pack F follow-up shipped on 2026-02-07: activated `energy` (`Calories / Energy`) as an enabled converter surface with deterministic `kcal ↔ kJ` unit conversion path.",
      "Pack F follow-up shipped on 2026-02-07: converter units row typography now avoids `FittedBox` downscaling and uses horizontal overflow handling to keep unit text scale visually consistent across tools (for example `km/h → mph`).",
      "Pack F follow-up shipped on 2026-02-07: added regression coverage for converter units-row typography consistency and picker/registry activation contracts for `energy`.",
      "Pack H full completion shipped on 2026-02-07: Settings now exposes persisted language choice (`System`/`English`/`Spanish`) wired through app state/storage and `MaterialApp.locale`.",
      "Pack H full completion shipped on 2026-02-07: runtime localization/seed contracts and ARB exports were extended for language settings strings, with regression coverage for locale persistence and runtime fallback behavior.",
      "Pack C + Pack B reliability hardening shipped on 2026-02-07 with deterministic currency/weather fallback contract tightening and regression coverage.",
      "Currency refresh path now normalizes/merges provider rates safely, preserves last stable rates on unusable payloads, and records deterministic retry/backoff error state for missing EUR->USD paths.",
      "Live-data freshness semantics were tightened so `lastRefreshedAt` is only advanced on actual successful live updates (weather and/or currency), preventing false fresh-state signaling during full fallback failures.",
      "Added currency stale-time test hook (`debugSetLastCurrencyRefreshedAt`) for deterministic retry/cache reliability contracts in tests.",
      "Regression coverage expanded in `dashboard_currency_retry_cache_semantics_test.dart` and `dashboard_live_data_refresh_fallback_test.dart` for unusable-currency payload and full weather-fallback freshness behavior.",
      "Pack N + Pack A closure shipped on 2026-02-07: timezone/data correctness hardening contracts are now deterministic and validated.",
      "Timezone stack now uses `timezone/data/latest_all.dart` so full dataset zone IDs resolve across Time/Jet Lag/Time Zone Converter without reduced-bundle gaps.",
      "Timezone regression coverage now locks DST boundary conversion, opposite-direction date-line behavior, and strict unknown-zone failure mode in `timezone_utils_global_support_test.dart`.",
      "Canonical city parsing now fails fast (`City.fromJson` throws `FormatException`) for missing/invalid critical fields, and `CityRepository.load` no longer silently falls back on malformed canonical assets.",
      "City schema/tooling validators now enforce strict ISO code rules and known IANA timezone IDs (`city_schema_validator.dart`, `tools/validate_cities_v1.py`), with parse-safety regressions in `city_data_schema_validation_test.dart`.",
      "Codex-first workflow allows larger execution packs while keeping gates green.",
      "Pack A city data platform foundation is complete with canonical schema + validation guards.",
      "Radio remains explicitly iceboxed.",
      "Profile UX phase 1 shipped: unified Profiles entry + dedicated tiled board with add/edit/delete/switch and persisted ordering.",
      "Pack F phase 3 shipped: lookup-table shell for shoe/paper/mattress, weather tool routed to weather sheet from picker, and success-feedback matrix high-value gaps closed.",
      "Late pass captured UX concerns: Time tool interim UI is functional but not yet acceptable for final product quality.",
      "Next window is explicitly design-only to lock tool taxonomy, Time-family boundaries, and unified art direction before additional implementation churn.",
      "Design-only decision matrix is now complete with implementation contracts for taxonomy, Time split, weather semantics/refresh behavior, and visual-system guardrails.",
      "Tool registry now encodes explicit architecture metadata (surface type, alias targets, defer reasons), and picker UI differentiates deferred tools with rationale.",
      "Tip Helper (`tip_helper`) is now activated as a dedicated tool surface with picker launch, modal interaction contract, and lens discoverability mapping.",
      "Sales Tax / VAT Helper (`tax_vat_helper`) is now activated as a dedicated tool surface with add-on/inclusive mode workflow and picker launch coverage.",
      "Unit Price Helper (`unit_price_helper`) is now activated as a dedicated tool surface with normalized compare workflow and picker launch coverage.",
      "Jet Lag Delta (`jet_lag_delta`) is now a dedicated Time-family surface with planner guidance instead of routing to generic Time title flow.",
      "Jet Lag copy now uses plain-language `Time zone offset` semantics and zero-shift messaging (`no adjustment needed`), with home->destination defaults for planning clarity.",
      "Jet Lag dashboard tile preview now derives from live home/destination timezone math so tile and modal guidance stay consistent.",
      "Jet Lag redesign slice is now documented in docs/ai/reference/JET_LAG_REDESIGN_SLICE_SPEC.md (facts vs plan IA, heuristic policy, free flight-time estimator phase, and widget contract).",
      "Pack M J1 shipped: shared `JetLagPlanner` engine now drives both Jet Lag modal and widget labels/estimates, with deterministic unit coverage in `jet_lag_planner_test.dart`.",
      "Pack M J2 shipped: Jet Lag modal now presents `Travel Facts` (offset, direction, date impact) and `Jet Lag Plan` (band + estimate + guidance) from shared planner outputs.",
      "Pack M J3 shipped: Jet Lag widget preview now uses compact shared-plan labels (`+7h Eastbound`, `High • ~5d adapt`) with explicit same-zone fallback (`Same zone`, `No adjustment needed`).",
      "Pack M J4 shipped: added deterministic phase-1 flight-time estimation from city coordinates (`FlightTimeEstimator`) and place->geo resolution (`PlaceGeoLookup`), now rendered in Travel Facts and Jet Lag widget summaries when coordinates are available.",
      "Pack M J5 shipped: Jet Lag plan now supports personalized schedule inputs (`Bedtime`, `Wake`) and renders per-day target shifts using shared planner daily-shift rules (`~60/90 min/day`).",
      "Pack N J1 shipped: `TimezoneUtils` now uses IANA timezone data via `timezone` package (global zone support + DST-aware local/UTC conversion) instead of two-zone hardcoded rules.",
      "Pack N J1 shipped: Time-family zone picker now uses a broader catalog from city data with searchable selection (`Search timezone or city`) and offset display upgraded to `UTC±HH:MM`.",
      "Pack N J2 shipped: timezone picker is now city-first by default (`Cities`) with city + country labels and implicit timezone mapping, while preserving advanced timezone-ID selection (`Advanced: Time Zones`) for power users.",
      "Pack N J2 shipped: Time and Time Zone Converter behavior contracts remain stable (swap, conversion history, and home/destination seeding).",
      "Pack N J2 shipped: Jet Lag overlap section now uses practical `Call Windows` framing and gates low-shift overlap details (2-3h) behind explicit reveal (`Show call windows`).",
      "Jet Lag readability polish shipped: Travel Facts and Jet Lag Plan now use key/value emphasis with weight+color (no size inflation), action-first wording (`Tonight Target`), and clearer overlap phrasing.",
      "Tool modal action-row alignment now standardizes centered `Swap` with left-aligned `+ Add Widget` when available for Time-family and converter-style modals.",
      "Backlog expanded with Pack N to deliver full global timezone support for Time-family and Jet Lag correctness (IANA coverage + DST/date-line edge handling).",
      "Backlog expanded with Pack O for separate skippable tutorial overlays by tool family, with per-category completion persistence and Settings replay entry.",
      "Height imperial shorthand now accepts `6.4` style input as `6 ft 4 in`; deeper two-field Height UX and Jet Lag Delta dedicated-mode follow-ups are scoped in PACK_F_SCOPE_FOLLOWUPS_JETLAG_WEIGHT_HEIGHT.md.",
      "Weather sheet now uses a compact layout, removes redundant refresh explainer copy, and renders dual-context values for time (12h/24h) and wind (km/h + mph).",
      "Currency modal now exposes stale/retry status messaging using controller currency health signals.",
      "Reliability follow-up shipped: freshness relative-age wording is now consistent (`just now`, `Xm ago`, `Xh ago`, `Xd ago`) across weather sheet, refresh status label, currency stale banner, and devtools weather freshness line.",
      "Pack H bootstrap prep started: key dashboard/tool user-facing copy is now centralized in `dashboard_copy.dart` (freshness, currency stale/retry, and Time/Jet Lag headings/overlap labels) to reduce future ARB migration churn.",
      "Jet Lag tip text was refreshed for plain-language readability while preserving deterministic rotation and overlap reveal behavior contracts.",
      "Pack H bootstrap prep phase 1.5 shipped: `DashboardCopy` now covers weather/tool/time-converter labels and tooltips for additional high-traffic surfaces.",
      "Added ARB-ready seed scaffold `app/unitana/lib/l10n/localization_seed.dart` with stable `dashboard.*` keys and placeholder templates (`{age}`, `{fromDisplayLabel}`).",
      "Added `localization_seed_contract_test.dart` to lock key uniqueness/namespacing and critical-key presence before full l10n rollout.",
      "Pack H phase 2 shipped: added `dashboard_localizations.dart` runtime lookup (locale language-code lookup + English fallback + placeholder substitution) and wired the first dashboard/tool subset via `DashboardCopy`.",
      "Pilot runtime-localized subset includes weather headings/tooltips, Time-family zone/converter labels, core action/history labels, and Jet Lag section headings/overlap labels.",
      "Added runtime localization tests in `dashboard_localizations_runtime_test.dart` for seeded lookup, parameter substitution, locale fallback, and explicit fallback behavior.",
      "Pack H phase 2.5 shipped: freshness labels and currency stale/retry/cached messaging now resolve through runtime lookup-backed `DashboardCopy` methods (including `{age}` placeholder substitution).",
      "Rewired reliability-critical surfaces (`DataRefreshStatusLabel`, weather sheet freshness line, currency status banner, devtools updating line) to the runtime localization seam while preserving existing UX text.",
      "Expanded runtime localization tests with currency stale/retry placeholder assertions.",
      "Pack H phase 3+4 bundle shipped: additional tool microcopy (clear-history confirmation, edit-value label, history helper hint, history-cleared notice, currency retry notices, clear-history action label) now resolves through runtime localization-backed copy helpers.",
      "App-level localization delegate scaffolding is now in place: `supportedLocales: [en]` and Flutter global localization delegates configured in `MaterialApp`, with `flutter_localizations` SDK dependency added.",
      "DataRefreshStatusLabel stale color logic no longer depends on English string prefixes; it now uses refresh-state semantics for locale safety.",
      "Added localization wiring tests: `app_localization_scaffold_test.dart` (delegate/locale config) and expanded runtime seed lookup assertions for newly migrated microcopy.",
      "Pack H phase 5 shipped: Tip Helper, Tax/VAT, and Unit Price high-traffic microcopy now resolves through runtime localization-backed `DashboardCopy` methods while preserving existing English UX wording.",
      "Added deterministic ARB-transition export helper `tools/export_localization_seed.dart` to emit sorted seed key inventory as JSON.",
      "Localization seed and runtime tests expanded again for Tip/Tax/Unit Price keys and placeholder substitutions.",
      "Pack H phase 6 shipped: Lookup shell, Time/Jet Lag helper labels, and dashboard/tool notices now route through runtime localization-backed `DashboardCopy` methods while preserving current English UX copy.",
      "Pack H phase 6 shipped: added seeded keys + runtime tests for direction/facts/plan labels and lookup matrix copy; Pack N/M contracts and full gates remain green.",
      "Pack H phase 7 shipped: dashboard tool/menu/refresh tooltips, editor action labels, reset-defaults confirmation copy, and Profiles board delete/edit/status copy now resolve via runtime localization-backed `DashboardCopy` methods.",
      "Pack H phase 7 shipped: localization seed + runtime tests expanded for new dashboard/profiles keys, with full gates green.",
      "Pack E follow-up captured: evaluate vertical marquee region expansion into unused space above Sunrise/Sunset and Wind/Gust row while preserving hero grid contracts.",
      "Pack H phase 8 shipped: weather/devtools/clock override labels, helper copy, and freshness/status templates now resolve through runtime localization-backed `DashboardCopy` methods.",
      "Pack H phase 8 shipped: localization seed + runtime tests expanded for new devtools keys/placeholders; full gates remain green.",
      "Pack H phase 9 shipped: tool-picker/time-picker/unit-picker labels and remove/replace action copy now resolve through runtime localization-backed `DashboardCopy` methods.",
      "Pack H phase 9 shipped: localization seed + runtime tests expanded for picker/action keys and placeholders; full gates remain green.",
      "Pack H phase 10 runtime-track closeout shipped: remaining tool-picker result-state labels (`No matching tools`, `No tools yet`, `Results`, `+N more`) now resolve through runtime localization-backed `DashboardCopy` methods.",
      "Pack H phase 10 shipped: added deterministic seed snapshot artifact `docs/ai/reference/LOCALIZATION_SEED_EN_SNAPSHOT.json` generated from `tools/export_localization_seed.dart` for ARB transition review.",
      "Pack E kickoff shipped: Places Hero vertical budget was rebalanced (reduced non-content chrome footprint + tighter stack spacing) so marquee gets more usable phone-height without changing text sizes or touch-target contracts.",
      "Pack E kickoff shipped: added marquee presence/min-height guard in `dashboard_places_hero_v2_test.dart`; full gates remain green.",
      "Pack E scope correction: reverted dashboard split-marquee prototype and restored prior hero marquee behavior.",
      "Split-marquee concept is deferred for weather-sheet middle-bridge scope only; reusable notes saved in `docs/ai/reference/PACK_E_SPLIT_MARQUEE_DEFERRED_NOTES.md`.",
      "Pack E phase 3 shipped: hero scene renderer now uses lower-noise rain/snow/visibility-family particle tuning for better readability across key scene families.",
      "Pack E phase 3 shipped without changing dashboard marquee semantics or hero grid/collapse contracts.",
      "Pack E phase 4 scaffold shipped: weather summary sheet now includes a middle bridge split card between destination/home sections with per-city temp + condition context.",
      "Pack E phase 4 preserved scope guard: no dashboard marquee semantics changes; bridge coverage added to weather sheet smoke test.",
      "Pack E phase 5 shipped: weather-sheet bridge halves now render compact per-city scene previews via `HeroAliveMarquee` to improve dual-city visual readability.",
      "Pack E phase 5 preserved canonical hero-key safety by rendering bridge previews with `includeTestKeys: false` and kept dashboard marquee semantics unchanged.",
      "Pack E phase 5 smoke coverage added bridge scene keys (`weather_summary_bridge_scene_dest`, `weather_summary_bridge_scene_home`) to lock visual contract presence.",
      "Weather sheet follow-up shipped: removed middle bridge card and embedded compact scene marquees directly in each city card header (top-right).",
      "Weather sheet follow-up shipped: city headers are now city-first (`flag + city`) with no `Home`/`Destination` prefix text, and table pills were slightly compacted for better breathing room.",
      "Time-family picker follow-up shipped: seeded zone labels no longer include `Home ·` / `Destination ·` prefixes, while seeded-zone prioritization remains intact.",
      "Pack E phase 6b shipped: weather-sheet per-card mini-marquee treatment now uses responsive header sizing so narrow phone widths preserve city/condition/temp readability.",
      "Pack E phase 6b shipped: weather summary smoke test now asserts removed middle bridge key stays absent (`weather_summary_bridge_split`).",
      "Pack E phase 6c shipped: Jet Lag zone headers now use neutral `From Time Zone` / `To Time Zone` wording instead of Home/Destination role labels.",
      "Pack E phase 6c shipped: profile + hero fallback labels now use neutral city-missing wording (`City not set`, `Set city`) where role labels were redundant.",
      "Pack E phase 6d shipped: timezone picker now shows a single explicit selected-row check marker for clearer selection state.",
      "Pack E phase 6d shipped: short advanced timezone search (e.g., `EST`) now uses stricter token/prefix filtering to reduce noisy false matches.",
      "Pack E phase 6e shipped: time picker default city list now prioritizes mainstream travel hubs via `TimeZoneCatalog.mainstreamCityOptions` while keeping profile-seeded zones first.",
      "Pack E phase 6f shipped: default city rows now filter low-signal/noisy labels and reduce duplicate-feeling entries; selected-row checks are constrained to a single visible row across city/zone sections.",
      "Pack E phase 6g shipped: regression coverage expanded for mainstream ranking sanity and selected-row marker contract (`time_zone_catalog_test.dart`, `time_tool_modal_interaction_test.dart`).",
      "Pack H expansion shipped: migrated additional high-traffic residual copy for time picker headers/hints/empty-state, time-converter invalid-input notice, and weather sheet fallback/headers/AQI+pollen bands into runtime-localized `DashboardCopy` methods.",
      "Pack H expansion shipped: localization seed/runtime contract tests were expanded for new `dashboard.*` keys and weather/time picker runtime lookup coverage.",
      "Pack E 6h/6i infra pass shipped: added shared `CityPickerEngine` and migrated wizard + Time/Jet Lag city/timezone filtering to one scoring/search implementation.",
      "TimeZoneCatalog base city ordering now uses `CityPickerEngine` scoring so wizard and Time-family pickers align on mainstream-first ranking semantics.",
      "Added `city_picker_perf_budget_test.dart` to enforce build/search budget contracts on full `cities_v1.json` corpus (33,257 rows).",
      "Added baseline/spec doc `docs/ai/reference/CITY_PICKER_PERF_BUDGET.md` with current measured timings and maintenance policy.",
      "Pack E follow-up shipped: ambiguity/disambiguation scoring now includes exact city-match and country-hint boosts, with optional city+country dedupe in picker searches.",
      "Pack E follow-up shipped: added dataset-backed ambiguity tests (`cities_v1.json`) and mixed-alias selected-marker stability coverage.",
      "Pack E responsiveness pass shipped: Time/Jet Lag picker search now applies with debounce and shows runtime-localized searching state (`dashboard.time.picker.searching`).",
      "Pack H residual sweep shipped: weather condition labels across hero/weather sheet now route through runtime-localized `dashboard.weather.condition.*` keys.",
      "Pack H residual sweep shipped: remaining high-traffic hardcoded tool input hints (generic converter, tip/tax/unit-price/time-converter) now resolve through `DashboardCopy` runtime localization.",
      "Pack H residual expansion shipped: dashboard devtools weather backend labels/short labels and coarse weather-condition names now route through runtime-localized `dashboard.devtools.weather.*` keys.",
      "Pack H residual expansion shipped: Jet Lag schedule time-picker helper copy and profile default-name seed now route through runtime localization (`dashboard.jetLag.schedule.help.*`, `dashboard.profiles.defaultName`).",
      "Pack H residual expansion shipped: localization seed/runtime tests were extended for new devtools/backend/condition and jet-lag/profile keys.",
      "Pack E ambiguity v2 shipped: `CityPickerEngine.searchEntries` now separates city-country matching from timezone matching, adds city-exact and multi-token phrase calibration, and de-prioritizes timezone-only rows for non-timezone queries.",
      "Pack E ambiguity v2 shipped: wizard city picker now enforces city-only matching (no timezone-only rows), while Time/Jet Lag direct zone search keeps timezone-priority behavior.",
      "Pack E ambiguity v2 shipped: dataset-backed ambiguity tests expanded for `san jose`, `london`, `vancouver`, `portland` plus timezone-only de-prioritization coverage.",
      "Pack H final residual sweep shipped: remaining high-traffic hero env/details/currency rate literals now resolve via runtime-localized `dashboard.hero.*` keys through `DashboardCopy`.",
      "Pack H final residual sweep shipped: hero semantics, short-band labels, and details pill titles are now deterministic runtime-localized copy with fallback safety.",
      "Pack E ambiguity v3 shipped: added exact-city same-country disambiguation bonus mapping (`portland|US` prefers `America/Los_Angeles`) in shared ranking heuristics.",
      "Pack E ambiguity v3 shipped: dataset contract expanded to assert top-row `portland` mainstream-zone selection under city+country dedupe while keeping perf/test gates green.",
      "Tool-picker feature shipped: expanding a lens now auto-scrolls modal content to center that lens section; search-driven auto-expansion also auto-focuses.",
      "Added widget regression test `toolpicker_expand_focus_scroll_test.dart` to lock accordion focus-centering behavior in the tools modal.",
      "Pack E ambiguity v4 shipped: disambiguation map expanded with `long beach|US -> America/Los_Angeles` and `springfield|US -> America/Chicago` plus dataset-backed ordering assertions.",
      "Pack H bridge shipped: partial Spanish runtime seed (`localization_seed_es.dart`) is now wired in `DashboardLocalizations` with deterministic English fallback for missing keys.",
      "Pack H bridge shipped: added ARB generator script (`app/unitana/tools/export_localization_arb.dart`) and generated skeleton ARBs (`lib/l10n/arb/app_en.arb`, `lib/l10n/arb/app_es.arb`).",
      "Residual hero copy audit follow-up shipped: env index suffix now runtime-localized (`dashboard.hero.env.indexSuffix`).",
      "Reprioritization decision: move Pack N + Pack A closure to top priority (timezone correctness + canonical data validation), then Pack C + Pack B reliability hardening, then Pack H completion.",
      "De-prioritization decision: broad Pack E visual facelift and tutorial/theme/GPS expansions are deferred until correctness/reliability/localization core tracks are stabilized."
    ],
    "overall_health": "Stable with full gates passing; canonical city data coverage is now enforced for all in-scope records.",
    "status": "GREEN",
    "focus": {
      "now": "Complete Pack H full rollout (language settings + ARB generation workflow + locale switching contracts).",
      "next": "Pack F parity cleanup and Pack J weather redesign decision/execution track.",
      "later": [
        "Pack F parity cleanup, then Pack J weather redesign decision/execution, then Pack G release-readiness polish."
      ]
    }
  },
  "decisions": [
    {
      "date": "2026-02-06",
      "decision": "Use a utility-first weather baseline by routing Weather tool picker launches to the existing weather summary cockpit sheet, and avoid generic converter UI.",
      "rationale": "This removes the placeholder converter mismatch with minimal churn, keeps behavior coherent across tile and picker entry points, and leaves room for a richer Pack J cockpit evolution.",
      "topic": "Weather tool baseline direction"
    },
    {
      "date": "2026-02-06",
      "decision": "Ship a shared lookup-table modal shell for standards/size tools and migrate Shoe Sizes to it before adding Paper Sizes and Mattress Sizes.",
      "rationale": "Lookup-style tools are not numeric converters; system/category selectors with immediate mapped results are a better fit and reduce UX mismatch.",
      "topic": "Pack F lookup-table tool UX implementation"
    },
    {
      "date": "2026-01-02",
      "decision": "Use WeatherAPI.com for MVP weather provider; map WeatherAPI condition codes to provider-agnostic SceneKeys.",
      "rationale": "WeatherAPI provides a clear condition-code list and predictable pricing; we can keep requests low via caching and on-demand refresh.",
      "topic": "Weather provider MVP"
    },
    {
      "date": "2026-01-02",
      "decision": "Adopt a SceneKey catalog with day/night variation driven by the hero location toggle (sun/moon time-based).",
      "rationale": "Separates art from provider logic, keeps tests deterministic, and ensures consistent visuals across future providers.",
      "topic": "Hero weather visuals"
    },
    {
      "date": "2026-01-14",
      "decision": "Use unit pills that open a compact selector sheet for input/output units. Put secondary outputs behind a \"More units…\" sub-sheet when needed.",
      "rationale": "Keeps the primary modal clean and fast while still supporting tools with many units; avoids bolting \"From/To\" everywhere.",
      "topic": "Multi-unit tool UX (selector strategy)"
    },
    {
      "date": "2026-01-14",
      "decision": "For multi-unit tools, use input/output unit pills that open a compact selector as the default; expose additional outputs behind a single \"More units…\" sub-sheet when needed.",
      "rationale": "Keeps the primary modal clean and consistent across tools while still supporting power users; avoids bolting on verbose From/To forms everywhere.",
      "topic": "Multi-unit tool UX strategy"
    },
    {
      "date": "2026-01-14",
      "decision": "Prefer unit pills that open a compact selector (default). Use a \"More units\" sub-sheet only when secondary outputs matter.",
      "rationale": "Keeps the primary modal clean and fast while still supporting power users; avoids a pervasive From/To form pattern and limits UI complexity growth.",
      "topic": "Multi-unit tool UX"
    },
    {
      "date": "2026-01-20",
      "decision": "Adopt Option 3 for Places Hero V2: remove the middle animation bay permanently and prioritize space for Sunrise/Sunset & Wind/Gust (right) while keeping Env and Currency present in a left rail.",
      "rationale": "Reduces failure surface and increases readability on mobile; provides a clean collapse hierarchy under tight constraints.",
      "topic": "Hero layout direction (Option 3)"
    },
    {
      "date": "2026-01-20",
      "decision": "Enforce a single authoritative micro-mode gate for Env and Currency that triggers before any multi-line layout is constructed; under tight constraints render icon + single-line micro layouts.",
      "rationale": "Prevents recurring RenderFlex overflows caused by 2-line Columns being forced into inner heights in the 20–30px range by tests and compact surfaces.",
      "topic": "Hero overflow prevention (micro-first contract)"
    },
    {
      "date": "2026-01-20",
      "decision": "Treat 44dp minimum touch targets for hero pills as a contract on normal surfaces; use micro fallbacks for pathological constraints instead of shrinking below 44 when the surface allows.",
      "rationale": "Maintains usability and keeps widget tests deterministic while still allowing overflow-safe collapse under extreme constraints.",
      "topic": "Hero tap target contract"
    },
    {
      "date": "2026-01-31",
      "decision": "Redesign the onboarding wizard to a 3-step flow: Step 1 Welcome; Step 2 pick Home+Destination with mini hero preview + toggle; Step 3 name with main hero preview + toggle + confirm.",
      "rationale": "Keeps onboarding friendly while reducing page count and aligning the wizard with the matured dashboard design system; preview-driven steps reduce user uncertainty.",
      "topic": "Onboarding wizard redesign (P0)"
    },
    {
      "date": "2026-01-31",
      "decision": "Apply Dracula discipline across the wizard (white-first text, restrained accents) and unify wizard scaffolding so all steps share the same layout primitives and button styling as the dashboard.",
      "rationale": "Eliminates the 'different app' feel and reduces regression risk by reusing established components and tokens.",
      "topic": "Wizard design system alignment"
    },
    {
      "date": "2026-01-31",
      "decision": "Update bottom navigation to match the 3-step wizard (Step 1 proceed, Step 2 back/next, Step 3 back/confirm) while preserving existing navigation patterns and accessibility.",
      "rationale": "Prevents UX inconsistency and reduces implementation churn while supporting the reduced step count.",
      "topic": "Wizard navigation with fewer pages"
    },
    {
      "date": "2026-01-31",
      "decision": "Replace boolean-driven spacer insertion with a single coordinated animation controller that drives reserved space and overlay visibility for the pinned mini hero.",
      "rationale": "Avoids scroll jumps and layout popping under fast scroll; keeps hit testing stable by reserving space smoothly.",
      "topic": "Pinned mini-hero transition hardening (P0)"
    },
    "Hero interaction consistency: AQI/Pollen pill must show tap ripple feedback (Material+InkWell) like Sunrise/Sunset ↔ Wind/Gust.",
    "Currency cockpit: center-align the currency rate line in both normal and micro layouts.",
    {
      "date": "2026-02-01",
      "text": "Dashboard uses a SliverPersistentHeader collapsing hero; the grid-based DashboardBoard should not also render PlacesHero. Use DashboardBoard(includePlacesHero: false) from DashboardScreen to avoid duplicate heroes and GlobalKeys. Widget tests must ensureVisible() before tapping add-slot tiles."
    },
    {
      "date": "2026-02-01",
      "topic": "Onboarding wizard redesign (P0)",
      "decision": "Wizard is 3 steps: (1) Welcome to Unitana, (2) Pick Your Places, (3) Name and Confirm.",
      "rationale": "Fewer screens, clearer flow, aligns with mature dashboard UI; maintains a welcoming first screen."
    },
    {
      "date": "2026-02-01",
      "topic": "Wizard typography + Dracula discipline",
      "decision": "Wizard titles use the same font family as the dashboard profile name (Roboto Slab). Reduce rainbow text; keep most text white with restrained accents.",
      "rationale": "Consistency across entry funnel and dashboard, avoids readability regressions."
    },
    {
      "date": "2026-02-01",
      "topic": "Dashboard scroll transition",
      "decision": "Adopt SliverPersistentHeader collapsing header to morph expanded PlacesHeroV2 into pinned mini hero readout, replacing threshold insertion.",
      "rationale": "Eliminates perceived scroll 'jump' and makes the transition continuous."
    },
    {
      "date": "2026-02-01",
      "topic": "Stability doctrine for collapsing header",
      "decision": "Canonical hero test keys must remain unique; compact layer must not duplicate expanded hero keys during collapse.",
      "rationale": "Duplicate keys break tests and create fragile finder behavior."
    },
    {
      "id": "D-2026-02-02-keys-gating",
      "date": "2026-02-02",
      "title": "Gate canonical hero keys behind includeTestKeys",
      "decision": "PlacesHeroV2 emits canonical dashboard test keys only when includeTestKeys=true; wizard and other previews set false.",
      "rationale": "Prevent duplicate finder/key failures during collapsing header overlap and reduce brittle tests.",
      "impacts": [
        "Dashboard tests remain stable",
        "Preview surfaces must not rely on canonical keys"
      ]
    },
    {
      "id": "D-2026-02-02-goldens-gated",
      "date": "2026-02-02",
      "title": "Gate golden tests behind env var",
      "decision": "Golden tests run only when UNITANA_GOLDENS=1 is set; baseline updates must be intentional.",
      "rationale": "Avoid CI churn and accidental visual lock-in while iterating on wizard/dashboard polish.",
      "impacts": [
        "Engineers must opt in to golden runs",
        "Goldens updated only with documented rationale"
      ]
    },
    {
      "id": "D-2026-02-03-profiles",
      "date": "2026-02-03",
      "title": "Introduce multi-profile model and namespaced prefs",
      "decision": "Persist profiles list and active profile id; namespace settings per profile; bootstrap from legacy single-profile prefs.",
      "rationale": "Enable switching dashboards cleanly without state bleed; maintain backwards compatibility.",
      "impacts": [
        "Migration/bootstrapping code must be kept",
        "Tests should cover switching and edit flow"
      ]
    },
    {
      "id": "D-2026-02-05-pack-a-city-schema-lock",
      "date": "2026-02-05",
      "title": "Lock canonical city schema with required geo/time/currency/default fields",
      "decision": "Require every city dataset record to include id, cityName, countryCode, timeZoneId, currencyCode, defaultUnitSystem, defaultUse24h, lat, and lon, and enforce this with generator + script + test validators.",
      "rationale": "Pack B/C reliability depends on deterministic city metadata. Allowing missing coordinates/timezone fields causes live data failures and inconsistent fallbacks.",
      "impacts": [
        "GeoNames generator now emits lat/lon and performs strict validation before writing the asset.",
        "cities_v1.json is normalized to full required-field coverage for all in-scope cities.",
        "Schema regressions now fail via tools/validate_cities_v1.py and city_data_schema_validation_test.dart."
      ]
    },
    {
      "id": "D-2026-02-06-pinned-toggle-reality-handoff",
      "date": "2026-02-06",
      "title": "Align pinned mini-hero reality toggle behavior with main hero",
      "decision": "Use destination-left/home-right ordering in compact toggles, align interaction handoff threshold during collapse, and make pinned header readout listen to session/live-data changes.",
      "rationale": "Users saw mirrored toggle orientation and a visible-but-untappable mini-toggle state, which made reality switching feel broken and obscured selected-city temperature changes.",
      "impacts": [
        "Pinned toggle order now matches PlacesHeroV2.",
        "Mini toggle is tappable as soon as it is meaningfully visible.",
        "Pinned readout now updates immediately when reality changes."
      ]
    },
    {
      "id": "D-2026-02-06-city-label-admin-code-cleanup",
      "date": "2026-02-06",
      "title": "Suppress numeric admin codes in city display labels",
      "decision": "For user-facing city labels, prefer admin1Name; if only admin1Code exists and is numeric, omit it and display City + country code.",
      "rationale": "GeoNames admin1 numeric IDs are data-internal and not meaningful in UI (e.g., 'Porto, 17, PT').",
      "impacts": [
        "Wizard/place selection labels are cleaner and less confusing.",
        "Alpha admin codes like US state abbreviations remain visible when admin1Name is missing.",
        "Coverage audit: numeric admin1 codes appear in 27,805 records; 80 have no admin1Name and now fall back to City, CC."
      ]
    },
    {
      "id": "D-2026-02-06-country-currency-resolver",
      "date": "2026-02-06",
      "title": "Use canonical country->currency resolver across dashboard currency surfaces",
      "decision": "Generate and use a canonical country->currency map from cities_v1.json for hero, pinned mini-hero, dashboard currency tile previews, and currency tool direction defaults.",
      "rationale": "Pack C requires global city/country/currency mapping fidelity; hardcoded US/EUR assumptions break correctness for most countries.",
      "impacts": [
        "Currency labels and direction now follow mapped country currency codes globally.",
        "Unsupported non-EUR/USD live conversion pairs display deterministic placeholders instead of incorrect derived rates.",
        "Added mapping coverage tests to ensure all countries in the city dataset are represented."
      ]
    },
    {
      "id": "D-2026-02-06-currency-tool-manual-units-history-guard",
      "date": "2026-02-06",
      "title": "Currency tool supports manual from/to unit selection with history-pair guard",
      "decision": "Expose manual currency from/to pickers in the Currency modal and only apply the latest currency history record on the dashboard tile when its from/to units match the active city-derived pair.",
      "rationale": "Prevents stale or unrelated manual conversions from overwriting the hero/tile default city-pair context while still unlocking full manual global conversion flows.",
      "impacts": [
        "Currency modal now supports arbitrary mapped currency pair selection.",
        "Dashboard currency tile preserves context-correct preview when latest history pair differs from active city pair.",
        "Regression coverage added for manual from/to picker interactions."
      ]
    },
    {
      "id": "D-2026-02-06-localization-epic-added",
      "date": "2026-02-06",
      "title": "Add Pack H localization epic to backlog",
      "decision": "Track full localization as a first-class epic with Settings language selection, locale-aware formatting, and translation fallback/test gates.",
      "rationale": "The product is city/global by design; language selection and locale-correct formatting are foundational quality requirements and should not remain implicit.",
      "impacts": [
        "Settings surface must expose a persisted language selector.",
        "Tool/menu text and key dashboard surfaces need ARB localization coverage.",
        "Formatting logic must be locale-aware without breaking existing city-unit/time behavior."
      ]
    },
    {
      "id": "D-2026-02-06-profile-board-phase1",
      "date": "2026-02-06",
      "title": "Unify profile management behind a dedicated Profiles Board",
      "decision": "Replace split menu actions with one Profiles entry that opens a tiled board supporting add/edit/delete/switch and persisted ordering.",
      "rationale": "The previous switch/add split lacked delete and made edit access asymmetric (active-profile-only affordance). A single board aligns CRUD discoverability and supports iterative UX polish.",
      "impacts": [
        "Dashboard menu now exposes a single Profiles action.",
        "Profile edit can target non-active profiles through temporary context switching.",
        "Profile ordering is persisted in app state for future UX refinement."
      ]
    },
    {
      "id": "D-2026-02-06-packd-restore-preflight",
      "date": "2026-02-06",
      "title": "Require restore-point preflight before Pack D consolidation/deletion",
      "decision": "Any docs cleanup/deletion batch must create a restore point first via ./tools/create_restore_point.sh and follow PACK_D_RESTORE_BACKUP_STRATEGY.md.",
      "rationale": "Pack D consolidation is intentionally destructive; explicit restore artifacts prevent irreversible loss and speed rollback when discrepancies are discovered.",
      "impacts": [
        "Consolidation work is gated by reproducible backup artifacts.",
        "Autonomous delete/move passes can proceed with lower operational risk."
      ]
    },
    {
      "id": "D-2026-02-06-time-tool-repurpose-lock",
      "date": "2026-02-06",
      "title": "Lock Time tool direction to timezone/delta-first",
      "decision": "Treat 12h↔24h conversion as interim only; repurpose Time workflow toward timezone lookup and delta use-cases per TIME_TOOL_REPURPOSE_PLAN.md.",
      "rationale": "Time formatting conversion is low-value for Unitana’s travel context versus timezone/delta workflows tied to home/destination places.",
      "impacts": [
        "Future tool activation should merge world_clock_delta/timezone_lookup into the Time surface.",
        "UI copy and tests should pivot toward timezone correctness and DST-aware behavior."
      ]
    },
    {
      "id": "D-2026-02-06-table-tools-ux-lock",
      "date": "2026-02-06",
      "title": "Lock table-like standards tools to lookup UX",
      "decision": "Represent table-style standards tools (paper sizes, shoe sizes, mattress sizes) with a dedicated lookup-table interaction model instead of generic numeric Convert forms.",
      "rationale": "These tools are discrete mapping/lookup workflows, so formula-style conversion UX adds friction and hides the actual value users need.",
      "impacts": [
        "Pack F should ship a table-tools framework and activate `paper_sizes` first as the reference implementation.",
        "`shoe_sizes` and `mattress_sizes` should follow on the same framework with region/system selectors and row-level notes.",
        "Acceptance criteria and sequencing are locked in docs/ai/reference/LOOKUP_TABLE_TOOLS_UX_PATTERN.md."
      ]
    },
    {
      "id": "D-2026-02-06-destructive-confirmation-policy",
      "date": "2026-02-06",
      "title": "Standardize destructive confirmations on bottom-sheet pattern",
      "decision": "Use a shared bottom-sheet confirmation component for destructive actions across dashboard/profile/tool surfaces; avoid AlertDialog for these flows.",
      "rationale": "Mixed confirmation patterns create UX inconsistency and increase implementation drift; shared component + policy reduces regressions.",
      "impacts": [
        "Profile and dashboard deletion flows now share the same confirmation model.",
        "Tool history clear and dashboard reset-default flows also use the same destructive bottom-sheet model.",
        "New destructive actions should call the shared helper instead of bespoke dialogs.",
        "Policy contract is documented in docs/ai/reference/CONFIRMATION_DIALOG_POLICY.md."
      ]
    },
    {
      "id": "D-2026-02-06-tutorial-overlay-timing-lock",
      "date": "2026-02-06",
      "title": "Schedule tutorial overlay for near-finalization",
      "decision": "Track the playful guided tutorial as Pack I and intentionally defer implementation until core UI contracts are stable.",
      "rationale": "Tutorial overlays are tightly coupled to UI shape; building too early causes repeated maintenance churn while product flows are still evolving.",
      "impacts": [
        "Backlog now includes a skippable tutorial overlay pack with defined scope.",
        "Implementation timing is explicitly after major Pack B/C/F/H surface changes settle."
      ]
    },
    {
      "id": "D-2026-02-06-weather-redesign-deliberation-lock",
      "date": "2026-02-06",
      "title": "Require Weather tool redesign deliberation before implementation",
      "decision": "Treat Weather as a full redesign track (Pack J) and require an explicit option-comparison pitch before coding the new Weather experience.",
      "rationale": "Current converter-style Weather modal does not match product intent; forcing a deliberation gate prevents incremental patching of the wrong model.",
      "impacts": [
        "Weather cannot remain a generic conversion form long-term.",
        "Team must decide between utility-conversion behavior and richer weather cockpit behavior with stronger visual/marquee emphasis.",
        "Implementation must follow a documented recommendation aligned with Unitana aesthetics and travel use-cases."
      ]
    },
    {
      "id": "D-2026-02-06-save-update-feedback-matrix-lock",
      "date": "2026-02-06",
      "title": "Adopt save/update feedback matrix as consistency policy",
      "decision": "Track mutation feedback behavior via a centralized matrix and close gaps intentionally, rather than ad hoc toast additions.",
      "rationale": "UI consistency drift has become visible across dashboard/profiles/tools flows; explicit matrix + policy makes feedback behavior testable and durable.",
      "impacts": [
        "Use docs/ai/reference/SAVE_UPDATE_FEEDBACK_MATRIX.md as source of truth for success-feedback parity decisions.",
        "New mutation flows should declare expected success feedback and test coverage."
      ]
    },
    {
      "id": "D-2026-02-06-packf-mega-slice-priority-lock",
      "date": "2026-02-06",
      "title": "Prioritize high-context Pack F mega slice in next handoff",
      "decision": "Set the next context-window mission to a sustained tools expansion slice with weather redesign baseline, size-matrix tooling, and unit/default hardening.",
      "rationale": "User explicitly requested a long-running build-and-break phase focused on shipping remaining tools and converging on stable UX models.",
      "impacts": [
        "NEXT_CHAT_PROMPT now targets docs/ai/reference/PACK_F_MEGA_SLICE_TOOLS_EXPANSION_PLAN.md as primary execution contract.",
        "Near-term focus shifts from incremental packs to one broader integrated delivery pass."
      ]
    },
    {
      "id": "D-2026-02-06-time-weather-design-pivot",
      "date": "2026-02-06",
      "title": "Pivot to design-first pass for Time/Weather and tool taxonomy",
      "decision": "Pause deeper Time-feature expansion and run a dedicated design sprint to define final Time-family tool boundaries, interaction model, naming contracts, and unified visual language with artist guidance.",
      "rationale": "User feedback identified functional-but-confusing UX and inconsistent visual quality; locking design contracts first reduces churn and prevents further layering on unstable foundations.",
      "impacts": [
        "NEXT_CHAT_PROMPT should be design-only rather than implementation-heavy.",
        "Time tool decisions must address whether features are split across Time, Time Zone Converter, and optional map/clock surfaces.",
        "Tool naming and duplicate taxonomy need deliberate strategy before additional activations."
      ]
    },
    {
      "id": "D-2026-02-06-tool-architecture-decision-matrix",
      "date": "2026-02-06",
      "title": "Lock tool architecture matrix (dedicated vs template vs alias/defer)",
      "decision": "Classify all registry tools into four buckets: dedicated surface, configurable template, alias/preconfiguration, or remove/defer. Canonical duplicate policy: keep one canonical engine identity and allow aliases only when defaults, copy, and lens context materially differ.",
      "rationale": "Current tool sprawl created duplicate semantics and unclear picker expectations. A hard matrix reduces clutter while keeping high-intent shortcuts.",
      "impacts": [
        "Keep dedicated surfaces for Weather and lookup-table standards tools.",
        "Treat Oven Temperature as a context alias of Temperature (not a separate conversion engine).",
        "Route world_clock_delta, jet_lag_delta, and timezone_lookup as aliases into Time-family flows.",
        "Leave disabled helper tools deferred until data contracts and UX quality bars are defined."
      ]
    },
    {
      "id": "D-2026-02-06-time-family-split-option-b",
      "date": "2026-02-06",
      "title": "Adopt Time-family Option B: Time + Time Zone Converter (Map deferred)",
      "decision": "Split Time-family into two tools: Time (home/destination clocks + delta) and Time Zone Converter (explicit arbitrary zone conversion); keep Time Zone Map deferred as optional future visualization.",
      "rationale": "A single mega-tool was harder to scan, while three surfaces would over-fragment low-frequency behavior. Two focused surfaces balance clarity with discoverability.",
      "impacts": [
        "Time defaults to profile home/destination zones with one-tap swap and live clocks.",
        "12h/24h remains display preference (profile/settings), not conversion mode.",
        "History stores only user-entered conversions/plans in Time Zone Converter; passive live clocks are not logged.",
        "Live clocks tick each minute and refresh offsets on timezone/date change events."
      ]
    },
    {
      "id": "D-2026-02-06-visual-system-tools-marquee-contract",
      "date": "2026-02-06",
      "title": "Lock shared visual contract for tool and marquee-adjacent surfaces",
      "decision": "Adopt one visual language for tool sheets/cards and marquee-adjacent readouts: consistent type scale, radius set, icon treatment, spacing rhythm, and title truncation rules.",
      "rationale": "One-off styling across tools and weather/time surfaces made the app feel inconsistent despite a shared palette.",
      "impacts": [
        "Keep Dracula palette direction while standardizing component primitives.",
        "Title policy: menu/picker uses full title; tiles use short alias map; modal title supports max two lines before ellipsis.",
        "Naming policy prefers '&' in compact labels where semantics remain clear."
      ]
    },
    {
      "id": "D-2026-02-06-weather-clarity-refresh-contract",
      "date": "2026-02-06",
      "title": "Lock weather semantics and refresh-state contract",
      "decision": "Weather must use user-facing semantics for AQI and pollen labels, remove provider/dev wording, and expose explicit freshness state with manual + automatic refresh policy.",
      "rationale": "Users could not easily interpret pollen/AQI context and had no strong freshness affordance.",
      "impacts": [
        "AQI shows value + band label; pollen shows index + explicit scale hint.",
        "Manual refresh remains user-triggered; auto-refresh cadence aligns to dashboard live data cycle.",
        "Stale indicator appears when weather age exceeds freshness threshold and clears after successful refresh."
      ]
    }
  ],
  "design_system": {
    "notes": [
      "Audit text styles across pages for contrast and hierarchy.",
      "Interactive pills must provide visible tap feedback (InkWell ripple).",
      "Currency line is center-aligned (micro and normal).",
      "Tools + marquee-adjacent surfaces share the same type/radius/spacing contract.",
      "No ad hoc pill shapes; use one tokenized component family.",
      "Long-name policy is explicit: tile aliases first, two-line modal title max, then ellipsis."
    ],
    "theme": "Dracula-inspired"
  },
  "file_map": {
    "context_db": "docs/ai/context_db.json",
    "handoff": "docs/ai/handoff/CURRENT_HANDOFF.md",
    "next_prompt": "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
    "places_hero_v2": "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
    "workflow": "docs/ai/reference/WORKFLOW.md"
  },
  "ground_rules": [
    "Every code change must include a docs/ai patch note entry (patch_id, summary, files_changed).",
    "Keep docs/ai small and canonical: avoid duplicate prompts and parallel copies.",
    "Prefer updating existing canonical files over creating new variants."
  ],
  "last_updated": "2026-02-06",
  "patch_log": [
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2025-12-31_sliceH_hotfix_tests_scroll_scope",
      "notes": {
        "reason": "ToolPickerSheet now includes additional top content (most recent + search), and the app surface contains multiple scrollables during modal tests.",
        "risk": "Low; test-only behavior change."
      },
      "slice": "H",
      "summary": [
        "Updated dashboard tool insertion/removal widget tests to pass an explicit scrollable Finder to scrollUntilVisible().",
        "Scoped scrolling to the modal BottomSheet's Scrollable to avoid 'Too many elements' errors when multiple scrollables exist (dashboard grid + bottom sheet list)."
      ],
      "title": "Tests: scope ToolPicker scrollUntilVisible to bottom sheet scrollable"
    },
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/activity_lenses.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_session_controller.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2025-12-31_sliceC_toolpicker_2level",
      "notes": [
        "Slice B (Places Hero polish) remains complete; Slice D (AI docs workflow) is now reflected via this patch log entry.",
        "iOS icon visibility remains backlog-only per constraints."
      ],
      "slice": "C",
      "summary": [
        "Implemented a collapsible, two-level ToolPickerSheet that lists Activity Lenses first and tools within each lens (ordered per spec).",
        "Added stable keys: lens headers use toolpicker_lens_<lensId>, tool rows use toolpicker_tool_<toolId>.",
        "Introduced ToolRegistry (dedup-first) to encode the canonical lens/tool inventory and ordering, including Quick Tools sections (Favorites placeholder, Recents from session, Odd-but-useful static list).",
        "Aligned Activity Lens IDs to the canonical spec (with backwards-compatible aliases) and updated the Height tile labeling.",
        "Updated widget tests to expand the Home and DIY lens before selecting Area from the picker."
      ],
      "title": "ToolPickerSheet: two-level hierarchy (Activity Lenses -> Tools)"
    },
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/dashboard_board_item.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_layout_controller.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2025-12-31_sliceF_G_bundle1",
      "summary": [
        "Introduced generic tool tiles keyed by toolId (DashboardItemKind.tool) and added migration from legacy tool kinds.",
        "Enabled Bundle 1 tools (Distance, Speed, Temperature) end-to-end: tool registry -> picker -> tile -> modal -> history.",
        "Tool picker now prefers direct ToolDefinition lookup by toolId, reducing future work to adding definitions.",
        "Conversion history is now keyed by ToolDefinition.id (separate histories per user-facing tool), while canonicalToolId remains the conversion engine key."
      ],
      "title": "Dashboard tool tiles: toolId-based persistence + Bundle 1 tools"
    },
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2025-12-31_sliceF_G_hotfix_tests",
      "summary": [
        "Updated Places Hero V2 widget test expectations to align with toolId-owned result/history keys (baking vs liquids).",
        "Confirmed Liquids and Baking maintain distinct user-facing histories even when sharing a canonical conversion engine."
      ],
      "title": "Test fix: tool modal result/history keys use user-facing tool IDs"
    },
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2025-12-31_testfix_placeshero_default_tiles",
      "summary": [
        "Updated Places Hero V2 widget test to assert the current default dashboard tiles (Height, Baking, Liquids, Area) rather than Distance.",
        "Distance remains an enabled tool in the registry but is not part of ToolDefinitions.defaultTiles."
      ],
      "title": "Test fix: Places Hero V2 default tile assertions (Height/Baking/Liquids/Area)"
    },
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "id": "patch_2025-12-31_sliceH_toolpicker_search_accordion",
      "summary": [
        "Removed the Favorites section from Quick Tools (no pinned/star workflow).",
        "Added a most-recent tool shortcut at the top of the picker plus a search field that filters tool rows.",
        "Changed lens sections to a single-expanded accordion: expanding one lens collapses the others.",
        "Kept stable keys for lens headers and tool rows to preserve persistence and tests."
      ],
      "title": "Tool picker UX: search, recent shortcut, and single-expanded lens"
    },
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart"
      ],
      "id": "patch_2025-12-31_sliceH_hotfix_toolpicker_tests",
      "notes": {
        "reason": "ToolPicker lens headers and tool rows may be off-screen in tests after adding search + most-recent section and accordion behavior.",
        "risk": "Low; test-only change."
      },
      "slice": "H-hotfix",
      "summary": [
        "Fixed dashboard tool insertion/removal widget tests for the Slice H ToolPicker accordion by scrolling lens headers and tool rows into view before tapping.",
        "Replaced ensureVisible() on tool rows (which requires an already-built element) with scrollUntilVisible() to handle lazily-built list items."
      ]
    },
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/lib/theme/dracula_palette.dart",
        "app/unitana/lib/theme/app_theme.dart",
        "app/unitana/lib/features/dashboard/models/lens_accents.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "id": "patch_2025-12-31_sliceI_lens_accent_colors",
      "slice": "I",
      "summary": [
        "Introduced canonical DraculaPalette constants and LensAccents mapping (lensId -> accent).",
        "Tinted ToolPicker lens headers and tool row icons by lens accent for clearer hierarchy without changing text contrast.",
        "Refactored app theme to reference DraculaPalette constants (single source of truth for palette hex values)."
      ],
      "title": "Lens accent colors: Dracula palette tinting for ToolPicker icons"
    },
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/numeric_input_policy.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/widgets/unitana_tile.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "id": "patch_2025-12-31_sliceJ_numeric_limits_overflow",
      "slice": "J",
      "summary": [
        "Added a shared NumericInputPolicy and NumericTextInputFormatter for tool calculator fields.",
        "Applied per-tool digit policies (tightened for height, temperature, and area) and allowed freeform ft/in inputs for Height in imperial direction.",
        "Updated dashboard tiles to scale down primary/secondary values instead of truncating with ellipsis."
      ],
      "title": "Numeric input limits and scale-down value rendering to prevent overflow"
    },
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2025-12-31_sliceJ_hotfix_remove_unused_freeformInput",
      "slice": "J",
      "summary": [
        "Removed an unused private getter in ToolModalBottomSheet after consolidating freeform-input behavior under _requiresFreeformInput."
      ],
      "title": "Hotfix: remove unused freeformInput helper to keep analyze clean"
    },
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "id": "patch_2025-12-31_sliceK_tool_search_results_weight_tools",
      "notes": [
        "Search results use keys toolpicker_search_tool_<toolId> to avoid collisions with tool rows.",
        "Weight conversion is kg <-> lb; separate user-facing tool IDs share the canonical weight engine per the dedup-first rule."
      ],
      "slice": "K",
      "summary": [
        "ToolPicker search now surfaces an immediate Results section and auto-expands the first matching lens when typing.",
        "Enabled Weight (Food) and Body weight (Health) tools end-to-end (ToolRegistry isEnabled + ToolDefinitions + converters)."
      ],
      "title": "ToolPicker search results + enable Weight tools"
    },
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/activity_lenses.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "id": "patch_2025-12-31_sliceK_hotfix_activity_lenses_by_id",
      "notes": [
        "Fixes compile/analyze failure: ActivityLenses.byId referenced from dashboard_board.dart search results subtitle."
      ],
      "slice": "K",
      "summary": [
        "Adds ActivityLenses.byId(String) so ToolPicker search results can render the primary lens name without introducing new dependencies."
      ],
      "title": "Hotfix: add ActivityLenses.byId lookup"
    },
    {
      "date": "2025-12-31",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "id": "patch_2025-12-31_sliceL_weight_modal_units",
      "notes": [
        "Addresses UX inconsistency discovered after enabling Weight tools in Slice K."
      ],
      "slice": "L",
      "summary": [
        "Fixed Weight tool modal labeling and unit toggling to match existing tool patterns (e.g., Temperature shows C → F or F → C).",
        "Corrected Weight conversion display so inputs/outputs clearly indicate kg ↔ lb; removed ambiguous \"what/lbs\" presentation.",
        "Ensured Weight tool tile subtitle uses the correct unit pair string and stays consistent with other tiles."
      ],
      "title": "Weight tool: consistent unit labels + modal header clarity"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_layout_controller.dart",
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "id": "patch_2026-01-01_sliceM_tools_run_and_add_widget",
      "notes": [
        "Slice M included a hotfix chain to restore stability; final state is green."
      ],
      "slice": "M",
      "summary": [
        "Changed ToolPicker behavior so selecting a tool runs it immediately (opens its modal) rather than implicitly adding a dashboard tile.",
        "Added an explicit \"+ Add Widget\" action in tool modals for users who want to pin the tool to the dashboard.",
        "Updated dashboard/controller wiring so adding a widget uses the canonical toolId registry and preserves stable keys and persistence."
      ],
      "title": "Tools menu: run tools without adding; explicit Add Widget flow"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/activity_lenses.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/models/lens_accents.dart",
        "app/unitana/test/tool_lens_map_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "id": "patch_2026-01-01_sliceN_odd_but_useful_top_level_lens",
      "notes": [
        "Follow-up requested: choose an accent clearly distinct from Home and DIY if any contrast concerns appear."
      ],
      "slice": "N",
      "summary": [
        "Promoted \"Odd But Useful\" to a first-class Activity Lens with its own stable lensId and Dracula accent color.",
        "Kept dedup-first rule: tools remain single toolIds; lens membership is an entry-point context only.",
        "Updated ToolRegistry/ActivityLenses mapping and tests to include the new lens."
      ],
      "title": "Odd But Useful: promoted to top-level lens"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/test/add_widget_confirmation_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-01_sliceO1_add_widget_confirmation_visible",
      "notes": {
        "risk": "Low; changes are localized to tool modal UI and one callback.",
        "ux": "Confirmation is rendered inside the tool bottom sheet so it remains visible even when the modal is open."
      },
      "slice": "O1",
      "summary": [
        "Replaced the modal-obscured Add Widget SnackBar with an in-modal confirmation row that stays visible while the bottom sheet is open.",
        "Auto-dismisses the confirmation after a short delay and keeps stable keys for UI tests.",
        "Removed the redundant dashboard-level SnackBar from the Add Widget callback to avoid hidden or double notifications."
      ],
      "title": "Tool modal: visible confirmation for Add Widget"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/add_widget_confirmation_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-01_sliceO1b_add_widget_confirmation_banner",
      "notes": {
        "risk": "Low; only affects confirmation UI and adds small timers that cancel on dispose.",
        "ux": "MaterialBanner renders at the top of the root Scaffold, so it remains visible while bottom sheets are open."
      },
      "slice": "O1",
      "summary": [
        "Added a top-of-screen MaterialBanner confirmation (auto-dismiss) when a widget is added, ensuring the feedback stays visible even while a bottom sheet is open.",
        "Kept the in-modal confirmation row, providing redundant visibility in case the user scrolls or misses one cue.",
        "Converted the dashboard tool-add confirmation from a bottom SnackBar to the same banner pattern to avoid modal occlusion."
      ],
      "title": "Add Widget confirmation: visible banner fallback"
    },
    {
      "date": "2026-01-01",
      "details": [
        "Removed Add Widget top MaterialBanner that could be obscured by the modal; keep a visible in-modal notice.",
        "Introduced UnitanaToast overlay (root overlay) for consistent transient confirmations/errors.",
        "Migrated dashboard confirmations (add tool, replace/remove tile, refresh/update) to UnitanaToast.",
        "Converted invalid modal input feedback to inline notice (no hidden SnackBars)."
      ],
      "files_changed": [
        "app/unitana/lib/common/feedback/unitana_toast.dart",
        "app/unitana/lib/common/widgets/unitana_notice_card.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/test/add_widget_confirmation_test.dart"
      ],
      "id": "patch_2026-01-01_slice_O1c_toast_notifications",
      "summary": "Replace hidden scaffold banners/snackbars with consistent toast + inline modal notices"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/common/widgets/unitana_notice_card.dart",
        "app/unitana/lib/common/feedback/unitana_toast.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/test/add_widget_confirmation_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-01_sliceO1c_unified_confirmations_toast_notice",
      "notes": {
        "follow_up": "O1c1 hotfix corrects a NoticeCard import path and removes an analyzer warning in UnitanaToast.",
        "ux": "Modals show inline notice; screens use the same toast surface for transient confirmations."
      },
      "slice": "O1",
      "summary": [
        "Replaced modal-hidden SnackBar confirmations with an in-modal UnitanaNoticeCard that stays visible while the bottom sheet is open.",
        "Introduced UnitanaToast (root overlay) for consistent transient confirmations across the app, using Dracula-friendly surfaces and contrast-first typography.",
        "Updated dashboard confirmations to use the same feedback pattern for cohesive messaging."
      ],
      "title": "Confirmations: unify UX with toast + in-modal notice"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/common/feedback/unitana_toast.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-01_sliceO1c1_fix_notice_import_and_toast_overlay",
      "notes": {
        "qa": "Run flutter analyze and flutter test; confirm Add Widget notice is visible without collapsing the sheet.",
        "risk": "Low; import path + overlay lookup only."
      },
      "slice": "O1",
      "summary": [
        "Fixed ToolModalBottomSheet to import UnitanaNoticeCard from the correct common path (avoids lib/features/common/... lookup).",
        "Switched UnitanaToast overlay lookup to Overlay.maybeOf(...) to resolve unnecessary_null_comparison and keep safe early-return behavior.",
        "Restores flutter analyze cleanliness and unblocks flutter test compilation."
      ],
      "title": "Fix O1c: correct notice import + toast overlay warning"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/common/feedback/unitana_toast.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-01_sliceO1c2_toast_offset_below_appbar",
      "notes": {
        "qa": "Re-run dashboard_tool_insertion_persistence_test; Dashboard edit Done should be tappable while a toast is visible.",
        "ux": "Toast remains at the top of the screen but sits below the AppBar; tap-to-dismiss preserved."
      },
      "slice": "O1",
      "summary": [
        "Moved UnitanaToast positioning below the toolbar (kToolbarHeight + padding) so confirmations don't obstruct AppBar actions like Dashboard edit Done/Cancel.",
        "Prevents test flakiness where overlay hit-testing could miss AppBar taps while a toast is visible."
      ],
      "title": "Fix O1c: toast no longer blocks AppBar actions"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/unitana_tile.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/dashboard_tile_icon_accent_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-01_sliceO2_dashboard_tiles_inherit_icon_accent",
      "notes": {
        "risk": "Low; change is additive (optional param) and localized to dashboard tile rendering.",
        "ux": "Tiles now visually match picker iconography and lens accent system; Odd But Useful lens uses its distinct accent automatically."
      },
      "slice": "O2",
      "summary": [
        "Updated dashboard tiles to color their leading icon and footer cue using the owning tool’s Activity Lens accent (Dracula palette tints), eliminating the legacy global purple accent.",
        "Added an optional accentColor override to UnitanaTile, allowing per-tool coloring while keeping existing defaults when no override is provided.",
        "Added a widget test asserting the Height tile uses the Health & Fitness lens accent for both icon and footer cue (covers Odd But Useful mapping via the same path)."
      ],
      "title": "Dashboard tiles: inherit tool icon + lens accent"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/test/add_widget_confirmation_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-01_sliceO3_dashboard_tools_button_remove_refresh",
      "notes": {
        "qa": "Run flutter analyze and flutter test; verify top-left button opens Tools picker and no refresh action is exposed on dashboard.",
        "risk": "Low; localized dashboard AppBar change + test update.",
        "ux": "Tools is a higher-frequency action than manual refresh; this reduces top-level UI competition and improves discoverability."
      },
      "slice": "O3",
      "summary": [
        "Replaced the dashboard AppBar leading refresh control with a Tools button (4-box icon) that opens the ToolPickerSheet.",
        "Removed dashboard-level manual refresh wiring; keep live-data refresh as roadmap work and per-tool refresh for live data.",
        "Added a widget test asserting the Tools button opens the ToolPickerSheet."
      ],
      "title": "Dashboard: replace refresh button with Tools launcher; remove manual refresh"
    },
    {
      "changes": [
        "Quick Tools lens is no longer included in the ToolPickerSheet accordion; discovery flows rely on Most Recent + Search + top-level lenses.",
        "ActivityLensId.quickTools remains as a stable constant for backwards compatibility, but is excluded from canonical lens ordering.",
        "Added widget test to ensure Quick Tools lens is absent while search continues to function."
      ],
      "date": "2026-01-01",
      "files": [
        "app/unitana/lib/features/dashboard/models/activity_lenses.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/toolpicker_quick_tools_removed_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-01_slice_O4_remove_quick_tools_lens",
      "notes": [
        "No public widget API changes; stable IDs preserved."
      ],
      "slice": "O4",
      "title": "Remove Quick Tools lens from picker accordion"
    },
    {
      "changes": [
        "Dashboard now blocks adding a widget when that tool already exists on the dashboard (includes default tiles and user-added tiles).",
        "Duplicate attempts show consistent error feedback (UnitanaToast for dashboard picker; UnitanaNoticeCard error inside tool modals).",
        "Updated persistence tests to add a non-default tool and verify duplicates are prevented."
      ],
      "date": "2026-01-01",
      "files": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_exceptions.dart",
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-01_slice_O5_prevent_duplicate_widgets",
      "notes": [
        "No public widget API changes; stable IDs preserved.",
        "Replacement flow also prevents selecting a tool already present elsewhere on the dashboard."
      ],
      "slice": "O5",
      "title": "Prevent duplicate dashboard widgets"
    },
    {
      "changes": [
        "Default dashboard tiles (Height, Baking, Liquids, Area, etc.) can be removed in edit mode using the same affordances as user-added tiles.",
        "Removing a default tile persists via a hidden-default list; adding that tool again restores the default tile instead of creating a duplicate.",
        "Added widget test coverage for removing a default tile and restoring it via picker search."
      ],
      "date": "2026-01-01",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-01_slice_O6_remove_default_tiles",
      "notes": [
        "No public widget API churn; stable tool IDs remain the persistence keys.",
        "Hidden default tracking is designed so future changes to the default set can be applied by recomputing ToolDefinitions.defaultTiles while preserving user intent (hidden vs visible)."
      ],
      "slice": "O6",
      "title": "Allow removing default dashboard tiles"
    },
    {
      "areas": [
        "dashboard",
        "persistence",
        "tests"
      ],
      "constraints_respected": [
        "no public widget API churn",
        "stable IDs/keys",
        "dracula palette restrained"
      ],
      "date": "2026-01-01",
      "id": "patch_2026-01-01_slice_O6b_hidden_default_key_compat",
      "slice": "O6b",
      "summary": "Write hidden-default state to dashboard_hidden_defaults_v1 while continuing to read/write the legacy key to preserve existing installs and keep tests stable.",
      "test_status": "flutter analyze clean; flutter test passing (expected after patch)",
      "title": "Hidden default tile persistence key compatibility"
    },
    {
      "areas": [
        "dashboard",
        "persistence",
        "ui",
        "tests"
      ],
      "constraints_respected": [
        "no public widget API churn",
        "stable IDs/keys",
        "dracula palette restrained"
      ],
      "date": "2026-01-01",
      "id": "patch_2026-01-01_slice_O7_reset_dashboard_defaults",
      "slice": "O7",
      "summary": "Add a dashboard menu action that restores the current default tile set derived from ToolDefinitions.defaultTiles by clearing user-added tiles, layout edits, and the hidden-default state so removed defaults return.",
      "test_status": "flutter analyze clean; flutter test passing (expected after patch)",
      "title": "Reset Dashboard Defaults menu action"
    },
    {
      "areas": [
        "dashboard",
        "places_hero",
        "menu",
        "tests",
        "persistence"
      ],
      "constraints_respected": [
        "no public widget API churn",
        "stable IDs/keys",
        "dracula palette restrained"
      ],
      "date": "2026-01-01",
      "id": "patch_2026-01-01_slice_O7h_hotfix_layout_reset_and_hero_header",
      "slice": "O7h",
      "summary": "Fix Reset Dashboard Defaults implementation issues (controller API + test seeding) and remove the redundant “Tools” entry from the top-right menu now that a dedicated tools button exists. Restore the Places Hero V2 clock header to the two-line centered format using bullets, and center the “Sunrise / Sunset” header within its pill.",
      "test_status": "flutter analyze clean; flutter test passing (expected after patch)",
      "title": "Hotfix: Reset defaults wiring + hero header formatting"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "unitana/app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "unitana/app/unitana/lib/features/dashboard/models/dashboard_layout_controller.dart",
        "unitana/app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "unitana/app/unitana/test/dashboard_reset_defaults_test.dart"
      ],
      "id": "patch_2026-01-01_slice_O7h_hotfix_reset_defaults_and_hero_header",
      "slice": "O7h",
      "summary": "Addresses regressions from the O7 reset-defaults slice by ensuring the DashboardLayoutController exposes resetDashboardDefaults(), fixing the widget test to seed layout JSON using the current schema, and removing the redundant “Tools” option from the top-right (...) menu since a dedicated Tools button now exists. Also restores the PlacesHeroV2 time header to the two-line centered format: “Lisbon • Denver +7h” and “01:03 WET • 6:03 PM MST (Fri 2 Jan)”, and centers the “Sunrise / Sunset” title within its pill.",
      "title": "Hotfix: Reset defaults + hero time header"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "lib/features/dashboard/models/dashboard_layout_controller.dart"
      ],
      "id": "patch_2026-01-01_slice_O7i_hotfix_hidden_defaults_reset_race",
      "notes": {
        "reason": "Widget tests showed hidden-default prefs sometimes remained after reset due to async load/reset ordering.",
        "risk": "Low; load becomes no-op if reset occurs during its async window."
      },
      "slice": "O7",
      "summary": [
        "Added an epoch token to DashboardLayoutController to invalidate in-flight load() when clear/reset runs.",
        "Reset Dashboard Defaults now reliably clears hidden-default state in memory and SharedPreferences, preventing stale state from reappearing in tests or after rapid UI actions."
      ],
      "tests": [
        "test/dashboard_reset_defaults_test.dart"
      ],
      "title": "Hotfix: invalidate in-flight load during reset so hidden-default prefs fully clear"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/dashboard_layout_controller.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-01_sliceO7_hotfix_store_hidden_defaults",
      "slice": "O7",
      "summary": [
        "Added missing private helper _storeHiddenDefaults in DashboardLayoutController.",
        "Ensures legacy StringList hidden-default prefs are migrated to canonical JSON-string storage without analyzer/test failures."
      ],
      "title": "Hotfix: define _storeHiddenDefaults to complete hidden-default migration"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "docs/ui/PLACES_HERO_V2_SPEC.md",
        "docs/ui/DASHBOARD_SPEC.md",
        "docs/ui/README.md",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-01_sliceP0_design_spec_stabilization",
      "slice": "P0",
      "summary": [
        "Added canonical UI specs for Places Hero V2 and dashboard behavior to reduce regressions.",
        "Documented locked clock header format, sun pill rules, wind/gust formatting, and the reserved marquee slot constraints.",
        "Updated canonical handoff and next-chat prompt to make the documentation slice the immediate next step."
      ],
      "title": "Docs: stabilize Places Hero V2 and dashboard specs"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT_SENIOR_REVIEW.md",
        "docs/ui/PLACES_HERO_V2_SPEC.md"
      ],
      "id": "patch_2026-01-01_sliceO7n_hero_label_emphasis",
      "slice": "O7n",
      "summary": [
        "Sunrise/Sunset pill title now centers within the pill width (scale-down preserved).",
        "Emphasized key row labels for scanability: Wind, Gust, Sunrise, Sunset, and Rate (higher contrast + heavier weight).",
        "Updated widget tests to tolerate RichText rows and updated the Places Hero V2 spec to match."
      ],
      "title": "Places Hero V2: emphasize labels and center sun title"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-01_sliceO7o_analyzer_clean_places_hero",
      "slice": "O7o",
      "summary": [
        "Removed unused private widget parameters that triggered analyzer warnings.",
        "Renamed local helper closures to satisfy lint rules (no leading underscores for locals).",
        "Kept existing keys and text output stable to avoid test and persistence regressions."
      ],
      "title": "Places Hero V2: analyzer cleanup (no behavior change)"
    },
    {
      "date": "2026-01-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/unitana_tile.dart",
        "app/unitana/test/dashboard_smoke_test.dart",
        "app/unitana/test/dashboard_tile_icon_accent_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-01_sliceR1_tile_footer_convert_cta",
      "slice": "R1",
      "summary": [
        "Replaced the dashboard tile footer copy from “Tap to convert” to “Convert”.",
        "Swapped the footer dot indicator for a conversion icon (swap_horiz) and centered the CTA row.",
        "Updated widget tests to assert the new footer text and icon tinting behavior."
      ],
      "title": "Dashboard tiles: Convert CTA + conversion icon"
    },
    {
      "date": "2026-01-02",
      "files": [
        "docs/ai/reference/SCENEKEY_CATALOG.md",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT_SENIOR_REVIEW.md",
        "docs/ai/context_db.json"
      ],
      "id": "O12d2a-docs-weatherapi-scenekey-catalog",
      "summary": [
        "Documented SceneKey catalog for hero marquee weather scenes, including full WeatherAPI code mapping and revised SMOKE_WILDFIRE concept.",
        "Updated CURRENT_HANDOFF with shipped slice summary, WeatherAPI MVP decision, SceneKey policy, and next-slice breakdown (O12e/O12f/O12g).",
        "Updated senior review next-chat prompt to enforce smaller slices and focus the next slice on Developer Tools Weather overflow hardening."
      ]
    },
    {
      "date": "2026-01-03",
      "files_changed": [
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT_SENIOR_REVIEW.md",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-03_docs_handoff_refresh_senior_transition",
      "slice": "DOCS",
      "summary": [
        "Refreshed CURRENT_HANDOFF to reflect O12e–O12g3 outcomes, current priorities, risks, and lessons learned.",
        "Set next slice definition for O12g4 (WeatherAPI condition.code -> SceneKey -> marquee selection, DevTools override precedence).",
        "Prepared senior-team transition prompt for next chat to reduce scope thrash and enforce one-slice execution."
      ],
      "title": "Handoff refresh + senior transition prompt (post O12g3 stabilization)"
    },
    {
      "date": "2026-01-05",
      "files_changed": [
        "lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart"
      ],
      "id": "patch_2026-01-05_o12j10_tool_modal_terminal_typography",
      "slice": "O12j10",
      "summary": [
        "Strengthened Dracula-terminal feel in tool modals: consistent monospace typography, prompt glyph styling, and improved readability.",
        "Removed all \"$\" prompt prefixes to avoid currency confusion; standardized prompt to \"❯\".",
        "Improved microcopy and affordances: dynamic \"Enter Value\" -> \"Edit Value\" when input present; timestamp rendered as lighter italic meta text."
      ],
      "title": "Tool modal terminal polish (monospace prompt, remove $ prefix, timestamp styling)"
    },
    {
      "date": "2026-01-08",
      "files_changed": [
        "test/time_tool_modal_interaction_test.dart"
      ],
      "id": "patch_2026-01-08_o12k07g_time_tool_test_toolpicker_selection",
      "slice": "O12k07g",
      "summary": [
        "Fixes brittle test coupling to the exact 'Time' label by selecting the first enabled ToolPicker search result whose title contains 'time' (case-insensitive).",
        "Derives toolId from modal keys (tool_input_*) and chooses 12h vs 24h input based on the modal '<from> → <to>' direction label.",
        "Validates conversion output shape plus history tap-to-copy and long-press-to-edit behaviors without relying on list ordering."
      ],
      "title": "Time modal test: robust ToolPicker selection + direction-aware input"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "docs/ai/reference/PLATFORM_ICON_AUDIT.md"
      ],
      "id": "patch_2026-01-09_o12k13d_header_button_equal_size_and_platform_icon_audit",
      "slice": "O12k13d",
      "summary": [
        "Makes the top-left Tools and top-right Menu buttons true mirrors by using a shared header icon button widget with identical size, border, and edge insets.",
        "Adds a lightweight cross-platform launcher icon audit checklist under docs/ai/reference to reduce platform-specific icon regressions."
      ],
      "title": "Dashboard header: equal-size mirrored buttons + platform icon audit doc"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/dashboard_live_data.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_o12k13e_fix_duplicate_devtools_clock_override",
      "slice": "O12k13e",
      "summary": [
        "Fixes analyzer/test failures caused by duplicate definitions of debugClockOffset and setDebugClockOffset in dashboard_live_data.dart.",
        "Clarifies clock override comment as a simulator-only offset (not NTP, not backend sync, not timezone reconfiguration)."
      ],
      "title": "Fix duplicate DevTools clock override symbols (debugClockOffset)"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/test/time_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_o12k13f_stabilize_time_tool_modal_test",
      "slice": "O12k13f",
      "summary": [
        "Updates time_tool_modal_interaction_test.dart to prefer ToolPicker search (toolpicker_search + toolpicker_search_tool_time) instead of relying on lens headers ordering/presence.",
        "Adds fallback paths (direct row, lens expansion, scroll) with a clearer failure message if the ToolPicker contract keys are missing."
      ],
      "title": "Stabilize time tool modal widget test"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_o12k13g_add_devtools_clock_override_ui",
      "slice": "O12k13g",
      "summary": [
        "Adds a Clock Override entry to the Developer Tools sheet (key: devtools_clock_menu) and a dedicated sheet with an enable toggle + offset slider.",
        "Wires the UI to DashboardLiveDataController.setDebugClockOffset so Places Hero time displays can be adjusted for simulator testing without NTP or backend sync."
      ],
      "title": "Add DevTools clock override UI (keys + sheet)"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/test/dashboard_header_button_mirror_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13h_sev1_recovery_dashboard_parse_header_mirror",
      "notes": {
        "guards": [
          "Size equality widget test keyed to dashboard_tools_button and dashboard_menu_button.",
          "Header button sizing centralized via _HeaderIconButton size/radius constants to prevent drift when icons change."
        ],
        "risk": "Low; localized UI block repair + additive test + docs update.",
        "root_cause": "Incomplete edit in the AppBar menu bottom sheet block (mismatched closure/brackets) caused dart format/analyze/test to fail at parse time."
      },
      "slice": "O12k13h",
      "summary": [
        "Fixed a broken/mismatched bracket/brace sequence in DashboardScreen AppBar menu bottom sheet, restoring clean parsing/formatting.",
        "Confirmed Tools (top-left) and Menu (top-right) header buttons remain true mirrors by keeping sizing centralized in _HeaderIconButton.",
        "Added a widget test that asserts dashboard_tools_button and dashboard_menu_button render at identical sizes."
      ],
      "title": "Sev 1 recovery: DashboardScreen parse fix + mirrored header button size guard"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13h1_header_button_exact_mirror_size",
      "notes": {
        "guards": [
          "dashboard_header_button_mirror_test continues to assert equality using stable keys.",
          "Header button sizing remains centralized in _HeaderIconButton to prevent drift."
        ],
        "risk": "Low; only constants updated to match AppBar constraints.",
        "root_cause": "The mirror-size test was correct, but the left button was resolving under tighter AppBar leading constraints; the right button was not. The resulting RenderBox sizes differed (56 vs 44) despite shared widget code."
      },
      "slice": "O12k13h1",
      "summary": [
        "Diagnosed failing mirror-size widget test: AppBar's leading slot constraints were forcing the Tools button subtree to resolve at 56x56 while Menu remained 44x44.",
        "Updated _HeaderIconButton's centralized size/radius to 56/28 (matching AppBar toolbar height) so both dashboard_tools_button and dashboard_menu_button report the same size.",
        "Kept changes localized (no key churn, no modal/ToolPicker changes); this aligns with the 'exact container equality' requirement."
      ],
      "title": "Hotfix: make header Tools/Menu buttons resolve to identical RenderBox size"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/dashboard_currency_modal_context_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13j_currency_modal_place_context",
      "notes": {
        "guards": [
          "dashboard_currency_modal_context_test asserts the Currency modal unit line reflects actual home/destination currencies and swaps with the reality toggle.",
          "Currency inference continues to use device-clock-driven reality; timezones remain display-only."
        ],
        "risk": "Low; parameters are only added at the tile invocation site and are ignored by non-Currency tools.",
        "root_cause": "DashboardBoard opened ToolModalBottomSheet from tile taps without passing home/destination context, so Currency inference fell back to a hardcoded USD/EUR pair. This broke correctness when Home was non-US or Destination was non-EU."
      },
      "slice": "O12k13j",
      "summary": [
        "Dashboard tile taps now pass eurToUsd and home/destination Place context into ToolModalBottomSheet, ensuring Currency defaults and unit labels match the selected reality for non-US/EU home/destination pairs.",
        "Kept the change localized to DashboardBoard tile onTap, with no key churn and no ToolPicker behavior changes.",
        "Added a widget test that inverts the default assumption (EU home, US destination) and asserts the Currency modal unit line swaps correctly when toggling realities."
      ],
      "title": "Fix: Currency modal receives home/destination context from dashboard tiles"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/test/dashboard_currency_modal_context_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13j1_currency_modal_test_dismiss",
      "notes": {
        "guards": [
          "dashboard_currency_modal_context_test now dismisses the bottom sheet using ModalBarrier tap, matching the app's actual presentation model."
        ],
        "risk": "Very low; test-only change and docs update.",
        "root_cause": "The Currency modal test used tester.pageBack(), which relies on finding a CupertinoNavigationBarBackButton. Tool modals use showModalBottomSheet and do not include that back button."
      },
      "slice": "O12k13j1",
      "summary": [
        "Fixed a widget test failure where tester.pageBack() expected a CupertinoNavigationBarBackButton, but tool modals are presented via showModalBottomSheet.",
        "Updated dashboard_currency_modal_context_test to dismiss the modal by tapping the ModalBarrier, keeping the assertion focused on currency directionality rather than navigation affordances.",
        "No production UI or logic changes; keys and tool behavior remain unchanged."
      ],
      "title": "Test fix: Dismiss tool modal via ModalBarrier (bottom sheet), not Cupertino back"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/test/dashboard_currency_modal_context_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13j2_currency_modal_test_dismiss_reliable",
      "notes": {
        "guards": [
          "dashboard_currency_modal_context_test now dismisses via tapAt(10,10) which is consistently outside the bottom sheet.",
          "GoogleFonts runtime fetching is disabled in-test, matching other interaction tests."
        ],
        "risk": "Very low; test-only change and docs update.",
        "root_cause": "A ModalBarrier finder can represent the whole scrim, but tester.tap(barrier.first) uses the widget center, which may be covered by the bottom sheet; the hit test then targets sheet content rather than the scrim, so dismissal does not occur."
      },
      "slice": "O12k13j2",
      "summary": [
        "Fixed flaky/failing dismissal in dashboard_currency_modal_context_test where tapping ModalBarrier's center could land on the bottom sheet instead of the scrim, leaving the modal open and blocking subsequent taps.",
        "Updated dismissToolModal() to tap a safe top-left coordinate (outside the sheet) with warnIfMissed:false, retrying once if the barrier remains.",
        "Aligned with existing modal interaction tests by disabling GoogleFonts runtime fetching to avoid HttpClient warnings and reduce test noise."
      ],
      "title": "Test fix: dismiss bottom sheet reliably (tapAt safe barrier region) + disable runtime font fetching"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/test/dashboard_currency_modal_context_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13j3_currency_modal_test_flutter_compat",
      "notes": {
        "guards": [
          "Modal dismissal remains deterministic by avoiding center-of-barrier taps that can hit-test into the bottom sheet.",
          "Test stays key-based and place-aware (EUR/USD inversion) to catch context regressions."
        ],
        "risk": "Very low; test-only change plus docs.",
        "root_cause": "The warnIfMissed parameter was added in newer Flutter; current repo toolchain does not include it, causing analyze/test compilation failure."
      },
      "slice": "O12k13j3",
      "summary": [
        "Fixed build break on older Flutter where WidgetTester.tapAt() does not support warnIfMissed named parameter.",
        "Updated dashboard_currency_modal_context_test dismiss helper to tap a safe point derived from ModalBarrier top-left (fallback to a fixed point), with a single retry if the barrier remains."
      ],
      "title": "Test fix: remove unsupported tapAt warnIfMissed param; dismiss via barrier top-left"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/length_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13k_enable_length_tool",
      "notes": {
        "guards": [
          "Added a widget interaction test (length_tool_modal_interaction_test) to catch regressions in conversion, history copy, and long-press edit.",
          "ToolModal now treats 'length' the same as 'height' for unit labels and freeform input in the imperial direction."
        ],
        "risk": "Low; additive tool enablement plus localized modal support and new test coverage.",
        "root_cause": "Length existed in the ToolRegistry catalog but was disabled and lacked ToolModal UI affordances (unit labels + freeform input) because the modal special-cased only the Height tool for the canonical length engine."
      },
      "slice": "O12k13k",
      "summary": [
        "Enabled the Length tool under the Home & DIY lens (cm ↔ ft/in) using the existing canonical length engine.",
        "Extended ToolModalBottomSheet unit-label and input-mode handling to support toolId 'length' (including freeform input in the imperial direction).",
        "Added a widget interaction test that covers conversion, history copy, and long-press edit for the Length tool.",
        "Updated canonical docs and captured the Radio feature as a docs-only backlog item."
      ],
      "title": "Tool surface: enable Length tool (cm ↔ ft/in) + modal support + interaction test"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/test/length_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13k1_length_modal_test_hotfix",
      "notes": {
        "guards": [
          "Use the same harness pattern across tool modal tests (UnitanaAppState + seeded Places) to prevent drift as state management evolves.",
          "Assertions validate conversion shapes via keys and stable output tokens (units / numbers) rather than relying on ordering or translated strings."
        ],
        "risk": "Low; test-only changes plus doc bookkeeping.",
        "root_cause": "The Length interaction test was introduced with imports targeting a removed controllers directory, causing analyzer failures even though runtime code was healthy."
      },
      "slice": "O12k13k1",
      "summary": [
        "Removed deprecated dashboard controller imports from the Length modal interaction widget test.",
        "Aligned the test with the canonical DashboardScreen + UnitanaAppState harness used by the other tool modal tests (seeded Places + SharedPreferences mocks).",
        "Tightened assertions to tolerate direction differences (imperial vs metric) without depending on locale-sensitive labels."
      ],
      "title": "Test hotfix: align Length modal interaction test with current Dashboard/AppState plumbing"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/test/weight_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13l_weight_modal_interaction_test",
      "notes": {
        "guards": [
          "Uses ToolPicker lens + tool key selection rather than depending on ordering or visible text labels.",
          "Validates output via the tool_result key and invariant unit tokens (kg/lb) while tolerating direction differences based on active reality."
        ],
        "reason": "Phase A tool surface completion needs consistent interaction coverage across core converters; Weight lacked a regression test while other primitives (distance/speed/temp/time/area/length) already had one.",
        "risk": "Low; test-only coverage plus docs bookkeeping."
      },
      "slice": "O12k13l",
      "summary": [
        "Added a widget interaction test for the Weight tool modal that validates conversion output, history tap-to-copy, and long-press-to-edit behaviors.",
        "Test avoids locale-sensitive text finders and validates stable output tokens via keys and invariant unit strings (kg/lb)."
      ],
      "title": "Tests: add Weight tool modal interaction coverage (convert + history copy + long-press edit)"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/weight_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13m_time_tile_24h_swap_weight_test_clipboard_units",
      "notes": {
        "reason": "User testing found Time tile did not track the hero's 12/24 preference; latest patch produced a widget-test failure due to units included in clipboard copy.",
        "risk": "Low; Time behavior change is limited to dashboard preview label ordering. Test-only adjustment reduces brittleness without changing app behavior."
      },
      "slice": "O12k13m",
      "summary": [
        "Fixed Time dashboard tile preview to mirror the active place's 12/24-hour preference (Place.use24h), matching Places Hero behavior.",
        "Updated Weight modal interaction test to validate the copied numeric value even when the clipboard includes units (e.g., '22.0 lb')."
      ],
      "title": "Time tile: honor 12/24 preference; Tests: tolerate units in copied weight output"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/test/weight_tool_modal_interaction_test.dart",
        "app/unitana/test/dashboard_currency_modal_context_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13m1_test_hardening_weight_currency_units_parsing",
      "notes": {
        "reason": "Merge gates failed due to brittle test expectations when the UI includes units in rehydrated input or changes formatting of the currency units label.",
        "risk": "Very low; test-only changes that increase resilience while preserving key-based assertions."
      },
      "slice": "O12k13m1",
      "summary": [
        "Weight modal interaction test now validates rehydrated input numerically (accepts '10' or '10 kg') and copies numeric output regardless of units.",
        "Currency modal context test now asserts base currency swaps (EUR home, USD destination) without assuming a specific arrow/format in the units label."
      ],
      "title": "Tests: harden Weight long-press rehydrate + Currency units base parsing"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/test/dashboard_currency_modal_context_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13m2_remove_warnIfMissed_param_in_currency_test",
      "notes": {
        "reason": "flutter analyze / flutter test failed because the pinned Flutter SDK does not define the `warnIfMissed` parameter on WidgetTester.tapAt.",
        "risk": "Very low; test-only change to restore compilation."
      },
      "slice": "O12k13m2",
      "summary": [
        "Removed the unsupported WidgetTester.tapAt named parameter `warnIfMissed` to maintain compatibility with the project's pinned Flutter SDK.",
        "Kept the same bottom-sheet dismissal strategy (tap a safe coordinate) without changing app behavior."
      ],
      "title": "Tests: remove unsupported warnIfMissed parameter from currency modal dismissal"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/test/dashboard_currency_modal_context_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13m3_currency_modal_test_direction_agnostic",
      "notes": {
        "reason": "Test was failing because the app's conversion direction logic treated USD as the base currency in Home reality for the seeded PT/US pair; the test wrongly assumed EUR was always base in Home reality.",
        "risk": "Very low; test-only assertion change. No production behavior changes."
      },
      "slice": "O12k13m3",
      "summary": [
        "Updated the currency modal context test to assert that toggling the Places Hero flips the ordered currency pair, without assuming which side is 'base' in a given reality.",
        "Added a helper to parse ordered ISO currency codes from the units label (with symbol fallback) to make the test resilient to label formatting changes."
      ],
      "title": "Tests: make currency modal context test direction-agnostic to match hero reality semantics"
    },
    {
      "date": "2026-01-09",
      "files_changed": [
        "app/unitana/test/dashboard_currency_modal_context_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-09_O12k13m4_remove_unused_helpers_in_currency_context_test",
      "notes": {
        "reason": "flutter analyze reported unused_element warnings for local helper declarations in the currency modal context test.",
        "risk": "Very low; test-only cleanup."
      },
      "slice": "O12k13m4",
      "summary": [
        "Removed unused baseCurrency/hasCurrency helper functions in dashboard_currency_modal_context_test.dart to eliminate flutter analyze unused_element warnings.",
        "No behavior changes; test assertions remain key-based and direction-agnostic."
      ],
      "title": "Tests: remove unused helper declarations to clear analyzer warnings"
    },
    {
      "date": "2026-01-10",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/dashboard_time_tile_reality_switch_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-10_O12k13o_C1_time_tile_12_24_fix_and_test",
      "notes": [
        "Bug root cause: a word-boundary regex in dashboard_board.dart contained an invisible control character instead of \\\\b, so AM/PM detection never matched and labels did not swap.",
        "Guard: widget test validates that AM/PM is primary for 12h places and secondary for 24h places, without relying on exact strings or tool ordering."
      ],
      "slice": "O12k13o (C1)",
      "summary": "Fix Time tile 12h/24h swap to follow the active place (Home/Destination) use24h preference; add a regression test that asserts the Time tile format flips with the reality toggle; document the broader Hero cockpit strategy in CURRENT_HANDOFF."
    },
    {
      "date": "2026-01-10",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/time_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-10_O12k13p_time_tool_modal_respects_prefer24h",
      "notes": {
        "guards": [
          "ToolModalBottomSheet now takes prefer24h (default false) and uses it for canonical time conversions.",
          "Widget test asserts default direction is 24h->12h for a 24h-configured imperial place, and flips to 12h->24h when switching to a 12h-configured metric place."
        ],
        "risk": "Low; additive parameter with safe default plus test coverage.",
        "root_cause": "Time tool direction was incorrectly tied to preferMetric, which fails when a place is configured to 24h while using imperial (or 12h while using metric)."
      },
      "slice": "O12k13p",
      "summary": [
        "Added an explicit prefer24h flag to ToolModalBottomSheet so Time (12h/24h) defaults follow the active Places Hero reality, independent from metric/imperial.",
        "Wired prefer24h through DashboardScreen (ToolPicker path) and dashboard tile taps.",
        "Strengthened time_tool_modal_interaction_test by seeding places where unitSystem and use24h intentionally diverge, and asserting the modal flips direction when switching realities."
      ],
      "title": "Fix: Time tool modal defaults to 12h/24h based on active place (not metric)"
    },
    {
      "date": "2026-01-10",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-10_O12k13q_C3a_sliver_migration_foundation",
      "notes": {
        "risk": "Low; scroll container type change only. Existing DashboardBoard layout, keys, and tests remain untouched.",
        "scope": "C3a only: structural migration to slivers; no pinned header, no hero layout changes, no new keys."
      },
      "slice": "O12k13q (C3a)",
      "summary": [
        "Replaced the DashboardScreen body SingleChildScrollView with a CustomScrollView using SliverPadding + SliverToBoxAdapter.",
        "Kept behavior identical for now (hero and tiles still scroll together), but unlocked the next slice to introduce a compact pinned header without a risky rewrite."
      ],
      "title": "Dashboard: migrate to slivers foundation (no behavior change)"
    },
    {
      "date": "2026-01-10",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-10_O12k13r1_currency_modal_place_context",
      "notes": {
        "tests": "Fixes dashboard_currency_modal_context_test by ensuring Currency units are derived from actual home/destination places."
      },
      "slice": "O12k13r1",
      "summary": [
        "Fixed a regression where opening Currency from a dashboard tile lacked place context, causing the default units to fall back to USD→EUR regardless of selected reality.",
        "Dashboard tile modal invocation now passes home + destination Place objects and the live EUR→USD rate into ToolModalBottomSheet so defaults align with Places Hero selection."
      ],
      "title": "Currency modal: pass home/destination context from dashboard tiles"
    },
    {
      "date": "2026-01-10",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/test/dashboard_test_helpers.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-10_O12k13r2_pinned_overlay_compile_fixes",
      "notes": {
        "tests": "Unblocks dashboard_pinned_hero_overlay_test.dart by providing the imported helper and removing compile-time type errors."
      },
      "slice": "O12k13r2",
      "summary": [
        "Fixed pinned overlay compile errors by passing Place into liveData.weatherFor(...) and comparing Place.unitSystem string against \"metric\".",
        "Added a minimal dashboard_test_helpers.dart with pumpDashboardForTest() to support pinned overlay widget tests without duplicating setup code."
      ],
      "title": "Pinned hero overlay: compile fixes + add shared dashboard test helper"
    },
    {
      "date": "2026-01-10",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/test/dashboard_pinned_hero_overlay_test.dart",
        "app/unitana/test/dashboard_currency_modal_context_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-10_O12k13r8_pinned_overlay_test_determinism",
      "notes": {
        "tests": "Stabilized pinned overlay overlay test and ensured currency direction test aligns with the global reality toggle contract.",
        "why": "The overlay segments existed in the tree but were not hit-testable when the visibility threshold was not reached in widget tests (insufficient scroll extent). The hook keeps runtime behavior unchanged while stabilizing CI gates."
      },
      "slice": "O12k13r8",
      "summary": [
        "Added a @visibleForTesting flag on DashboardScreen to force the pinned hero overlay visible in a single targeted widget test, avoiding flaky scroll-threshold dependence.",
        "Updated pinned overlay widget test to rely on stable keys (dashboard_item_baking) instead of visible text, and to set/clear the force-visible flag via tearDown.",
        "Replaced currency modal context test with a key-only assertion that currency direction follows Places Hero reality (Home: EUR->USD, Destination: USD->EUR)."
      ],
      "title": "Sev 1 test stabilization: pinned overlay deterministic + currency modal context"
    },
    {
      "date": "2026-01-10",
      "files_changed": [
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT_SENIOR_REVIEW.md",
        "docs/ai/retros/RETRO_2026-01-10_O12k13r_SEV1.md"
      ],
      "id": "patch_2026-01-10_O12k13r9_to_r20_sev1_stabilization_series",
      "notes": {
        "follow_up": "If desired, backfill the series into discrete patch_log entries by extracting each changed-files zip and recording its exact file list.",
        "why": "During the incident we produced many small hotfix zips (UI + test) to keep merge gates green. The canonical patch log in this repo snapshot ended at O12k13r8, so this entry records the remainder as a single consolidated series for traceability."
      },
      "slice": "O12k13r9-r20",
      "summary": [
        "Consolidated the remaining Sev 1 follow-on patches after O12k13r8 that were delivered as small changed-files-only bundles during active troubleshooting.",
        "Stabilized widget tests by removing reliance on lens expansion state and visible text, preferring ToolPicker search-result rows and stable keys.",
        "Standardized bottom-sheet dismissal in tests to deterministic corner taps (rather than relying on ModalBarrier hit-testing), eliminating intermittent hit-test warnings.",
        "Fixed widget-test scrolling usage by providing a Scrollable finder (not CustomScrollView) to scrollUntilVisible/drag helpers.",
        "Aligned currency context expectations to the Places Hero reality contract (Home vs Destination drives currency direction), and ensured modal launches receive the correct place context.",
        "Normalized clipboard-copy behavior for unit-suffixed outputs (notably weight) to match existing numeric-only copy expectations in tests."
      ],
      "title": "Sev 1 stabilization series: pinned Hero cockpit + test determinism + modal/toolpicker hardening"
    },
    {
      "date": "2026-01-11",
      "files": [
        "unitana/app/unitana/lib/features/dashboard/dashboard_screen.dart"
      ],
      "id": "patch_2026-01-11_LINT2_pulse_swap_icon_test_safe",
      "notes": [
        "Uses FLUTTER_TEST environment flag and a TestWidgetsFlutterBinding runtimeType fallback to detect tests."
      ],
      "slice": "C7-followup",
      "summary": [
        "Changed the pinned overlay details pill swap icon pulse to only animate when not running under widget tests and when animations are enabled.",
        "Prevents flutter_test pumpAndSettle timeouts caused by a repeating AnimationController in the dashboard pinned overlay."
      ],
      "title": "Make pinned details swap icon pulse test-safe (prevents pumpAndSettle timeouts)"
    },
    {
      "date": "2026-01-11",
      "files": [
        "unitana/app/unitana/lib/features/dashboard/models/dashboard_session_controller.dart",
        "unitana/docs/ai/handoff/CURRENT_HANDOFF.md",
        "unitana/docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-11_H2_handoff_refresh_and_pinned_mode_api",
      "notes": [
        "This slice is documentation-first (handoff accuracy) plus a small API compatibility fix based on the attached flutter analyze log."
      ],
      "slice": "H2",
      "summary": [
        "Updated CURRENT_HANDOFF.md to reflect the actual completed slices (C3c→C7, TZ fixes, tests) and to capture current priorities and backlog.",
        "Ensures DashboardSessionController exposes PinnedHeroDetailsMode, pinnedHeroDetailsMode, and togglePinnedHeroDetailsMode so dashboard_screen.dart compiles cleanly after recent refactors."
      ],
      "title": "Refresh handoff + restore pinned hero details mode API for dashboard screen"
    },
    {
      "date": "2026-01-12",
      "files": [
        "unitana/app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "unitana/app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "unitana/docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-12_T6_round15_dashboard_remove_action_key_and_test_fix",
      "notes": [
        "Key schema: dashboard_tile_action_replace_<itemId>, dashboard_tile_action_remove_<itemId>."
      ],
      "slice": "T6",
      "summary": [
        "Added stable keys for tile action sheet items (replace/remove) so tests can tap actions without relying on visible strings.",
        "Updated dashboard_tool_insertion_persistence_test to tap the remove action by key (with a delete-icon fallback) to avoid missed-longpress and localization brittleness."
      ],
      "title": "Stabilize dashboard tile remove action via keys (no string assertions)"
    },
    {
      "files_changed": [
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-12_T6_round17_dashboard_remove_test_distance_entry_fix",
      "slice": "T6",
      "summary": "Fix dashboard_tool_insertion_persistence_test to target user-added Distance entry from persisted layout (no list-order dependency) and rely on remove action keys only."
    },
    {
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-12_T6_round20_dashboard_item_hit_test_fix",
      "slice": "T6",
      "summary": "Make dashboard_item_<id> key hit-testable by moving it onto a RenderBox-backed wrapper (SizedBox) and simplify the persistence removal test to long-press the keyed item reliably."
    },
    {
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/canonical_tools.dart",
        "app/unitana/lib/features/dashboard/models/tool_lens_map.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/volume_tool_modal_interaction_test.dart",
        "app/unitana/test/pressure_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-13_S5_volume_pressure_tools",
      "slice": "S5",
      "summary": "Enable Volume and Pressure tools in the picker, wire converters + default directions, and add targeted modal interaction widget tests."
    },
    {
      "changes": [
        "Adjust volume and pressure widget tests to assert value-first strings (unit implied by icon/output unit)",
        "No runtime behavior changes; tests only"
      ],
      "files_changed": [
        "app/unitana/test/volume_tool_modal_interaction_test.dart",
        "app/unitana/test/pressure_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-13_S5b_volume_pressure_tests_value_first",
      "sev": "Sev1-followup",
      "slice": "S5b",
      "title": "Hotfix: Volume/Pressure modal tests match value-first history strings"
    },
    {
      "changes": [
        "Enable Shoe Sizes in Tool Registry and wire it into ToolDefinitions + canonical tool ids.",
        "Add EU ↔ US (men) lookup conversion (nearest match) with UK/JP hint values; keep value-first output.",
        "Add a targeted widget test that adds the tool from the picker and verifies a stable US→EU conversion result."
      ],
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/canonical_tools.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_lens_map.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/shoe_sizes_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-13_S6_shoe_sizes_tool_us_eu",
      "sev": "Sev1-hardening",
      "slice": "S6",
      "title": "Add Shoe Sizes tool (EU ↔ US M) with UK/JP hints + modal test"
    },
    {
      "changes": [
        "Wind/Gust details: make wind lines value-first (gust implied via suffix), tighten typography/spacing to fit locked pill heights, and label the pill \"Wind / Gust\" for parity with \"Sunrise / Sunset\".",
        "Tool modal history: tap now confirms \"Copied result\"; long-press now copies the original input to the clipboard and confirms \"Copied input\" (no longer mutates the entry field). Add concise helper copy next to the History header.",
        "Update widget test(s) to match the new long-press history contract and ensure dashboard remove persistence test targets the persisted tile id rather than a synthesized key."
      ],
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "app/unitana/test/weight_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-13_S6b_wind_overflow_history_copy_hotfix",
      "sev": "Sev1-hardening",
      "slice": "S6b",
      "title": "Fix Wind/Gust pill overflow, align Wind copy; switch history long-press to copy input; restore persistence test robustness"
    },
    {
      "changes": [
        "Tool modal header row: relocate swap control directly adjacent to the unit pair label (vertically aligned), reinforcing the relationship between units and swap.",
        "Swap control: add subtle pulse/flash affordance consistent with hero pill swap indicator.",
        "History pane: increase visual weight and height, reducing dead space and reading more like a terminal panel while preserving Dracula palette."
      ],
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-13_S6c_tool_modal_swap_and_history_panes",
      "sev": "Sev1-quality",
      "slice": "S6c",
      "title": "Tool modals: move swap icon next to unit display, align vertically, add swap pulse, and expand history pane for terminal feel"
    },
    {
      "changes": [
        "Places hero Wind/Sun details pill: enforce fixed height (compact 44, expanded 92) and internal scale-down so Sun and Wind modes never change bounds and never overflow in mini/pinned constraints.",
        "Reduce compact vertical spacing in Wind/Sun pill rows; keep value-first copy and Wind/Gust parity.",
        "Remove unnecessary flutter/rendering import (and lock in via a small test header comment) to keep flutter analyze green."
      ],
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-13_S6d_wind_pill_bounds_lock_and_analyze_fix",
      "sev": "Sev1-hardening",
      "slice": "S6d",
      "title": "Lock Wind/Sun pill bounds to prevent jitter/overflow; fix analyze failure in dashboard persistence test"
    },
    {
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-13_S6e_tool_modal_swap_history_fix",
      "slice": "S6",
      "summary": "Fix tool modal compile regression by restoring ToolModalBottomSheet structure; keep swap control visually tied to unit display with pulsing icon, resize history pane, and change history interactions to copy result/input (no more 'Editing value')."
    },
    {
      "date": "2026-01-13",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/currency_tool_modal_interaction_test.dart",
        "app/unitana/test/temperature_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-13_S6i_tool_modal_clipboard_contract_tests",
      "notes": {
        "reason": "Fix failing widget tests and lock the tool history gesture contract (tap copies result, long-press copies input) without reintroducing input-field restore/edit regressions.",
        "risk": "Low; behavior is additive safeguards and default-direction tweak for Shoe Sizes only."
      },
      "slice": "S6i",
      "summary": [
        "Tool modals: long-press on history now guarantees clipboard-only (no input field restore), trims trailing .0/.00 for clipboard friendliness (e.g., 10.00 -> 10), and guards against accidental controller mutation regressions.",
        "Shoe Sizes: default direction is now stable US M -> EU regardless of active reality; users can swap direction manually.",
        "Widget tests: scope tool modal interactions to the modal scrollable so history taps are always hit-testable on small test surfaces."
      ],
      "title": "Tools: stabilize history clipboard contract + fix Shoe Sizes default direction"
    },
    {
      "date": "2026-01-13",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/temperature_tool_modal_interaction_test.dart",
        "app/unitana/test/currency_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "patch_2026-01-13_S6k_tool_modal_scroll_tests_hotfix",
      "notes": {
        "reason": "Fix failing widget tests after tool modal refactor; remove patch log duplication found in context_db.json.",
        "risk": "Low; cacheExtent increase is localized to modal and only affects offscreen build caching."
      },
      "slice": "S6k",
      "summary": [
        "Tool modal: increased cacheExtent on the modal body ListView so history widgets build reliably on small test surfaces (prevents 'history not found' flake from lazy sliver construction).",
        "Widget tests: use the Scrollable descendant inside the keyed ListView when calling scrollUntilVisible (prevents ListView→Scrollable cast failure)."
      ],
      "title": "Tools: stabilize modal scroll + fix test scrollable finders"
    },
    {
      "date": "2026-01-13",
      "files_changed": [
        "app/unitana/test/currency_tool_modal_interaction_test.dart",
        "app/unitana/test/temperature_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-13_S6l_tool_modal_test_scroll_robustness",
      "notes": {
        "reason": "Fix the latest widget test failures reported in error.log: history row not found due to lazy build, and scrollable finder returning multiple nested Scrollables.",
        "risk": "Low; test-only behavior changes plus documentation update."
      },
      "slice": "S6l",
      "summary": [
        "Widget tests: stop assuming the modal contains a single Scrollable; use ensureVisible and a small drag loop to bring History rows into the hit-testable viewport.",
        "Stabilizes Temperature + Currency modal regression tests across Flutter versions by avoiding brittle Scrollable descendant counting and lazy-build variance."
      ],
      "title": "Tools: make modal widget tests resilient to nested scrollables"
    },
    {
      "date": "2026-01-14",
      "files_changed": [
        "app/unitana/test/temperature_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-14_S6m_temperature_copy_notice_assertion",
      "notes": {
        "reason": "Fix failing widget test expecting \"Copied result\" when the notice text is not present/varies at runtime in test runs.",
        "risk": "Low; test-only assertion change plus documentation update."
      },
      "slice": "S6m",
      "summary": [
        "Widget tests: stop hard-coding the exact notice copy string for History row copy; assert on the modal notice surface and a more resilient \"Copied\" confirmation.",
        "Keeps the behavioral contract (tap copies result, long-press copies input) while avoiding flakiness from notice text iteration."
      ],
      "title": "Tests: stabilize Temperature copy confirmation assertion"
    },
    {
      "date": "2026-01-14",
      "files_changed": [
        "app/unitana/test/temperature_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-14_S6n_temperature_notice_pump_stabilization",
      "notes": {
        "reason": "Fix failing Temperature regression test where notice widget key is not found because pumpAndSettle can advance time past the notice auto-dismiss.",
        "risk": "Low; test-only change plus documentation update."
      },
      "slice": "S6n",
      "summary": [
        "Widget tests: replace pumpAndSettle after History copy gestures with bounded pump steps so the 2s auto-dismiss timer cannot elapse during settling.",
        "Eliminates a flaky false-negative where the notice card is removed before assertions run on small surfaces."
      ],
      "title": "Tests: prevent pumpAndSettle from skipping past Temperature copy notice"
    },
    {
      "date": "2026-01-14",
      "files_changed": [
        "app/unitana/test/temperature_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-14_S6o_temperature_clipboard_channel_assertion",
      "notes": {
        "reason": "Fix persistent widget test failure where the notice surface key is not present at assertion time; Clipboard channel interception is the most stable contract-level check.",
        "risk": "Low; test-only changes plus documentation update."
      },
      "slice": "S6o",
      "summary": [
        "Widget tests: intercept SystemChannels.platform Clipboard.setData calls and assert copy behavior without depending on transient notice UI timing.",
        "Replaces flaky notice-card assertions in the Temperature tool modal regression test with deterministic clipboard write expectations."
      ],
      "title": "Tests: assert Temperature copy behavior via Clipboard channel"
    },
    {
      "date": "2026-01-14",
      "files_changed": [
        "app/unitana/tools/icon_audit.sh",
        "app/unitana/tools/verify.sh",
        "tools/icon_audit.sh",
        "tools/verify.sh",
        "docs/ai/reference/PLATFORM_ICON_AUDIT.md",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-14_S7a_platform_icon_audit_execution",
      "notes": {
        "non_negotiables": "No widget API changes; no UI layout impact; guard is lightweight and build-free.",
        "reason": "Icon audit scripts existed in app/unitana/tools but were path-broken (double app/unitana) and the monorepo root tools/ scripts had drifted; this slice makes the guard executable and aligns docs + wrappers."
      },
      "slice": "S7a",
      "summary": [
        "Fixes app/unitana/tools/icon_audit.sh and verify.sh path resolution so they correctly locate the Flutter root when run from any working directory.",
        "Adds monorepo wrappers tools/icon_audit.sh and tools/verify.sh to keep the documented commands stable and prevent future drift.",
        "Updates PLATFORM_ICON_AUDIT.md to document both monorepo-root and app-root invocation."
      ],
      "title": "Platform icon audit: make icon guard runnable from monorepo root and app root"
    },
    {
      "date": "2026-01-14",
      "files_changed": [
        "docs/ai/reference/MULTI_UNIT_UX_CONTRACT.md",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-14_S7b_multi_unit_ux_contract",
      "notes": {
        "non_negotiables": "No widget API changes; stable keys remain required; tests still assert clipboard behavior via channel interception.",
        "risk": "Low; documentation + context metadata only."
      },
      "slice": "S7b",
      "summary": [
        "Adds a canonical UX contract for multi-unit tools to prevent \"From/To\" form sprawl and keep modals one-thought-wide.",
        "Records the selector strategy decision (unit pills open a compact selector; secondary outputs behind a More units sub-sheet).",
        "Dedupes the accidental duplicate S7a patch_log entry."
      ],
      "title": "Docs: multi-unit conversion UX contract (pills + compact selector + optional More units)"
    },
    {
      "date": "2026-01-14",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-14_S7c_volume_pressure_multi_unit_pills",
      "notes": {
        "non_negotiables": "No public widget API churn; stable keys preserved for existing tests (tool_units_*, tool_swap_*).",
        "risk": "Medium; touches tool modal UI and conversion routing for two tools. Other tools remain unchanged."
      },
      "slice": "S7c",
      "summary": [
        "Upgrades Volume and Pressure tool modals from fixed dual-unit labels to unit pills that open a compact selector (From/To), while keeping other tools on the existing dual-unit pattern.",
        "Expands conversion support for Volume (mL, L, pt, qt, gal) and Pressure (kPa, psi, bar, atm) via a narrow multi-unit converter path.",
        "Keeps swap behavior stable; swap now swaps the selected units for these tools without affecting other tools."
      ],
      "title": "Medium: multi-unit unit pills + selector for Volume and Pressure"
    },
    {
      "date": "2026-01-14",
      "files_changed": [
        "app/unitana/test/volume_tool_modal_interaction_test.dart",
        "app/unitana/test/pressure_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-14_S7d_volume_pressure_tests_prompt_marker",
      "notes": [
        "Test-only change; no production widget code or public APIs modified."
      ],
      "slice": "S7d",
      "summary": [
        "Updates Volume and Pressure modal widget tests to tolerate the optional prompt marker prefix (e.g. \"> \") used in history/result rendering.",
        "Updates expectations to accept the post-multi-unit result format that includes the input unit (e.g. \"10 L → 2.6 gal\", \"10 kPa → 1.5 psi\").",
        "Keeps backward-compatible acceptors so older builds or default-unit flips do not break the tests."
      ],
      "title": "Fix: stabilize Volume/Pressure modal tests after multi-unit pills"
    },
    {
      "date": "2026-01-14",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_layout_controller.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-14_S7h_dashboard_drag_drop_reorder_jiggle",
      "notes": {
        "non_negotiables": "No public widget API changes; existing long-press actions and stable Keys preserved.",
        "risk": "Medium; modifies dashboard edit-mode interactions + introduces new persistence key for default tool anchors."
      },
      "slice": "S7h",
      "summary": [
        "Adds a subtle jiggle animation to dashboard tiles while in edit mode.",
        "Introduces drag handles on editable tiles and enables drag-and-drop reordering across occupied tiles and empty add-slots.",
        "Persists reordering via per-tile anchor indices; default tool tiles now support persisted anchor overrides when reordered."
      ],
      "title": "Dashboard: drag-and-drop widget reordering in edit mode (jiggle + anchors)"
    },
    {
      "date": "2026-01-14",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-14_S7i_dashboard_board_named_param_comma_hotfix",
      "notes": {
        "risk": "Low; syntax-only change.",
        "root_cause": "Dart does not allow a comma after the closing '}' of the named-parameter section; trailing commas belong inside the braces."
      },
      "slice": "S7i",
      "summary": [
        "Fixes a Dart syntax error in DashboardBoard._buildTile caused by a trailing comma after the named-parameter section.",
        "Restores green gates for the S7h drag-and-drop dashboard reorder slice without changing behavior."
      ],
      "title": "Hotfix: dashboard board compile error (named-parameter section trailing comma)"
    },
    {
      "date": "2026-01-14",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-14_S7j_drag_drop_green_gates_hotfix",
      "notes": {
        "risk": "Low; behavior unchanged aside from jiggle being finite instead of continuous.",
        "why": "flutter analyze treated deprecation infos as issues; dashboard persistence tests timed out due to an always-animating jiggle controller in edit mode."
      },
      "slice": "S7j",
      "summary": [
        "Replaces deprecated DragTarget onWillAccept/onAccept with onWillAcceptWithDetails/onAcceptWithDetails and cleans builder args to satisfy analyzer.",
        "Updates edit-mode jiggle to a finite entry shake (no repeating ticker) so widget tests using pumpAndSettle can complete reliably.",
        "Replaces deprecated Color.withOpacity usage with withAlpha equivalents."
      ],
      "title": "Hotfix: drag-and-drop dashboard (remove deprecated DragTarget callbacks, finite shake for test settle)"
    },
    {
      "date": "2026-01-14",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/dashboard_tool_insertion_persistence_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-14_S7k_dashboard_reorder_continuous_jiggle_drag_handle",
      "notes": {
        "risk": "Low-medium; touch/scroll gesture interactions affected only in edit mode.",
        "testing": "Avoid pumpAndSettle after edit-mode entry; use bounded pump loops instead to prevent timeouts with continuous tickers.",
        "ux": "Matches iOS/Android launcher behavior: once in edit mode, tiles keep gently moving and drag starts immediately from the handle."
      },
      "slice": "S7k",
      "summary": [
        "Restores a continuous (home-screen style) jiggle while dashboard edit mode is active.",
        "Makes the reorder control an immediate drag handle (no long-press required) with a larger hit target and clearer hand icon.",
        "Updates the dashboard persistence widget tests to use bounded pumps while edit mode is active (continuous animation means pumpAndSettle will not converge)."
      ],
      "title": "Dashboard edit-mode polish: continuous jiggle, immediate drag handle, tests updated to avoid pumpAndSettle in edit mode"
    },
    {
      "date": "2026-01-14",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/unitana_tile.dart",
        "docs/ai/context_db.json"
      ],
      "id": "patch_2026-01-14_S7l_dashboard_drag_unbounded_width_hotfix",
      "notes": {
        "reason": "Dragging tiles builds a feedback widget in an Overlay with unbounded constraints; hard-coding infinite width triggered a RenderFittedBox layout crash.",
        "risk": "Low; only affects width behavior under unbounded constraints and preserves existing bounded layout."
      },
      "slice": "S7l",
      "summary": [
        "UnitanaTile: stop forcing width=double.infinity when parent constraints are unbounded (e.g., drag feedback overlay); use bounded width when available, otherwise allow shrink-wrap.",
        "Prevents RenderBox layout exception during drag start so reorder gesture can proceed."
      ],
      "title": "Dashboard: fix drag overlay infinite-width crash"
    },
    {
      "date": "2026-01-15",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json"
      ],
      "id": "S7o",
      "notes": [
        "Replaced single-line if returns with braced blocks to satisfy analyzer lint without behavior changes."
      ],
      "title": "Fix lint: curly_braces_in_flow_control_structures in places_hero_v2.dart"
    },
    {
      "date": "2026-01-15",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/data_refresh_status_label.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "docs/ai/context_db.json"
      ],
      "id": "S7p",
      "notes": [
        "Adds DataRefreshStatusLabel: provider-agnostic 'Updated X ago' (or 'Updating…', 'Stale (…)') with a safe 60s UI ticker.",
        "Moves refresh messaging out of the hero marquee visual surface (no longer covering the animation); renders a small right-rail label instead.",
        "Adds a subtle dashboard header-line status (under AppBar, above the board) to show last refresh without changing AppBar height.",
        "Optionally triggers an automatic refresh when live weather is enabled and data is missing/stale, with a 30s guard to avoid spam."
      ],
      "title": "Weather refresh status UX: provider-agnostic label, header timestamp, and minute-ticking age"
    },
    {
      "date": "2026-01-16",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json"
      ],
      "id": "S7y",
      "notes": [
        "Removes the hero-level right-rail refresh badge under the marquee so the marquee and detail pill keep full space; dashboard header status remains the single source of truth.",
        "Centers Wind/Gust content within the swappable details pill while keeping Sunrise/Sunset left-aligned.",
        "Removes redundant \"gust\" suffix from gust line formatting (pill + left block) for cleaner readability.",
        "Sunrise/Sunset rows remain timezone-label free; timezone is implied by the main hero clock line."
      ],
      "title": "Hero right-rail refresh badge regression fix and Wind/Gust centering"
    },
    {
      "date": "2026-01-16",
      "files": [
        "app/unitana/test/weather_summary_tile_open_smoke_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "S7z",
      "notes": [
        "Adds a widget smoke test that taps the Weather Summary dashboard tile, opens the read-only sheet, and asserts core labels for both places without depending on network.",
        "Uses stable tile keys via SharedPreferences seeding to keep persistence and test behavior aligned."
      ],
      "title": "Weather Summary: add minimal smoke test for tile open + core labels"
    },
    {
      "date": "2026-01-16",
      "files": [
        "app/unitana/test/weather_summary_tile_open_smoke_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "S7z1",
      "notes": [
        "Allows either 'Not updated yet' or 'Updated X ago' to satisfy the refresh label assertion, preventing flake when live refresh updates lastRefreshedAt during sheet open.",
        "Makes place header checks resilient to dot spacing and typography differences."
      ],
      "title": "Test fix: Weather Summary refresh label assertion is non-flaky"
    },
    {
      "date": "2026-01-16",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "docs/ai/context_db.json"
      ],
      "id": "S8a",
      "notes": [
        "Distance tool now uses From/To unit pills with compact selector sheet, matching the Volume/Pressure/Weight UX contract.",
        "Adds distance unit set and conversion mapping (meters base) without changing public widget APIs."
      ],
      "title": "Tools: Distance adopts multi-unit pills (m, km, mi, ft, in)"
    },
    {
      "date": "2026-01-16",
      "files": [
        "app/unitana/test/distance_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "S8a1",
      "notes": [
        "Updates widget test to read From/To unit labels via stable keys instead of casting the units label to Text.",
        "Prevents type cast failures after Distance switched to pill-based unit selection."
      ],
      "title": "Test fix: Distance tool modal expects multi-unit Row, not Text"
    },
    {
      "date": "2026-01-16",
      "files": [
        "tools/icon_audit.sh",
        "tools/verify.sh",
        "docs/ai/context_db.json"
      ],
      "id": "S8b",
      "notes": [
        "Adds monorepo-root wrappers that delegate to app/unitana/tools scripts, matching the PLATFORM_ICON_AUDIT doc path.",
        "Ensures icon audit is accessible from repo root and can be included in standard verification flows."
      ],
      "title": "Platform icon audit: monorepo wrappers for icon_audit and verify"
    },
    {
      "date": "2026-01-16",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/weather_summary_bottom_sheet.dart",
        "docs/ai/context_db.json"
      ],
      "id": "S8c",
      "notes": [
        "Adds a top-right Close icon button for the read-only Weather Summary sheet with stable key 'weather_summary_close'.",
        "Keeps weather refresh UX unchanged; close affordance is purely navigational."
      ],
      "title": "Weather Summary sheet: add top-right Close (X) action"
    },
    {
      "date": "2026-01-16",
      "files": [
        "app/unitana/test/dashboard_reorder_persistence_breakpoints_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P0.2",
      "notes": [
        "Adds a widget test that reorders tiles in edit mode, exits edit mode, rebuilds at a different width, and confirms persisted order.",
        "Targets known regression zone: persistence across breakpoints and layout reflow."
      ],
      "title": "Test: dashboard reorder persists across breakpoints"
    },
    {
      "date": "2026-01-16",
      "files": [
        "app/unitana/test/dashboard_reorder_persistence_breakpoints_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P0.2a",
      "notes": [
        "Widget tests cannot import from package:unitana/test; inlines the small dashboard seed helper into the test."
      ],
      "title": "Test fix: remove invalid package import from dashboard reorder test"
    },
    {
      "date": "2026-01-16",
      "files": [
        "app/unitana/test/dashboard_reorder_persistence_breakpoints_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P0.2b",
      "notes": [
        "Semantics labels under Draggable can be inconsistent in widget tests; finder moved toward a visual handle-based target."
      ],
      "title": "Test fix: drag handle finder avoids semantics dependency"
    },
    {
      "date": "2026-01-16",
      "files": [
        "app/unitana/test/dashboard_reorder_persistence_breakpoints_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P0.2c",
      "notes": [
        "Drag handle renders as a sibling overlay in the tile Stack; finder updated to search within the Stack ancestor rather than tile subtree."
      ],
      "title": "Test fix: locate edit-mode drag handle via Stack ancestor"
    },
    {
      "date": "2026-01-16",
      "files": [
        "app/unitana/test/dashboard_edit_drag_handle_hit_testing_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P0.3",
      "notes": [
        "Adds a widget test that verifies drag reorder starts only from the drag handle in edit mode, and tile body interactions do not open sheets or persist reorder changes."
      ],
      "title": "Test: edit mode drag-handle hit testing guard"
    },
    {
      "date": "2026-01-17",
      "files": [
        "app/unitana/test/dashboard_edit_drag_handle_hit_testing_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P0.3a",
      "notes": [
        "Packages P0.3 test and context_db update together for changed-files-only patch workflow."
      ],
      "title": "Combined patch: P0.3 drag-handle hit-testing test + context_db update"
    },
    {
      "date": "2026-01-17",
      "files": [
        "app/unitana/test/tool_modal_clipboard_contract_smoke_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P0.4",
      "notes": [
        "Adds widget test validating history tap copies result, long-press copies input, and notice surface renders expected labels."
      ],
      "title": "Tool modal clipboard contract smoke test"
    },
    {
      "date": "2026-01-17",
      "files": [
        "app/unitana/test/tool_modal_history_lazy_build_smoke_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P0.5",
      "notes": [
        {
          "text": "Adds a widget test that generates a full (10-item) tool history and scrolls the history ListView until the oldest entry is visible, asserting no overflow or nested-scroll exceptions.",
          "type": "test"
        }
      ],
      "title": "Tool modal history lazy-build + nested scroll smoke test"
    },
    {
      "date": "2026-01-17",
      "files": [
        "app/unitana/test/tool_modal_history_lazy_build_smoke_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P0.5a",
      "notes": [
        "Updates the test to locate the inner history ListView as a descendant of the outer tool scroll view (tool_scroll_<toolId>), avoiding ambiguous ListView ancestor matches in widget tests."
      ],
      "title": "Test fix: target inner history ListView (avoid outer scroll ListView ancestor match)"
    },
    {
      "date": "2026-01-17",
      "files": [
        "app/unitana/test/tool_modal_history_lazy_build_smoke_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P0.5b",
      "notes": [
        "flutter_test scrollUntilVisible requires a Scrollable finder; ListView is not a Scrollable and caused a cast error.",
        "Finder now targets the Scrollable child under the inner history ListView."
      ],
      "title": "Test fix: tool modal history scrollUntilVisible targets Scrollable under inner ListView"
    },
    {
      "date": "2026-01-17",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/tool_modal_history_lazy_build_smoke_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P0.5c",
      "notes": [
        "Adds ValueKey(tool_history_list_<toolId>) to the history ListView.builder.",
        "Updates P0.5 history lazy-build test to scroll using the keyed history list descendant Scrollable."
      ],
      "title": "Tool modal: key the history ListView for stable widget tests"
    },
    {
      "date": "2026-01-17",
      "files": [
        "app/unitana/lib/data/frankfurter_client.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_live_data.dart",
        "app/unitana/test/frankfurter_client_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P1.8",
      "notes": [
        "Adds FrankfurterClient and CurrencyBackend (mock/frankfurter) with build/runtime gating.",
        "Loads cached EUR→USD rate from SharedPreferences and refreshes on a 12h TTL (manual refresh remains non-chatty).",
        "Removes simulated EUR→USD drift in refreshAll; demo mode uses stable 1.10 unless a debug override is set.",
        "Adds unit tests for FrankfurterClient JSON parsing and error handling."
      ],
      "title": "Currency backend MVP: Frankfurter EUR→USD + 12h TTL cache (non-chatty)"
    },
    {
      "date": "2026-01-17",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/dashboard_core_conversion_tiles_reality_switch_audit_test.dart",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P1.9",
      "notes": [
        "Audits core conversion tiles to ensure they update their displayed unit system when the hero reality flips.",
        "Adds a widget test that iterates core conversion tiles and asserts unit labels change with Destination/Home.",
        "Updates AI docs to reflect the audit and current priorities."
      ],
      "title": "Tool tile reality flip audit: ensure conversion tiles track active place (Pressure fix) + docs"
    },
    {
      "date": "2026-01-17",
      "files": [
        "app/unitana/test/dashboard_core_conversion_tiles_reality_switch_audit_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P1.9a",
      "notes": [
        "Adjusts test tapping to target hit-testable surfaces and avoid RenderBox warnings."
      ],
      "title": "QA hardening: fix hit-test warning in reality switch audit test"
    },
    {
      "date": "2026-01-17",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "docs/ui/PLACES_HERO_V2_SPEC.md",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "P1.10",
      "notes": [
        "Bottom-left hero quadrant is now dedicated to Currency; wind/gust only appear inside the right-side Details pill.",
        "Introduces `hero_currency_card` + `hero_currency_primary_line` stable keys and updates the PlacesHeroV2 contract spec.",
        "Extends PlacesHeroV2 widget test to assert currency card presence and absence of legacy wind/gust keys."
      ],
      "title": "Hero currency quadrant: remove duplicate wind/gust lines; add currency mini-card + contract updates"
    },
    {
      "date": "2026-01-17",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/dashboard_session_controller.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "docs/ui/PLACES_HERO_V2_SPEC.md",
        "docs/ai/context_db.json"
      ],
      "gates": [
        "dart format .",
        "flutter analyze",
        "flutter test"
      ],
      "id": "P1.11",
      "summary": [
        "Adds a swappable env pill in the Places Hero left rail, occupying the reclaimed space above the currency card.",
        "Env pill is provider-agnostic and uses placeholders until an air-quality backend is selected.",
        "Introduces stable keys for env pill content and updates hero regression test."
      ],
      "title": "Hero env pill (AQI/Pollen) above currency"
    },
    {
      "date": "2026-01-18",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P1.11a",
      "notes": [
        "Env pill header no longer forces infinite width; prevents RenderBox not laid out errors when the pill is wrapped in FittedBox on small hero heights."
      ],
      "title": "Fix Env pill unconstrained layout on compact hero surfaces"
    },
    {
      "date": "2026-01-18",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P1.11b",
      "notes": [
        "Env pill and currency card now expand to the same bounded width in normal hero layouts; compact layouts remain safe under FittedBox (unbounded width)."
      ],
      "title": "Align Env pill width with currency card"
    },
    {
      "date": "2026-01-18",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P1.11d",
      "notes": [
        "Env pill now explicitly sets its container width to expand when the layout provides a bounded width, preventing shrink-wrapping that made it appear narrower than the currency card.",
        "Unbounded-width (compact/FittedBox) layouts remain unchanged to avoid layout exceptions."
      ],
      "title": "Fix Env pill width by forcing expansion under bounded constraints"
    },
    {
      "date": "2026-01-17",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P1.11k",
      "notes": [
        "Hero body is now banded: top band holds temperature (left) and marquee (right); bottom band holds Env+Currency stack (left), a dedicated middle animation slot, and the Sunrise/Sunset (and Wind/Gust) pill (right).",
        "Env and Currency pills now expand to the full left-column width and split the available bottom-band height without global FittedBox scaling, restoring readability on phone surfaces.",
        "Added a widget test asserting Env/Currency width parity and guarding against the postage-stamp regression; also asserts the middle anim slot has a meaningful footprint."
      ],
      "title": "Sev1: Rebuild Places Hero body into top/bottom bands; restore readable Env/Currency tiles and add middle anim bay"
    },
    {
      "date": "2026-01-18",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P1.11af",
      "notes": [
        "Fixed breaking signature drift by ensuring the left Env/Currency stack passes both primary and secondary Place objects into the currency card, matching _currencyLines() requirements.",
        "Added a safe fallback when eurToUsd is null so the hero can render deterministically while the rate is still loading.",
        "Removed an unused local (sideWidth) introduced during earlier layout iterations to keep analyze clean."
      ],
      "title": "Sev1: Restore Places Hero compile stability by wiring primary+secondary into Currency card and adding safe rate fallback"
    },
    {
      "date": "2026-01-19",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P1.11aw",
      "notes": [
        "Fixed phone-surface regression where Env/Currency rail collapsed to ~92px by allowing the right pill to shrink first when total width is constrained.",
        "Maintains the test contract that left-rail tiles remain readable (>=150px) while keeping layout deterministic across breakpoints."
      ],
      "title": "Sev1: Preserve hero left-rail readability by shrinking right pill under tight widths"
    },
    {
      "date": "2026-01-19",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P1.11ay",
      "notes": [
        "Adds a minHeight (44dp) guard for the hero Env pill and Currency card when not in micro-mode, fixing the widget-test regression where the Env tile collapsed below the readability/tap target contract on phone surfaces.",
        "Min-height is applied only when the parent allows it (unbounded height or >=44dp), preserving the micro-mode overflow guarantees under pathological constraints."
      ],
      "title": "Sev1: Enforce minimum touch-height for hero Env/Currency tiles on normal surfaces"
    },
    {
      "date": "2026-01-19",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart"
      ],
      "id": "P1.11az",
      "notes": [
        "In compact hero layout with bounded height, reserve >=94dp for the bottom band (Env+gap+Currency) so each tile can meet the 44dp touch-target contract.",
        "Top row shrinks first; bottom row stays deterministic."
      ],
      "title": "Hero bands: enforce bottom band min height in compact so Env/Currency meet 44dp contract"
    },
    {
      "date": "2026-01-20",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "P1.12h5",
      "notes": [
        "Locked in a stable, test-green hero layout after Sev1; bottom band/pills meet touch-target contract where possible and degrade to micro mode under pathological constraints.",
        "Established the red-box region structure for Temps (top-left), Marquee (top-right), Env/Currency (left stack), Sunrise/Sunset & Wind/Gust (bottom-right)."
      ],
      "title": "Hero stabilization: compact pill sizing + layout contract (green baseline)"
    },
    {
      "date": "2026-01-20",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P1.14c5",
      "notes": [
        "Ensured the marquee condition label renders once (no duplication) with a stable flag flow.",
        "Right-aligned blinking swap indicator in Env pill for clear tap affordance; kept visible in micro mode.",
        "Added coin iconography to currency tile; tightened text sizing to anticipate longer strings; formatting supports up to 2 decimals and trims trailing zeros.",
        "Bottom-aligned marquee within its slot and nudged height slightly south without resizing hero region."
      ],
      "title": "Hero polish: right-aligned Env swap, coin icon on currency, smaller Env/Currency text, marquee nudged south"
    },
    {
      "date": "2026-01-24",
      "files_touched": [
        "app/unitana/lib/features/dashboard/models/dashboard_live_data.dart",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
        "docs/ai/context_db.json"
      ],
      "gates": {
        "dart_format": "expected-pass",
        "flutter_analyze": "expected-pass",
        "flutter_test": "expected-pass"
      },
      "id": "P1.23b_fix_dashboard_live_data_parse",
      "summary": "Fix Dart parse error cascade in DashboardLiveDataController by removing stray brace in _loadDevOverrides; update AI docs for current state and handoff prep."
    },
    {
      "date": "2026-01-30",
      "files_changed": [
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT_SENIOR_REVIEW.md",
        "docs/ai/retros/RETRO_P1.23_HERO_MINI_HERO.md",
        "docs/ai/context_db.json"
      ],
      "id": "P1.23_rollup_hero_minihero_regressions",
      "notes": [
        "Rollup entry: extended iteration on Places Hero V2 + mini-hero readout resulted in repeated UI regressions and design drift.",
        "Escalated to senior team for top-to-bottom audit, stabilization to green, hardening (tests + docs cleanup), and subsequent design lock.",
        "Known current blocker: a flutter test fails with unbounded-height flex/layout exception in places_hero_v2.dart (see CURRENT_HANDOFF for details)."
      ],
      "title": "P1.23 rollup: Hero/Mini-Hero stabilization + escalation"
    },
    {
      "date": "2026-01-30",
      "id": "P1.23_rollup_senior_handoff",
      "notes": [
        "Escalation: repeated hero/mini-hero UI regressions; feature work paused.",
        "Known remaining failure in this snapshot: flutter test layout exception (unbounded height flex) in PlacesHeroV2; see CURRENT_HANDOFF.md.",
        "Senior plan: restore green, add golden/widget tests for hero + mini-hero, then harden docs and lock design."
      ],
      "title": "P1.23: rollup + senior takeover handoff"
    },
    {
      "date": "2026-01-30",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/test/dashboard_pinned_mini_hero_readout_presence_test.dart",
        "app/unitana/test/dashboard_places_hero_v2_timeline_date_invariants_test.dart",
        "app/unitana/test/places_hero_v2_unbounded_height_smoke_test.dart",
        "app/unitana/test/goldens/places_hero_v2_goldens_test.dart",
        "docs/ai/design_lock/HERO_MINI_HERO_CONTRACT.md",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
        "docs/ai/context_db.json"
      ],
      "id": "P1.23b_senior_stabilization_hero_lock_scaffolding",
      "notes": [
        "Guards PlacesHeroV2 against Flutter's unbounded-height flex failure by adding a bounded-height fallback path in LayoutBuilder and by removing Expanded usage when height is unbounded inside _HeroBandsBody.",
        "Adds stable key for pinned mini-hero readout container to support a presence regression test.",
        "Adds constraint smoke test (unbounded height) plus presence/invariant widget tests; adds golden-test scaffolding behind UNITANA_GOLDENS=1 to avoid breaking CI until baselines are generated.",
        "Creates a canonical hero/mini-hero design contract under docs/ai/design_lock."
      ],
      "title": "P1.23b: Senior stabilization + hero lock scaffolding"
    },
    {
      "date": "2026-01-31",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
        "docs/ai/design_lock/HERO_MINI_HERO_CONTRACT.md",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P1.28_sev1_bounds_and_mock_seeding",
      "notes": [
        "Fixes the recurring unbounded-height flex failure by tightly bounding the bottom band height (SizedBox height) instead of minHeight-only constraints; avoids CrossAxisAlignment.stretch coupling.",
        "Adds a defensive unbounded-height guardrail in _LeftEnvCurrencyStack to render without Expanded/Flexible when height is infinite.",
        "Restores deterministic mock/demo data by calling DashboardLiveData.ensureSeeded([home, dest]) in DashboardBoard before tiles read per-place snapshots; this re-enables AQI, Pollen, and SunTimes in mock mode.",
        "Aligns details pill title separator to '•' and preserves legacy segment key compatibility for tests."
      ],
      "title": "P1.28: Bound bottom band + restore deterministic mock data"
    },
    {
      "date": "2026-01-31",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P1.29_sev1_compact_overflow_and_analyze_clean",
      "notes": [
        "Fixes recurring RenderFlex bottom overflow on 320×568 by reducing vertical-only padding in PlacesHeroV2 compact mode (saves ~12px without changing normal geometry).",
        "Removes unused secondaryZone variable in PlacesHeroV2 and unused _tzAbbrev helper in DashboardScreen to keep flutter analyze clean.",
        "Replaces deprecated RichText.textScaleFactor with textScaler to eliminate deprecated_member_use warning."
      ],
      "title": "P1.29: Fix 320×568 overflow + clean flutter analyze warnings"
    },
    {
      "date": "2026-01-31",
      "files": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P1.30",
      "summary": "Remove dashboard header refresh label (Updated just now) to prevent small-phone RenderFlex overflow; further reduce PlacesHeroV2 compact vertical padding/gap for 320×568 stability."
    },
    {
      "date": "2026-01-31",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "id": "P1.31",
      "summary": "Fix lingering ~0.22px RenderFlex overflow by keeping PlacesHeroV2 compact spacing whole-numbered; stabilize Liquids tool modal history test by ensuring visibility on the InkWell tap target before tapping."
    },
    {
      "date": "2026-01-31",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P1.33",
      "summary": "Reserve layout space for pinned hero overlay so it never obscures first-row tiles or breaks hit-testing; fixes Liquids tile tap failures in widget tests when pinned overlay becomes visible."
    },
    {
      "date": "2026-01-31",
      "files_changed": [
        "app/unitana/test/goldens/places_hero_v2_goldens_test.dart",
        "app/unitana/test/goldens/pinned_mini_hero_goldens_test.dart",
        "app/unitana/test/goldens/README.md",
        "docs/ai/design_lock/HERO_MINI_HERO_CONTRACT.md",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P1.39",
      "summary": "Hardening: extend gated golden coverage and workflow. Standardize golden test determinism (devicePixelRatio=1.0), add pinned mini-hero golden states, and document golden generation in test/goldens/README and hero contract."
    },
    {
      "date": "2026-01-31",
      "files_changed": [
        "app/unitana/test/goldens/places_hero_v2_goldens_test.dart",
        "app/unitana/test/goldens/pinned_mini_hero_goldens_test.dart",
        "app/unitana/test/goldens/README.md",
        "docs/ai/design_lock/HERO_MINI_HERO_CONTRACT.md",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P1.40",
      "summary": "Hardening: simplify goldens execution. Golden tests now run automatically when --update-goldens is used (autoUpdateGoldenFiles) while remaining gated by default; baselines are stored under test/goldens/goldens and docs updated accordingly."
    },
    {
      "date": "2026-01-31",
      "files_changed": [
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P1.40a",
      "summary": "Planning/docs: define P0 onboarding wizard redesign (3-step flow) with unified Dracula-style scaffold and updated bottom navigation; define P0 scroll transition hardening strategy for pinned mini-hero; refresh handoff and context."
    },
    {
      "date": "2026-01-31",
      "files_changed": [
        "app/unitana/lib/features/first_run/first_run_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/design_lock/HERO_MINI_HERO_CONTRACT.md",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P0.01a",
      "summary": "Fix build issues after onboarding wizard patch (duplicate ColorScheme getter; mounted-return lint); make AQI/Pollen pill tap feedback consistent (Material ripple like Sun/Wind pill); center-align currency line in micro layout; update hero design contract and handoff docs."
    },
    {
      "date": "2026-02-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/design_lock/HERO_MINI_HERO_CONTRACT.md",
        "docs/ai/context_db.json"
      ],
      "id": "P0.01c",
      "notes": [
        "Centers PlacesHeroV2 reality toggle labels (flag emoji + city) in both segments to match the mini toggle and reduce visual bias.",
        "Removes an unused local that triggered flutter analyze warnings.",
        "Updates the HERO+MINI-HERO design contract to lock toggle typography and centering behavior."
      ],
      "title": "P0: Hero reality toggle centering + analyze cleanup + design lock update"
    },
    {
      "date": "2026-02-01",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/test/dashboard_pinned_hero_transition_no_jump_test.dart",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json",
        "docs/ai/design_lock/HERO_MINI_HERO_CONTRACT.md"
      ],
      "id": "P0.02",
      "notes": [
        "Replaces boolean pinned-overlay insertion with an AnimationController that animates both reserved spacer height and overlay opacity/slide, eliminating single-frame scroll 'pops'.",
        "Adds a widget test to guard against reintroducing abrupt pinned-hero jumps when crossing the scroll threshold."
      ],
      "title": "P0: Pinned mini-hero scroll transition hardening (no jump)"
    },
    {
      "date": "2026-02-01",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_collapsing_header.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/pinned_mini_hero_readout.dart",
        "app/unitana/test/dashboard_pinned_hero_transition_no_jump_test.dart",
        "app/unitana/test/dashboard_pinned_hero_overlay_test.dart",
        "app/unitana/test/dashboard_pinned_mini_hero_readout_presence_test.dart",
        "app/unitana/test/dashboard_pinned_overlay_pills_single_row_test.dart",
        "app/unitana/test/dashboard_pinned_overlay_smallest_size_smoke_test.dart"
      ],
      "id": "P0.03",
      "notes": [
        "Mini hero is always in the tree; visibility is via opacity and pointer gating to avoid interaction overlap.",
        "Pinned header reserved height is 148.0; keep this in sync with golden expectations and small-device constraints.",
        "Seed demo live data before rendering header to keep hero/mini content aligned on first frame."
      ],
      "summary": "Switch pinned mini-hero behavior to a true collapsing SliverPersistentHeader; fade/scale hero out and fade mini bar in (no jump), unify keys, adjust pinned height and padding, update tests."
    },
    {
      "date": "2026-02-01",
      "files": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/... (dashboard add-slot interaction tests)",
        "docs/ai/design_lock/HERO_MINI_HERO_CONTRACT.md",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P0.03c",
      "notes": [
        "Addresses failing tests: multiple widgets with the same GlobalKey (hero keys) and missed taps on offscreen add-slot tiles.",
        "DashboardBoard includePlacesHero defaults to true for backward compatibility; DashboardScreen sets false for the current dashboard implementation."
      ],
      "summary": "Fix collapsing-header regressions: prevent duplicate PlacesHero instances by disabling hero tile inside DashboardBoard when SliverPersistentHeader is used; update dashboard widget tests to ensureVisible() before tapping add-slot tiles."
    },
    {
      "date": "2026-02-01",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_collapsing_header.dart",
        "app/unitana/test/dashboard_test_helpers.dart",
        "app/unitana/test/dashboard_* (currency, insert/remove, reorder, tool modal tests)",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P0.03d",
      "notes": [
        "Fixes failing widget tests caused by pinned SliverPersistentHeader occluding tap targets and by PlacesHeroV2 being laid out under shrinking header constraints.",
        "ensureVisibleAligned uses Scrollable.ensureVisible(alignment: 0.85) so targets land away from the top edge under pinned headers.",
        "Reorder test drag uses a constant horizontal offset to avoid layout-dependent handle positions."
      ],
      "summary": "Stabilize collapsing-header tests: render PlacesHeroV2 at full height (clipped) to prevent intermediate-height RenderFlex overflows; keep pinned toggle + readout in a single row; add ensureVisibleAligned() helper for pinned-sliver occlusion and update widget tests accordingly; use horizontal-only drag delta in reorder persistence test."
    },
    {
      "id": "P0.03f",
      "date": "2026-02-01",
      "summary": "Test stability cleanup: align Places ordering contract and make reorder test resilient to collapsing-header layout shifts.",
      "notes": [
        "DashboardScreen now treats places[0]=Home and places[1]=Destination (wizard contract). Updated PlacesHeroV2 widget test seed data accordingly so Destination defaults to metric expectations.",
        "Reorder persistence breakpoint test now asserts relative reading order (top-to-bottom then left-to-right) instead of assuming both tiles remain on the same row; prevents false negatives when header/spacing changes alter tile row packing.",
        "Fix dart analyzer lints in tool modal interaction tests by renaming non-lowerCamelCase locals (pressureTile, shoeSizesTile)."
      ],
      "files": [
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "app/unitana/test/dashboard_reorder_persistence_breakpoints_test.dart",
        "app/unitana/test/pressure_tool_modal_interaction_test.dart",
        "app/unitana/test/shoe_sizes_tool_modal_interaction_test.dart",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ]
    },
    {
      "id": "P0.03i",
      "date": "2026-02-01",
      "summary": "Restore pinned mini-hero legibility: stack toggle above readout and increase collapsed header height.",
      "notes": [
        "Pinned mini bar is vertical again (segmented toggle above full-width readout) to match goldens and avoid unreadable side-by-side shrink.",
        "Increase pinned header collapsed height to 176dp to prevent clipping of the stacked mini bar on compact devices.",
        "Ensure hero file version removes stray unused locals (analyzer cleanliness).",
        "Update design lock + handoff notes to reflect the pinned layout invariant."
      ],
      "files": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_collapsing_header.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/design_lock/HERO_MINI_HERO_CONTRACT.md",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ]
    },
    {
      "patch_id": "P0.04a_wizard_titles_dashboard_refresh_spacing",
      "date": "2026-02-02",
      "summary": "Onboarding wizard polish: Roboto Slab titles, slide2 subtitle option 2, Create Profile CTA, consistent footer spacing; dashboard refresh row tightened and top whitespace reduced."
    },
    {
      "patch_id": "P0.04a_wizard_titles_dashboard_refresh_spacing",
      "date": "2026-02-02",
      "summary": "Onboarding wizard: Roboto Slab titles, slide2 subtitle, Create Profile CTA, footer CTA height matched. Dashboard: reduced top whitespace above refresh status and tightened spacing between Updated label and refresh icon.",
      "files_changed": [
        "app/unitana/lib/features/first_run/first_run_screen.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ]
    },
    {
      "id": "patch_2026-02-01_P0_transition_red_tests",
      "date": "2026-02-01",
      "title": "Transition: collapsing header + wizard polish (build currently red)",
      "slice": "P0",
      "summary": [
        "Collapsing SliverPersistentHeader used to morph PlacesHeroV2 into pinned mini-hero readout for smoother scroll transitions.",
        "Onboarding wizard consolidated to 3 steps; titles align with dashboard profile font and Dracula palette discipline.",
        "Current blocker: duplicate hero-related test keys during collapse; resolve before golden updates."
      ],
      "notes": {
        "build_state": "red (flutter test)",
        "top_failures": [
          "duplicate keys: places_hero_segment_home, hero_marquee_slot, places_hero_clock_detail",
          "duplicate key: hero_env_pill",
          "pinned header occludes tap target in weather_summary_tile_open_smoke_test"
        ]
      }
    },
    {
      "id": "patch_2026-02-02_P0_keys_wizard_polish",
      "date": "2026-02-02",
      "title": "P0 green: collapsing header key hygiene + wizard hardening + dashboard UI polish",
      "slice": "P0",
      "summary": "Stabilized duplicate key failures via includeTestKeys gating; restored wizard unit/clock controls; fixed repeated slide regressions; polished dashboard refresh cluster and env pill swap alignment.",
      "notes": [
        "Do not emit canonical keys in preview surfaces",
        "Slide 2 pills must remain compact; no scroll"
      ]
    },
    {
      "id": "patch_2026-02-03_goldens_regression_harness",
      "date": "2026-02-03",
      "title": "Regression harness: gated goldens + first-run regression tests",
      "slice": "P0/P1",
      "summary": "Added golden harness (UNITANA_GOLDENS=1) and first-run regression tests to lock wizard/dashboard interactions; fixed citypicker interaction regressions.",
      "notes": [
        "Goldens may be outdated; update intentionally",
        "Keep tests pinned-header aware"
      ]
    },
    {
      "id": "patch_2026-02-03_P1_profiles_switcher",
      "date": "2026-02-03",
      "title": "P1: Multi-profile persistence + profile switcher edit mode",
      "slice": "P1",
      "summary": "Introduced UnitanaProfile, persisted profile list + active id, added profile switcher sheet and edit flow; added regression invariants.",
      "notes": [
        "Ensure per-profile namespacing stays consistent",
        "Avoid state bleed across profiles"
      ]
    },
    {
      "id": "patch_2026-02-05_P1_appstate_legacy_setters",
      "date": "2026-02-05",
      "title": "P1: AppState legacy setters cleanup and test stabilization",
      "slice": "P1",
      "summary": "Fixed AppState legacy setter usage and stabilized profile switcher tests after refactors; reduced remaining analyzer warnings without behavior drift.",
      "notes": [
        "Prefer minimal diffs; keep repo green"
      ]
    },
    {
      "id": "patch_2026-02-05_P1_modal_menu_close_controls",
      "date": "2026-02-05",
      "title": "P1: Dashboard menu modal sizing + close controls + codex workflow update",
      "slice": "P1",
      "summary": "Reduced dashboard menu sheet height to bounded mode, added top-right close controls across dashboard/menu-related sheets, and updated AI docs to codex-first direct-edit workflow.",
      "notes": [
        "Main menu now uses a bounded height factor (0.82) instead of near-fullscreen layout.",
        "Close buttons added to menu, profile switcher, dev tools, weather, clock, and reset confirmation sheets.",
        "Kept behavior stable; full format/analyze/test gates pass."
      ]
    },
    {
      "date": "2026-02-06",
      "id": "patch_2026-02-06_currency_manual_picker_history_guard_tools_audit",
      "title": "Currency tool manual pair picker + history-guard semantics; tools audit checkpoint",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/dashboard_session_controller.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/dashboard_currency_modal_context_test.dart",
        "app/unitana/test/currency_tool_modal_interaction_test.dart",
        "app/unitana/test/dashboard_currency_global_mapping_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "summary": [
        "Added manual currency from/to selectors in the currency modal using mapped global currency codes.",
        "Extended conversion history records with optional fromUnit/toUnit metadata and guarded dashboard tile history application to active pair matches.",
        "Hardened currency picker widget tests to be key-driven and scroll-safe.",
        "Audited tool registry and confirmed 14 tools remain disabled (coming-soon equivalent), keeping Pack F open."
      ]
    },
    {
      "date": "2026-02-06",
      "id": "patch_2026-02-06_backlog_localization_epic_and_tools_audit_notes",
      "title": "Backlog update: localization epic + tool-surface audit guidance",
      "files_changed": [
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "summary": [
        "Added Pack H localization epic with Settings language selection and i18n/l10n quality gates.",
        "Captured tool-surface audit guidance to evaluate coming-soon tool value and identify missing high-value tools.",
        "Aligned next-chat prompt sequencing to keep Pack F usefulness audit explicit while B/C continue."
      ]
    },
    {
      "date": "2026-02-06",
      "id": "patch_2026-02-06_profile_board_phase1_unified_entry",
      "title": "Profiles Board phase 1: unified entry and tiled profile CRUD surface",
      "files_changed": [
        "app/unitana/lib/app/app_state.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/profiles_board_screen.dart",
        "app/unitana/test/profile_switcher_edit_profile_flow_test.dart",
        "app/unitana/test/profile_switcher_add_profile_cancel_flow_test.dart",
        "app/unitana/test/profile_switcher_switch_profile_flow_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "summary": [
        "Added a dedicated Profiles Board route with tile-based add/edit/delete/switch interactions and manage mode.",
        "Collapsed dashboard menu profile actions into a single Profiles entry.",
        "Added persisted profile ordering in app state and wired drag reorder behavior on the board.",
        "Migrated existing profile flow tests to board keys and paths."
      ]
    },
    {
      "id": "patch_2026-02-06_pack_bc_retry_global_coverage_and_packf_activation_bundle",
      "date": "2026-02-06",
      "title": "Pack B/C hardening coverage + Pack F first activation bundle + header/profile grid UX follow-up",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_live_data.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/profiles_board_screen.dart",
        "app/unitana/test/dashboard_currency_retry_cache_semantics_test.dart",
        "app/unitana/test/dashboard_live_data_global_city_coverage_test.dart",
        "app/unitana/test/toolpicker_activation_bundle_test.dart",
        "app/unitana/test/profile_switcher_switch_profile_flow_test.dart",
        "app/unitana/test/dashboard_devtools_weather_menu_hardening_test.dart",
        "app/unitana/test/dashboard_edit_drag_handle_hit_testing_test.dart",
        "app/unitana/test/dashboard_reorder_persistence_breakpoints_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Added explicit currency stale/retry observability in DashboardLiveDataController and constructor-configurable retry backoff (default unchanged: 2 minutes).",
        "Added Pack C regression coverage for cache TTL/no-refetch, outage backoff suppression, and retry recovery paths.",
        "Added Pack B representative global-city live-path coverage for weather/sun/AQI/pollen on Open-Meteo path.",
        "Reduced disabled tool count by activating world_clock_delta + jet_lag_delta entries and routing both to the existing Time modal as a low-risk activation bundle.",
        "Dashboard status row now uses inline right-aligned edit action; refresh cluster is centered to title axis with optical nudge; profile-board add-slot placeholders now render in even balanced counts."
      ]
    },
    {
      "id": "patch_2026-02-06_packf_data_storage_activation_bundle",
      "date": "2026-02-06",
      "title": "Pack F: Data Storage activation bundle (registry + modal + conversion + tests)",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/canonical_tools.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/toolpicker_activation_bundle_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Enabled data_storage in ToolRegistry and added ToolDefinition mapping so picker now opens a real modal instead of coming-soon state.",
        "Extended multi-unit conversion engine for data storage units (B/KB/MB/GB/TB) and wired unit pill defaults in modal.",
        "Expanded activation bundle regression test to verify Data Storage modal opens and performs a conversion run."
      ]
    },
    {
      "id": "patch_2026-02-06_packd_restore_gate_and_time_repurpose_sequencing",
      "date": "2026-02-06",
      "title": "Planning artifacts: Pack D restore gate + Time repurpose sequencing",
      "files_changed": [
        "tools/create_restore_point.sh",
        "docs/ai/reference/PACK_D_RESTORE_BACKUP_STRATEGY.md",
        "docs/ai/reference/TIME_TOOL_REPURPOSE_PLAN.md",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
        "docs/ai/context_db.json"
      ],
      "notes": [
        "Added executable restore-point helper that captures commit, status, diffs, tracked files, and a worktree snapshot archive.",
        "Defined mandatory backup/restore preflight before any Pack D consolidation/deletion batches.",
        "Documented and locked sequencing to repurpose Time tool toward timezone/delta workflows rather than 12h↔24h conversion-only behavior."
      ]
    },
    {
      "id": "patch_2026-02-06_design_pivot_handoff_refresh",
      "date": "2026-02-06",
      "title": "Design-pivot handoff refresh for Time/Weather/tool taxonomy",
      "files_changed": [
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Shifted next context mission to a design-only sprint focused on Time-family architecture, tool duplication strategy, and unified visual direction.",
        "Captured latest user UX feedback as explicit decision inputs (Time UI clarity, weather pollen labeling clarity, naming/duplication risks).",
        "Prepared a new next-chat prompt to drive design artifacts before additional large implementation slices."
      ]
    }
  ],
  "patches": [
    {
      "date": "2026-01-19",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P1.11ay_sev1_min_height_env_currency",
      "notes": [
        "Adds a minHeight (44dp) guard for the hero Env pill and Currency card when not in micro-mode, fixing the widget-test regression where the Env tile collapsed below the readability/tap target contract on phone surfaces.",
        "Min-height is applied only when the parent allows it (unbounded height or >=44dp), preserving the micro-mode overflow guarantees under pathological constraints."
      ],
      "title": "Sev1: Enforce minimum touch-height for hero Env/Currency tiles on normal surfaces"
    },
    {
      "date": "2026-01-19",
      "files": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/test/dashboard_places_hero_v2_test.dart"
      ],
      "id": "P1.11bf2",
      "notes": [
        "Removed the middle animation bay from Places hero to reclaim width budget (Option 3 decision).",
        "Replaced brittle clamp-based width allocation with deterministic two-column sizing: left rail pinned to >=150dp (unless physically impossible), right rail receives remaining width to prioritize Sunrise/Wind readability.",
        "Separated horizontal column gap from internal Env/Currency stack gap to stabilize vertical touch-target math.",
        "Updated phone-surface hero test: removed middle-bay assertions; added priority width assertion for the Sunrise pill."
      ],
      "title": "Option 3: remove middle hero bay; deterministic left/right widths; eliminate clamp crash"
    },
    {
      "date": "2026-01-20",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json"
      ],
      "id": "P1.14c5_hero_polish_env_swap_currency_icon",
      "notes": [
        "Ensured the marquee condition label renders once (no duplication) with a stable flag flow.",
        "Right-aligned blinking swap indicator in Env pill for clear tap affordance; kept visible in micro mode.",
        "Added coin iconography to currency tile; tightened text sizing to anticipate longer strings; formatting supports up to 2 decimals and trims trailing zeros.",
        "Bottom-aligned marquee within its slot and nudged height slightly south without resizing hero region."
      ],
      "title": "Hero polish: Env swap affordance, currency iconography, typography tightening, marquee single-label"
    },
    {
      "date": "2026-01-20",
      "files_changed": [
        "app/unitana/lib/data/open_meteo_air_quality_client.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_live_data.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_session_controller.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "P1.15a_env_data_swap_persistence",
      "notes": [
        "Env pill now renders live AQI and a compact pollen index for both selected cities when coordinates are available; otherwise shows '--' placeholders.",
        "Normal mode displays dual values as 'A: ... • B: ...'; micro mode collapses to a single safe line (e.g., 'AQI 42/55', 'Pol 3.2/1.1') with the swap affordance always visible and right-aligned.",
        "Tap swaps AQI <-> Pollen, and the selected mode is persisted via shared preferences.",
        "Air quality data is fetched from Open-Meteo Air Quality API under the existing weather network gate; tests remain deterministic via seeding and micro-first layout."
      ],
      "title": "P1.15a: Wire Env data (AQI + Pollen) + swap persistence (micro-safe)"
    },
    {
      "date": "2026-01-21",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_session_controller.dart",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P1.15b_hero_semantics_sun_env_clarity",
      "notes": [
        "Sunrise/Sunset pill shows two lines with explicit time zones: “🌅 07:52 WET (00:52 MST)” and “🌇 17:29 WET (10:29 MST)”.",
        "Env (AQI/Pollen) now represents the selected city only to avoid cross-city ambiguity; swap toggles AQI <-> Pollen and persists.",
        "Currency pill keeps 2dp support and clarifies symbols; no hero proportion changes."
      ],
      "title": "P1.15b: Hero semantics clarity (Sunrise/Sunset format, Env single-city, currency symbol)"
    },
    {
      "date": "2026-01-21",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "P1.16a_marquee_height_budget",
      "notes": [
        "Allocates a small vertical budget increase to the marquee animation region.",
        "Maintains hero region proportions contract; micro gating untouched."
      ],
      "title": "P1.16a: Marquee height budget (slightly taller without hero relayout)"
    },
    {
      "date": "2026-01-21",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "P1.16b_details_pill_alignment_unification",
      "notes": [
        "Unifies line metrics/spacing so swapping Wind/Gust <-> Sunrise/Sunset feels like a clean “flip” rather than a jump."
      ],
      "title": "P1.16b: Details pill alignment unification (Wind/Gust and Sunrise/Sunset swap stability)"
    },
    {
      "date": "2026-01-21",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/dashboard_session_controller.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "P1.16c_tool_modal_clear_history",
      "notes": [
        "Adds a bottom-right Clear history link under the tool modal terminal.",
        "Uses a modal-bottom-sheet confirmation (Cancel/Clear).",
        "Clearing history resets the tool result line and clears the input."
      ],
      "title": "P1.16c: Tool modal clear history link (confirm + reset)"
    },
    {
      "date": "2026-01-21",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "P1.17a_clear_history_style_aqi_dot",
      "notes": [
        "“Clear History” link is de-underlined, title-cased, and uses a distinct accent color from base Dracula neutrals.",
        "Introduces a simple AQI severity-to-color dot mapping hook (uses standard US AQI breakpoints)."
      ],
      "title": "P1.17a: Clear History styling + AQI dot mapping scaffold"
    },
    {
      "date": "2026-01-21",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_session_controller.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "P1.18a_pinned_minihero_tri_pills",
      "notes": [
        "Pinned hero overlay adds a three-pill mini hero row; each segment supports swap affordance and persisted modes.",
        "Sets the stage for later aesthetic refinement without impacting main hero stability."
      ],
      "title": "P1.18a: Pinned mini-hero tri-pills (size + flip affordances)"
    },
    {
      "date": "2026-01-21",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "P1.18b_minihero_terminal_no_pills",
      "notes": [
        "Replaces mini-hero pills with a single outlined terminal-style bar divided into three tappable segments.",
        "Segments: left (Wind/Gust <-> Sunrise/Sunset), middle (AQI <-> Pollen), right (Time/Temp <-> Currency).",
        "Keeps blinking swap affordance and persists mode selections."
      ],
      "title": "P1.18b: Mini-hero terminal bar (remove pills, terminal-style segments)"
    },
    {
      "date": "2026-01-21",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/data_refresh_status_label.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "id": "P1.18b_hotfix1_compile_refresh_label",
      "notes": [
        "Removes duplicate local declarations introduced during mini-hero terminal refactor.",
        "Imports Dracula palette and uses Dracula purple for the “Updated …” label; background pill disabled in header per contract."
      ],
      "title": "P1.18b hotfix1: Fix dashboard compile errors + restore purple floating refresh label"
    },
    {
      "date": "2026-01-24",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "id": "P1.23a_compile_unblock_hero_helpers",
      "notes": [
        "Fixes a pinned-readout compile blocker by replacing undefined `base` with `baseStyle`.",
        "Repairs PlacesHeroV2 compile errors: removes Provider `context.watch` assumptions, uses passed-in controllers, and adds missing helper functions/widgets (wind/gust/temp/currency lines, flag emoji, clocks header).",
        "Aligns PlacesHeroV2 with current live-data model by computing ZoneTime via `TimezoneUtils.nowInZone(..., nowUtc: liveData.nowUtc)` and converting sun times from UTC.",
        "Updates handoff and next-chat prompt to reflect the actual blockers in this repo snapshot."
      ],
      "title": "P1.23a: Unblock builds (pinned readout + PlacesHeroV2 helper restoration)"
    },
    {
      "date": "2026-01-31",
      "files_changed": [
        "app/unitana/lib/features/first_run/first_run_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "docs/ai/design_lock/HERO_MINI_HERO_CONTRACT.md",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/context_db.json"
      ],
      "id": "P0.01a",
      "notes": [
        "Fixes a build-break in first-run wizard screen caused by duplicate `ColorScheme get cs` getters; wraps `if (!mounted) return;` in a block to satisfy lint.",
        "Makes AQI/Pollen pill interaction feedback consistent with the Sun/Wind pill by ensuring a Material ancestor for the InkWell ripple.",
        "Centers currency rate line in micro layout to match normal layout and maintain visual rhythm."
      ],
      "title": "P0: Build fix + hero tap feedback + currency centering"
    },
    {
      "id": "P1.25",
      "date": "2026-02-05",
      "title": "P1: Modal ergonomics + codex workflow cleanup",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
        "docs/ai/context_db.json"
      ],
      "notes": [
        "Bounded dashboard menu sheet height to prevent near-fullscreen takeover on phones.",
        "Added top-right close controls to dashboard/menu sheets for consistent dismissal affordance.",
        "Updated AI docs to codex-first direct edit workflow (zip patches only when explicitly requested)."
      ]
    },
    {
      "id": "patch_2026-02-05_pack_a_city_data_foundation",
      "date": "2026-02-05",
      "title": "Pack A: Canonical city data schema + full coverage + validators",
      "files_changed": [
        "app/unitana/assets/data/cities_v1.json",
        "app/unitana/lib/data/cities.dart",
        "app/unitana/lib/data/city_repository.dart",
        "app/unitana/lib/data/city_schema_validator.dart",
        "app/unitana/test/city_data_schema_validation_test.dart",
        "app/unitana/tools/generate_cities_v1.py",
        "app/unitana/tools/validate_cities_v1.py",
        "docs/ai/design_lock/CITY_DATA_SCHEMA_CONTRACT.md",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
        "docs/ai/context_db.json"
      ],
      "notes": [
        "Generator now parses/emits lat/lon from GeoNames and validates every required field before writing the asset.",
        "Canonical city dataset regenerated with complete lat/lon/timezone/currency/default coverage for all records.",
        "Added contract-level safeguards: shared Dart validator, Python validation script, and schema validation test to fail fast on regressions.",
        "Updated handoff/prompt/docs to mark Pack A complete and move active execution to Pack B/C."
      ]
    },
    {
      "id": "patch_2026-02-06_pinned_mini_toggle_reality_fix",
      "date": "2026-02-06",
      "title": "Pack B hardening: pinned mini-hero reality toggle + temperature context fix",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/compact_reality_toggle.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_collapsing_header.dart",
        "app/unitana/test/dashboard_pinned_reality_toggle_interaction_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Compact (mini) reality toggle now matches hero orientation (destination left, home right).",
        "Removed visible-but-untappable mini-toggle handoff zone by aligning pointer threshold with expanded hero handoff.",
        "Pinned bar now listens to session/live-data so selected-city temperature/readout updates immediately when toggling realities.",
        "Added regression test for pinned toggle order + interactive reality switching."
      ]
    },
    {
      "id": "patch_2026-02-06_city_label_numeric_admin_code_cleanup",
      "date": "2026-02-06",
      "title": "City label cleanup: remove numeric admin codes from user-facing labels",
      "files_changed": [
        "app/unitana/lib/data/cities.dart",
        "app/unitana/test/city_primary_label_format_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "primaryLabel now prefers admin1Name; numeric-only admin1Code is suppressed.",
        "Added focused tests for admin name preference, numeric-code suppression, and alpha-code preservation.",
        "Audit: 27,805 records carry numeric admin1Code; UI no longer surfaces those raw numbers."
      ]
    },
    {
      "id": "patch_2026-02-06_pack_c_country_currency_mapping",
      "date": "2026-02-06",
      "title": "Pack C: country-currency mapping fidelity across dashboard surfaces",
      "files_changed": [
        "app/unitana/lib/data/country_currency_map.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/pinned_mini_hero_readout.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/country_currency_map_coverage_test.dart",
        "app/unitana/test/dashboard_currency_global_mapping_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Added generated canonical country->currency map from city dataset and wired it into currency surfaces.",
        "Currency tool units now reflect non-EUR/US countries (example: JPY <-> USD direction based on selected reality).",
        "Unsupported non-EUR/USD live-rate pairs in hero/tile previews now render deterministic placeholders (—) instead of incorrect rates."
      ]
    },
    {
      "id": "patch_2026-02-06_profile_modal_cancel_and_global_currency_rates",
      "date": "2026-02-06",
      "title": "Profile flow usability + Pack C global pair-rate wiring (JPY and all mapped currencies)",
      "files_changed": [
        "app/unitana/lib/app/app_state.dart",
        "app/unitana/lib/data/frankfurter_client.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_live_data.dart",
        "app/unitana/lib/features/dashboard/widgets/pinned_mini_hero_readout.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/first_run/first_run_screen.dart",
        "app/unitana/test/dashboard_currency_global_mapping_test.dart",
        "app/unitana/test/dashboard_currency_rate_coverage_test.dart",
        "app/unitana/test/first_run_regression_test.dart",
        "app/unitana/test/frankfurter_client_test.dart",
        "app/unitana/test/profile_switcher_add_profile_cancel_flow_test.dart",
        "app/unitana/test/profile_switcher_edit_profile_flow_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Removed redundant 'Profiles' header text in switcher sheet and aligned switcher interaction with existing menu/tool sheet behavior.",
        "Edit profile and add profile flows now support Cancel -> return to profile switcher; add-profile cancel discards the draft profile and restores prior active profile.",
        "Initial first-profile onboarding remains non-cancellable (no cancel affordance).",
        "Currency stack now supports global pair rates (not only EUR/USD): live-data controller resolves pair rates from EUR-base rates with deterministic fallback for all mapped currencies.",
        "Hero, mini hero, and currency tool now render mapped symbols/rates for currencies like JPY instead of placeholder dashes."
      ]
    },
    {
      "id": "patch_2026-02-06_pack_b_live_data_fallback_hardening",
      "date": "2026-02-06",
      "title": "Pack B: live weather/env fallback hardening (no blank critical states)",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/dashboard_live_data.dart",
        "app/unitana/test/dashboard_live_data_refresh_fallback_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "DashboardLiveDataController now guarantees fallback weather/sun/env snapshots per place when live provider calls fail or coordinates are unavailable.",
        "Added controller test knobs for deterministic failure-mode tests (test-harness live refresh opt-in + configurable debounce/latency).",
        "Added regression tests covering WeatherAPI failure and Open-Meteo no-coordinates path to ensure critical hero states never render blank."
      ]
    },
    {
      "id": "patch_2026-02-06_pollen_fallback_currency_scale_weather_audit",
      "date": "2026-02-06",
      "title": "Pollen null fallback + scaled currency display for tiny-per-unit pairs + Open-Meteo mapping audit",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/dashboard_live_data.dart",
        "app/unitana/lib/features/dashboard/widgets/pinned_mini_hero_readout.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/test/dashboard_currency_global_mapping_test.dart",
        "app/unitana/test/dashboard_live_data_refresh_fallback_test.dart",
        "app/unitana/test/openmeteo_scene_key_mapper_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "When Open-Meteo AQ payload has no pollen grains, env snapshot now preserves previous/seeded pollen index instead of writing null, eliminating '--' pollen states.",
        "Hero and mini-hero currency lines now auto-scale base units (1/10/100/1000/10000) for tiny-per-unit pairs (JPY/KRW/VND-class) so values are readable.",
        "Open-Meteo condition label refined to 'Mostly clear' for WMO code 1 and mapper audit tests added for core WMO coverage + label expectations."
      ]
    },
    {
      "id": "patch_2026-02-06_currency_tool_scaled_default_input",
      "date": "2026-02-06",
      "title": "Currency tool default suggested input scales by pair magnitude",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/dashboard_currency_global_mapping_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Currency tool now seeds a suggested input amount on open using the same pair-rate magnitude scaling as hero/mini currency readouts.",
        "Tiny-per-unit pairs (example JPY->USD) default to larger human-meaningful values (example 100) instead of 1.",
        "Added regression test ensuring scaled default input appears for JPY-class direction."
      ]
    },
    {
      "id": "patch_2026-02-06_openmeteo_mapping_audit_expansion",
      "date": "2026-02-06",
      "title": "Open-Meteo weather-type audit expanded to full known WMO set",
      "files_changed": [
        "app/unitana/test/openmeteo_scene_key_mapper_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Expanded Open-Meteo mapper test from representative samples to the full known WMO code set used by contract.",
        "Added assertion that every known code has a non-generic label (no fallback 'Weather').",
        "Keeps provider weather taxonomy coverage explicit and prevents silent mapping regressions."
      ]
    },
    {
      "id": "patch_2026-02-06_profiles_board_parity_and_currency_bidi_cleanup",
      "date": "2026-02-06",
      "title": "Profiles board edit-mode parity pass + currency bidi/symbol placement cleanup",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/pinned_mini_hero_readout.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/lib/features/dashboard/widgets/profiles_board_screen.dart",
        "app/unitana/test/dashboard_devtools_weather_menu_hardening_test.dart",
        "app/unitana/test/dashboard_edit_drag_handle_hit_testing_test.dart",
        "app/unitana/test/dashboard_reorder_persistence_breakpoints_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Profiles board now uses unified edit controls (`Manage` to enter, `X`/`✔` to exit) and keeps per-tile drag/edit/delete affordances in edit mode.",
        "Added additional `+` profile slots to keep grid behavior closer to dashboard tile surfaces.",
        "Dashboard menu label normalized to `Edit Widgets` for copy consistency.",
        "Currency text rendering now isolates LTR tokens and applies suffix placement for Arabic-script currency families to prevent mixed-direction reorder defects (example IQD/AED class).",
        "Verified full gates green after this pass: `dart format .`, `flutter analyze`, `flutter test`."
      ]
    },
    {
      "id": "patch_2026-02-06_startup_profile_recovery_and_wizard_gate",
      "date": "2026-02-06",
      "title": "Startup recovery for incomplete active profile + wizard gate hardening",
      "files_changed": [
        "app/unitana/lib/app/app.dart",
        "app/unitana/lib/app/app_state.dart",
        "app/unitana/test/profile_switching_persistence_test.dart",
        "app/unitana/test/startup_profile_recovery_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Resolved restart defect where an incomplete active draft profile could force returning users into first-run despite existing complete profiles.",
        "On load, app-state now auto-reactivates a setup-complete profile when active profile is incomplete and a valid fallback exists.",
        "Added startup regression coverage for fallback activation and persisted active-profile-id restoration.",
        "Updated profile switching persistence test to seed profile_1 as setup-complete so persistence assertions reflect intended user flow."
      ]
    },
    {
      "id": "patch_2026-02-06_dashboard_profile_edit_surface_alignment",
      "date": "2026-02-06",
      "title": "Dashboard/profile edit-mode visual parity and spacing hardening",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/profiles_board_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/unitana_tile.dart",
        "app/unitana/test/dashboard_edit_drag_handle_hit_testing_test.dart",
        "app/unitana/test/dashboard_reorder_persistence_breakpoints_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Profile tiles now use a compact two-row edit header (title row + centered icon row) to reduce crowding on long names.",
        "Dashboard edit tiles now mirror profile-board iconography and centered icon-row placement for drag/edit/delete actions.",
        "Removed dashboard 'Edit mode' footer pill in edit state to reclaim space and improve visual hierarchy.",
        "Adjusted edit-mode value typography (smaller/lower with more vertical spacing) to avoid icon overlap and improve scanability."
      ]
    },
    {
      "id": "patch_2026-02-06_packd_restore_gate_and_time_repurpose_sequencing",
      "date": "2026-02-06",
      "title": "Pack D restore preflight tooling + Time-tool repurpose sequencing",
      "files_changed": [
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
        "docs/ai/reference/PACK_D_RESTORE_BACKUP_STRATEGY.md",
        "docs/ai/reference/TIME_TOOL_REPURPOSE_PLAN.md",
        "tools/create_restore_point.sh"
      ],
      "notes": [
        "Added mandatory restore/backout runbook and helper script for any destructive Pack D cleanup/consolidation work.",
        "Added explicit Time-tool transition plan from interim 12h/24h conversion to timezone/delta-first behavior."
      ]
    },
    {
      "id": "patch_2026-02-06_table_tools_ux_model_and_packf_lock",
      "date": "2026-02-06",
      "title": "Pack F table-tools UX model and sequencing lock",
      "files_changed": [
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
        "docs/ai/reference/LOOKUP_TABLE_TOOLS_UX_PATTERN.md"
      ],
      "notes": [
        "Added dedicated lookup-table UX contract for standards-style tools (paper/shoe/mattress sizes) so they are not forced into generic Convert modal behavior.",
        "Locked Pack F sequencing: paper sizes first, then shoe sizes, then mattress sizes on shared table-tool framework."
      ]
    },
    {
      "id": "patch_2026-02-06_destructive_confirmation_surface_unification",
      "date": "2026-02-06",
      "title": "Unify destructive confirmations between dashboard widgets and profiles board",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/destructive_confirmation_sheet.dart",
        "app/unitana/lib/features/dashboard/widgets/profiles_board_screen.dart",
        "app/unitana/test/profile_delete_confirmation_consistency_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/reference/CONFIRMATION_DIALOG_POLICY.md"
      ],
      "notes": [
        "Added shared destructive bottom-sheet helper and wired profile delete + dashboard tile remove to the same interaction pattern.",
        "Replaced profile delete AlertDialog with bottom-sheet confirmation for UX parity.",
        "Added regression test verifying profile delete uses BottomSheet (not AlertDialog)."
      ]
    },
    {
      "id": "patch_2026-02-06_packi_tutorial_overlay_backlog_addition",
      "date": "2026-02-06",
      "title": "Add skippable playful tutorial overlay as Pack I backlog item",
      "files_changed": [
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Added Pack I for a near-finalization tutorial overlay with skip support.",
        "Scoped tutorial topics include wizard place/save steps, hero pill toggles, tools menu, add-widget flow, and settings entry.",
        "Documented timing guard to avoid churn before UI contracts stabilize."
      ]
    },
    {
      "id": "patch_2026-02-06_packj_weather_tool_redesign_backlog_lock",
      "date": "2026-02-06",
      "title": "Add Pack J weather redesign track with mandatory option-deliberation gate",
      "files_changed": [
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Added Pack J to backlog: Weather tool must be fully redesigned and not left as generic converter UX.",
        "Locked a decision gate requiring an option-comparison pitch (utility converter vs rich weather cockpit) before implementation.",
        "Updated handoff/next prompt so future execution explicitly includes Weather redesign planning."
      ]
    },
    {
      "id": "patch_2026-02-06_destructive_confirmation_rollout_completion",
      "date": "2026-02-06",
      "title": "Complete destructive-confirmation rollout for reset and clear-history flows",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/dashboard_reset_defaults_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Migrated dashboard reset-default confirmation to shared destructive bottom-sheet helper.",
        "Migrated tool modal clear-history confirmation to shared destructive bottom-sheet helper.",
        "Expanded reset-default regression test to assert BottomSheet and no AlertDialog."
      ]
    },
    {
      "id": "patch_2026-02-06_profiles_jiggle_parity_and_hero_wind_sun_typography_alignment",
      "date": "2026-02-06",
      "title": "Profiles jiggle parity + hero wind/sun typography/alignment + edit-mode value spacing polish",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/lib/features/dashboard/widgets/profiles_board_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/unitana_tile.dart",
        "app/unitana/test/dashboard_places_hero_v2_test.dart",
        "app/unitana/test/dashboard_wind_gust_sun_contract_test.dart",
        "app/unitana/test/profile_delete_confirmation_consistency_test.dart",
        "app/unitana/test/profile_switcher_edit_profile_flow_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Profiles board now has edit-mode wiggle animation parity with dashboard while keeping long-press drag reorder behavior.",
        "Dashboard edit tiles now position value content lower in edit mode for better icon-row breathing room.",
        "Sunrise/Sunset and Wind/Gust details typography is slightly reduced for better hero text hierarchy.",
        "Wind/Gust value rows now center-align under the title for visual consistency."
      ]
    },
    {
      "id": "patch_2026-02-06_profiles_drag_handle_parity_and_wind_row_centering_fix",
      "date": "2026-02-06",
      "title": "Profiles drag-handle parity with dashboard + wind-row centering fix",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/places_hero_v2.dart",
        "app/unitana/lib/features/dashboard/widgets/profiles_board_screen.dart",
        "app/unitana/test/profile_switcher_switch_profile_flow_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Wind/Gust detail rows now use centered cross-axis layout so values read visually centered under the title.",
        "Profiles board no longer depends on long-press tile drag; drag handle is now directly draggable like dashboard edit mode.",
        "Added regression coverage verifying reorder via profile drag handle interaction."
      ]
    },
    {
      "id": "patch_2026-02-06_profiles_empty_slot_swap_and_drag_feedback_constraint_fix",
      "date": "2026-02-06",
      "title": "Profiles edit-mode empty-slot swap behavior + unbounded drag-feedback layout fix",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/profiles_board_screen.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Profiles board edit mode now maintains explicit slot state (profiles + empty add slots) and supports swapping when dragging onto a `+` slot.",
        "Dropping profile on empty `+` slot now leaves a `+` where the profile was, matching requested swap semantics.",
        "Fixed unbounded-height RenderFlex crash during profile drag by constraining drag feedback dimensions."
      ]
    },
    {
      "id": "patch_2026-02-06_profiles_board_minimum_ten_cells",
      "date": "2026-02-06",
      "title": "Profiles board minimum total cell count set to 10",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/profiles_board_screen.dart",
        "app/unitana/test/profile_switcher_switch_profile_flow_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Profiles board add-slot policy now enforces a minimum of 10 total cells (profiles + `+` slots), effectively adding one extra 1x2 row when needed.",
        "Regression test now validates total grid childCount is 10 via GridView delegate childCount (robust under lazy building)."
      ]
    },
    {
      "id": "patch_2026-02-06_feedback_matrix_and_high_context_megaslice_handoff_refresh",
      "date": "2026-02-06",
      "title": "Create save/update feedback matrix and refresh high-context mega-slice handoff docs",
      "files_changed": [
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md",
        "docs/ai/reference/PACK_F_MEGA_SLICE_TOOLS_EXPANSION_PLAN.md",
        "docs/ai/reference/SAVE_UPDATE_FEEDBACK_MATRIX.md"
      ],
      "notes": [
        "Added centralized save/update feedback matrix documenting current behavior, target behavior, copy contract, and rollout order.",
        "Added Pack F mega-slice execution plan for long-run tools expansion, weather redesign baseline, size-matrix tooling, and default-reset hardening.",
        "Rewrote NEXT_CHAT_PROMPT for a fresh high-context window aligned to the mega-slice mission."
      ]
    },
    {
      "id": "patch_2026-02-06_design_only_decision_matrix_lock",
      "date": "2026-02-06",
      "title": "Lock design-only decision matrix for tools architecture, Time split, visual system, and weather clarity",
      "files_changed": [
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Recorded tool architecture classification rules (dedicated/template/alias/defer) and duplicate strategy.",
        "Selected Time-family Option B with explicit IA contract, defaults, swap behavior, history boundaries, and live refresh rules.",
        "Locked shared visual-system contract for tool surfaces and marquee-adjacent UI plus weather semantics/refresh policy.",
        "Shifted next prompt from design-only discovery to implementation-first Pack F execution against approved contracts."
      ]
    },
    {
      "id": "patch_2026-02-06_packf_contracted_implementation_time_weather_phase1",
      "date": "2026-02-06",
      "title": "Implement Pack F contracted phase 1: Time-family split, timezone converter alias, and weather clarity refresh semantics",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/widgets/weather_summary_bottom_sheet.dart",
        "app/unitana/test/time_tool_modal_interaction_test.dart",
        "app/unitana/test/toolpicker_activation_bundle_test.dart",
        "app/unitana/test/weather_summary_tile_open_smoke_test.dart",
        "app/unitana/test/temperature_tool_modal_interaction_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Added a distinct `time_zone_converter` tool surface while keeping Time as the home/destination live clock + delta workspace.",
        "Routed `timezone_lookup` picker alias into `Time Zone Converter`; retained world-clock/jet-lag aliases into Time.",
        "Added explicit converter behavior with local datetime input, conversion history, and timezone-swap input rebasing.",
        "Added minute-tick live updates for Time-family views.",
        "Weather summary now exposes freshness state, stale indicator copy, and clearer AQI/Pollen user semantics.",
        "Tool modal title handling now supports two-line ellipsis for long names.",
        "Updated regression tests and stabilized a brittle temperature clipboard assertion under scroll/lazy-build conditions."
      ]
    },
    {
      "id": "patch_2026-02-06_packf_architecture_matrix_enforcement_phase2",
      "date": "2026-02-06",
      "title": "Implement Pack F contracted phase 2: enforce deferred-tool architecture matrix in code + picker",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/test/tool_registry_architecture_matrix_test.dart",
        "app/unitana/test/toolpicker_deferred_badge_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Added explicit tool architecture metadata in registry (`surfaceType`, `aliasTargetToolId`, `deferReason`).",
        "Encoded all remaining disabled tools as `deferred` with rationale in code.",
        "Updated picker disabled-state UX to show `Deferred` and reason text instead of generic `Soon` messaging.",
        "Added regression tests to lock deferred tool set/alias targets and ensure deferred picker rows show rationale while remaining non-launchable."
      ]
    },
    {
      "id": "patch_2026-02-06_packc_currency_stale_visibility_followup",
      "date": "2026-02-06",
      "title": "Expose currency stale/retry health signals in Currency modal and add regression coverage",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/currency_tool_stale_status_banner_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Currency modal now shows stale/error/backoff status banner when rates are stale or refresh recently failed.",
        "Dashboard launch paths pass currency stale/retry/error state into the modal from DashboardLiveDataController.",
        "Added widget test to lock stale-status banner visibility behavior."
      ]
    },
    {
      "id": "patch_2026-02-06_packc_currency_retry_action_followup",
      "date": "2026-02-06",
      "title": "Add explicit currency retry affordance in stale-status banner",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/currency_tool_stale_status_banner_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Added `Retry rates` action in Currency modal when stale data can be retried immediately.",
        "Wired retry callback through dashboard and board launch paths to trigger live-data refresh.",
        "Extended currency stale-status test coverage to assert retry action visibility and invocation."
      ]
    },
    {
      "id": "patch_2026-02-06_packf_visual_guardrail_goldens_phase3",
      "date": "2026-02-06",
      "title": "Add opt-in visual guardrail goldens for Time-family, weather freshness states, and modal title overflow",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/dashboard_live_data.dart",
        "app/unitana/test/goldens/tool_surface_contract_goldens_test.dart",
        "app/unitana/test/goldens/README.md",
        "app/unitana/test/goldens/goldens/tool_time_from_zone_tile.png",
        "app/unitana/test/goldens/goldens/tool_time_to_zone_tile.png",
        "app/unitana/test/goldens/goldens/tool_time_zone_converter_card.png",
        "app/unitana/test/goldens/goldens/tool_modal_long_title_overflow.png",
        "app/unitana/test/goldens/goldens/weather_summary_stale.png",
        "app/unitana/test/goldens/goldens/weather_summary_live.png",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Added a targeted opt-in golden suite covering Time base zone selector tiles, Time Zone Converter interaction card, weather stale/live sheet states, and modal long-title overflow behavior.",
        "Generated baseline PNG assets for the new suite under test/goldens/goldens so visual guardrails are immediately usable.",
        "Added @visibleForTesting `debugSetLastRefreshedAt` on DashboardLiveDataController to make weather stale/live golden states deterministic without async timer waits.",
        "Kept goldens opt-in only by reusing existing `UNITANA_GOLDENS=1` gating contract and documented update command in the goldens README."
      ]
    },
    {
      "id": "patch_2026-02-06_packf_lookup_matrix_table_refresh_phase4",
      "date": "2026-02-06",
      "title": "Refresh lookup tools Nearby section into Dracula-styled matrix table with selected-row focus",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/mattress_sizes_matrix_interaction_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Replaced lookup `Nearby` list with a `Size Matrix` table for lookup tools (shoe/paper/mattress) using stronger Dracula hierarchy and explicit Size/From/To columns.",
        "Highlighted the active row and kept it in proximity context (neighbors above/below when available).",
        "Enabled value-cell tap-to-copy and size-label tap-to-reselect for low-friction lookup iteration.",
        "Added `mattress_sizes_matrix_interaction_test.dart` to lock matrix presence and row-reselection result updates."
      ]
    },
    {
      "id": "patch_2026-02-06_deferred_execution_matrix_and_lookup_matrix_hardening_phase5",
      "date": "2026-02-06",
      "title": "Add deferred-tools execution matrix and harden lookup matrix interaction contracts",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/mattress_sizes_matrix_interaction_test.dart",
        "docs/ai/reference/DEFERRED_TOOLS_EXECUTION_MATRIX.md",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Introduced a concrete deferred-tools execution matrix with prerequisite contracts, proposed slices, and recommended activation order.",
        "Lookup tools now use a Dracula-styled Size Matrix section instead of plain Nearby rows, with explicit Size/From/To columns and selected-row emphasis.",
        "Value cells support tap-to-copy; size labels support tap-to-reselect and update the active result context.",
        "Added interaction regression coverage for mattress lookup matrix rendering and reselection behavior."
      ]
    },
    {
      "id": "patch_2026-02-06_packf_tip_helper_activation_phase6",
      "date": "2026-02-06",
      "title": "Activate Tip Helper as a dedicated tool surface and complete deferred-state follow-through",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/canonical_tools.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/models/tool_lens_map.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/tool_registry_architecture_matrix_test.dart",
        "app/unitana/test/toolpicker_deferred_badge_test.dart",
        "app/unitana/test/toolpicker_activation_bundle_test.dart",
        "app/unitana/test/tip_helper_modal_interaction_test.dart",
        "docs/ai/reference/DEFERRED_TOOLS_EXECUTION_MATRIX.md",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Activated `tip_helper` in the tool registry as an enabled dedicated surface and added canonical + tool-definition coverage.",
        "Implemented dedicated Tip Helper modal interactions: locale-aware presets, split control, rounding mode, and explicit tip/total/per-person breakdown lines.",
        "Mapped Tip Helper into `money_shopping` lens to satisfy canonical discoverability constraints.",
        "Updated deferred-matrix expectations and picker deferred-badge tests to remove Tip Helper from deferred status.",
        "Added dedicated interaction regression test (`tip_helper_modal_interaction_test.dart`) and activation coverage from picker search."
      ]
    },
    {
      "id": "patch_2026-02-06_packf_tax_vat_activation_phase7_weather_compact_followup",
      "date": "2026-02-06",
      "title": "Activate Sales Tax / VAT Helper and compact weather sheet with dual-context readability",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/widgets/weather_summary_bottom_sheet.dart",
        "app/unitana/test/tool_registry_architecture_matrix_test.dart",
        "app/unitana/test/toolpicker_activation_bundle_test.dart",
        "app/unitana/test/toolpicker_deferred_badge_test.dart",
        "app/unitana/test/tax_vat_helper_modal_interaction_test.dart",
        "app/unitana/test/weather_summary_tile_open_smoke_test.dart",
        "docs/ai/reference/DEFERRED_TOOLS_EXECUTION_MATRIX.md",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Activated `tax_vat_helper` as an enabled dedicated tool surface and removed it from deferred registry expectations.",
        "Implemented dedicated tax/VAT modal behavior with add-on vs inclusive modes, locale-aware presets, and subtotal/tax/total breakdown.",
        "Updated picker activation and deferred-badge tests to reflect tax/VAT activation and keep deferred assertions on remaining tools.",
        "Removed redundant weather refresh explainer copy and live-status line; freshness now reads via `Updated ...` with stale suffix when needed.",
        "Applied compact spacing micro-pass to the weather sheet and added dual-context readability for sunrise/sunset (12h+24h) and wind/gust (km/h+mph)."
      ]
    },
    {
      "id": "patch_2026-02-06_packf_unit_price_activation_phase8_and_followup_scope",
      "date": "2026-02-06",
      "title": "Activate Unit Price Helper and scope Jet Lag/Body Weight/Height follow-up contracts",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/tool_registry_architecture_matrix_test.dart",
        "app/unitana/test/toolpicker_activation_bundle_test.dart",
        "app/unitana/test/toolpicker_deferred_badge_test.dart",
        "app/unitana/test/unit_price_helper_modal_interaction_test.dart",
        "docs/ai/reference/DEFERRED_TOOLS_EXECUTION_MATRIX.md",
        "docs/ai/reference/PACK_F_SCOPE_FOLLOWUPS_JETLAG_WEIGHT_HEIGHT.md",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Activated `unit_price_helper` as an enabled dedicated tool surface and removed it from deferred expectations.",
        "Implemented Unit Price helper modal with Product A/B inputs, quantity-unit selection, normalized per-100/per-base outputs, and compare summary.",
        "Updated activation and deferred-badge tests so deferred assertions now target remaining tools (for example `clothing_sizes`).",
        "Improved imperial Height parsing to accept `6.4` shorthand as `6 ft 4 in` while preserving rich freeform parsing.",
        "Added scope follow-up contract doc for Jet Lag Delta dedicated workflow, Body Weight preset differentiation, and Height two-field UX planning."
      ]
    },
    {
      "id": "patch_2026-02-06_packf_jet_lag_delta_dedicated_phase9",
      "date": "2026-02-06",
      "title": "Promote Jet Lag Delta to dedicated surface with planner contract",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/dashboard_board.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/tool_registry_architecture_matrix_test.dart",
        "app/unitana/test/toolpicker_activation_bundle_test.dart",
        "app/unitana/test/jet_lag_delta_modal_interaction_test.dart",
        "docs/ai/reference/PACK_F_SCOPE_FOLLOWUPS_JETLAG_WEIGHT_HEIGHT.md",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md"
      ],
      "notes": [
        "Changed `jet_lag_delta` from alias metadata to dedicated surface metadata in registry architecture.",
        "Added explicit ToolDefinition for `jet_lag_delta` and mapped picker routing to that definition instead of generic Time.",
        "Added dedicated planner card in Time-family UI for Jet Lag Delta with adjustment window, direction-aware guidance, and overlap hints.",
        "Kept Time and Time Zone Converter behavior intact to reduce regression risk.",
        "Added dedicated interaction regression coverage and updated activation/architecture matrix expectations."
      ]
    },
    {
      "id": "patch_2026-02-07_packh_full_completion_language_settings_and_locale_persistence",
      "date": "2026-02-07",
      "title": "Finish Pack H with Settings language picker, persisted locale selection, and ARB/runtime contract closure",
      "files_changed": [
        "app/unitana/lib/app/storage.dart",
        "app/unitana/lib/app/app_state.dart",
        "app/unitana/lib/app/app.dart",
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_copy.dart",
        "app/unitana/lib/l10n/localization_seed.dart",
        "app/unitana/lib/l10n/localization_seed_es.dart",
        "app/unitana/lib/l10n/arb/app_en.arb",
        "app/unitana/lib/l10n/arb/app_es.arb",
        "app/unitana/test/dashboard_language_settings_test.dart",
        "app/unitana/test/app_localization_scaffold_test.dart",
        "app/unitana/test/dashboard_localizations_runtime_test.dart",
        "app/unitana/test/localization_seed_contract_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Added persisted language preference key (`preferred_language_code_v1`) with deterministic normalization (`system`, `en`, `es`) and reset behavior in app state/storage.",
        "Wired app-level locale switching through `MaterialApp.locale` with supported locales `[en, es]` while preserving system-default behavior (`null` locale).",
        "Replaced Settings language placeholder with a functional bottom sheet selector and persistence feedback path.",
        "Extended localization seed/runtime catalogs and regenerated ARBs for new settings-language keys.",
        "Added/updated regression coverage to lock locale persistence, runtime lookup behavior, and seed key contracts.",
        "Validated full gates (`dart format .`, `flutter analyze`, `flutter test`) with no regressions."
      ]
    },
    {
      "id": "patch_2026-02-07_packf_energy_activation_and_modal_typography_consistency",
      "date": "2026-02-07",
      "title": "Activate Energy converter and normalize converter units-row typography consistency",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/canonical_tools.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/models/tool_lens_map.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/tool_modal_units_typography_consistency_test.dart",
        "app/unitana/test/tool_registry_architecture_matrix_test.dart",
        "app/unitana/test/toolpicker_activation_bundle_test.dart",
        "docs/ai/reference/DEFERRED_TOOLS_EXECUTION_MATRIX.md",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Activated `energy` in registry + tool definitions as an enabled configurable converter tool in Health & Fitness.",
        "Added canonical converter wiring and multi-unit conversion support for `kcal` and `kJ` with deterministic defaults, swapping, and history/edit suffix parsing.",
        "Replaced converter units-row `FittedBox` scaling with horizontal scroll handling to keep typography size consistent across tools with short and long unit labels.",
        "Added regression tests for units-row typography consistency (Speed vs Distance) and for `energy` activation in registry/picker contracts.",
        "Updated deferred-tools execution matrix to mark `energy` as activated and reordered remaining deferred recommendations.",
        "Validated full gates (`dart format .`, `flutter analyze`, `flutter test`) with no regressions."
      ]
    },
    {
      "id": "patch_2026-02-07_packf_pace_activation_and_units_row_fit_hardening",
      "date": "2026-02-07",
      "title": "Activate Pace converter and harden units-row fit policy for consistency without tap regressions",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/canonical_tools.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/models/tool_lens_map.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/pace_tool_modal_interaction_test.dart",
        "app/unitana/test/tool_registry_architecture_matrix_test.dart",
        "app/unitana/test/toolpicker_activation_bundle_test.dart",
        "docs/ai/reference/DEFERRED_TOOLS_EXECUTION_MATRIX.md",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Activated `pace` in registry + tool definitions as an enabled configurable converter tool in Health & Fitness.",
        "Added canonical pace converter support (`min/km ↔ min/mi`) with deterministic parsing for `mm:ss`, `XmYs`, and decimal-minute inputs.",
        "Extended modal unit handling for pace labels/suffix stripping and preserved converter interaction contracts (swap/history/edit).",
        "Refined units-row fit policy: plain-text unit rows keep consistent typography behavior, while interactive unit-pill rows retain fit-safe behavior to avoid narrow-layout overflow and tap misses.",
        "Added regression tests for pace modal interaction and picker/registry activation contracts.",
        "Updated deferred-tools execution matrix to mark both `energy` and `pace` as activated.",
        "Validated full gates (`dart format .`, `flutter analyze`, `flutter test`) with no regressions."
      ]
    },
    {
      "id": "patch_2026-02-07_packf_cups_grams_estimates_activation_lookup_matrix",
      "date": "2026-02-07",
      "title": "Activate Cups↔Grams estimates as lookup matrix surface with deterministic ingredient contracts",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/canonical_tools.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/models/tool_lens_map.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/cups_grams_estimates_matrix_interaction_test.dart",
        "app/unitana/test/tool_registry_architecture_matrix_test.dart",
        "app/unitana/test/toolpicker_activation_bundle_test.dart",
        "docs/ai/reference/DEFERRED_TOOLS_EXECUTION_MATRIX.md",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Activated `cups_grams_estimates` in registry + tool definitions as an enabled lookup-style tool surface in Food & Cooking.",
        "Wired cups/grams into the shared lookup matrix flow with deterministic systems (`Volume`, `Weight`) and core ingredient rows (for example flour, sugar, butter, rice).",
        "Added explicit approximation notes for ingredient density variance and packed-measure assumptions.",
        "Expanded activation and interaction coverage with dedicated matrix copy/reselect test plus registry/picker contract updates.",
        "Updated deferred-tools matrix to mark `energy`, `pace`, and `cups_grams_estimates` as activated.",
        "Validated full gates (`dart format .`, `flutter analyze`, `flutter test`) with no regressions."
      ]
    },
    {
      "id": "patch_2026-02-07_packf_hydration_activation_non_medical_helper",
      "date": "2026-02-07",
      "title": "Activate Hydration as dedicated non-medical helper with guardrail copy and deterministic estimates",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/canonical_tools.dart",
        "app/unitana/lib/features/dashboard/models/tool_definitions.dart",
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/models/tool_lens_map.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/hydration_tool_modal_interaction_test.dart",
        "app/unitana/test/tool_registry_architecture_matrix_test.dart",
        "app/unitana/test/toolpicker_activation_bundle_test.dart",
        "docs/ai/reference/DEFERRED_TOOLS_EXECUTION_MATRIX.md",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Activated `hydration` in registry + tool definitions as a dedicated Health & Fitness helper surface.",
        "Added hydration helper workflow with deterministic inputs (`weight`, `exercise minutes`, `climate`) and output (`L` + `fl oz`) in the modal.",
        "Included explicit non-medical guardrail copy in the result surface and kept behavior deterministic without provider dependencies.",
        "Expanded activation and interaction coverage with dedicated hydration modal test plus registry/picker contract updates.",
        "Deferred-tools matrix now narrows to `clothing_sizes` only, pending quality-bar/uncertainty policy decision.",
        "Validated full gates (`dart format .`, `flutter analyze`, `flutter test`) with no regressions."
      ]
    }
  ],
  "project": {
    "docs_root": "docs/",
    "name": "Unitana",
    "primary_app_path": "app/unitana/",
    "repo_root": "unitana/",
    "tagline": "travel-first decoder ring; dual reality side-by-side"
  },
  "schema_version": "1.0",
  "last_patch_id": "patch_2026-02-08_xl_unit3_packg_checklist_packbc_closure_proof",
  "last_patch_date": "2026-02-08",
  "patch_history": [
    {
      "id": "patch_2026-02-08_xl_unit3_packg_checklist_packbc_closure_proof",
      "date": "2026-02-08",
      "title": "XL Unit 3: Pack G checklist artifact plus Pack B/C closure-proof contract expansion",
      "files_changed": [
        "app/unitana/test/dashboard_live_data_refresh_fallback_test.dart",
        "app/unitana/test/dashboard_currency_retry_cache_semantics_test.dart",
        "docs/ai/reference/PACK_G_RELEASE_CHECKLIST_XL3.md",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Added Pack G release checklist/signoff artifact with deterministic references to compliance/accessibility/reliability guardrails.",
        "Expanded Pack B proof coverage with mixed success/fallback per-place refresh behavior while preserving truthful `lastRefreshedAt` semantics.",
        "Expanded Pack C proof coverage with multi-currency outage stability assertions that lock reuse of last stable rates under refresh failures.",
        "Aligned backlog statuses and next-slice planning after closure-proof expansion."
      ]
    },
    {
      "id": "patch_2026-02-08_xl_unit2_packg_compliance_settings_about_licenses",
      "date": "2026-02-08",
      "title": "XL Unit 2: ship Settings About/Licenses compliance surface and docs consistency follow-through",
      "files_changed": [
        "app/unitana/lib/features/dashboard/dashboard_screen.dart",
        "app/unitana/lib/features/dashboard/models/dashboard_copy.dart",
        "app/unitana/lib/l10n/localization_seed.dart",
        "app/unitana/lib/l10n/localization_seed_es.dart",
        "app/unitana/lib/l10n/arb/app_en.arb",
        "app/unitana/lib/l10n/arb/app_es.arb",
        "app/unitana/test/dashboard_language_settings_test.dart",
        "app/unitana/test/dashboard_settings_about_licenses_test.dart",
        "app/unitana/test/dashboard_localizations_runtime_test.dart",
        "app/unitana/test/localization_seed_contract_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Added dashboard->settings->about/licenses discoverability and deterministic interaction keys (`settings_option_about`, `settings_option_licenses`).",
        "Added localized/fallback-safe copy for settings/about/licenses surfaces across DashboardCopy, seeds, and ARB catalogs.",
        "Expanded regression coverage to lock About/Licenses entry-point behavior plus localization key/runtime contracts.",
        "Advanced Pack D docs consistency by aligning backlog state, handoff status, and next prompt direction."
      ]
    },
    {
      "id": "patch_2026-02-08_xl_unit1_backlog_status_normalization",
      "date": "2026-02-08",
      "title": "XL Unit 1: backlog status normalization from local code scan evidence",
      "files_changed": [
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Added explicit per-pack status metadata (`done`, `in_progress`, `planned`, `closed_with_defer`, `icebox`) to backlog entries.",
        "Normalized current-slice narrative to mark XL Unit 1 complete and target XL Unit 2 (Pack G + Pack D combined closure).",
        "Marked A/H/M/N as done and F as closed-with-defer based on local code/test/doc evidence."
      ]
    },
    {
      "id": "patch_2026-02-08_packg_followup_weather_semantics_fit_contracts",
      "date": "2026-02-08",
      "title": "Pack G follow-up: weather high/low fit tightening and forecast semantics contract lock",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/weather_summary_bottom_sheet.dart",
        "app/unitana/test/weather_summary_narrow_layout_smoke_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Reduced high/low badge temperature typography slightly to avoid clipping/truncation in narrow weather card banners.",
        "Added deterministic forecast chart semantics container key and localized label wiring using forecast mode + units legend copy contracts.",
        "Extended narrow weather regression to validate mode-pill semantics selection state, swap tooltip contract, and chart semantics key presence while preserving overflow-safe behavior.",
        "Validated full gates (`dart format .`, `flutter analyze`, `flutter test`) with no regressions."
      ]
    },
    {
      "id": "patch_2026-02-08_packf_lock_and_packj_weather_compare_kickoff",
      "date": "2026-02-08",
      "title": "Close Pack F with clothing-size defer lock and kickoff Pack J weather comparison baseline",
      "files_changed": [
        "app/unitana/lib/features/dashboard/models/tool_registry.dart",
        "app/unitana/lib/features/dashboard/widgets/weather_summary_bottom_sheet.dart",
        "app/unitana/test/tool_registry_architecture_matrix_test.dart",
        "app/unitana/test/weather_summary_tile_open_smoke_test.dart",
        "docs/ai/reference/DEFERRED_TOOLS_EXECUTION_MATRIX.md",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Kept `clothing_sizes` deferred and upgraded defer reason into explicit activation lock criteria instead of vague quality wording.",
        "Extended registry architecture test coverage to enforce the new defer-lock wording contract for clothing sizes.",
        "Started Pack J weather redesign execution by adding an at-a-glance weather comparison strip (time delta + temperature delta) ahead of destination/home cards.",
        "Added weather-sheet regression assertion coverage for the new comparison strip keys while preserving existing open/render contracts.",
        "Updated handoff/context/prompt docs to mark Pack F closure and shift active execution to Pack J weather redesign phase 2."
      ]
    },
    {
      "id": "patch_2026-02-08_packj_phase2_travel_readiness_and_units_row_fix",
      "date": "2026-02-08",
      "title": "Pack J phase 2 weather cockpit expansion plus tool-modal units row stability fix",
      "files_changed": [
        "app/unitana/lib/features/dashboard/widgets/weather_summary_bottom_sheet.dart",
        "app/unitana/lib/features/dashboard/widgets/tool_modal_bottom_sheet.dart",
        "app/unitana/test/weather_summary_tile_open_smoke_test.dart",
        "app/unitana/test/weather_summary_close_button_smoke_test.dart",
        "app/unitana/test/toolpicker_activation_bundle_test.dart",
        "app/unitana/test/tool_modal_units_typography_consistency_test.dart",
        "docs/ai/context_db.json",
        "docs/ai/handoff/CURRENT_HANDOFF.md",
        "docs/ai/prompts/NEXT_CHAT_PROMPT.md"
      ],
      "notes": [
        "Added a new Travel readiness cockpit section to the weather sheet with per-place local clock/date/daylight indicators and deterministic call-overlap quality labels.",
        "Kept hierarchy explicit: At a glance comparison first, then Travel readiness cockpit, then destination/home weather cards.",
        "Hardened small-width behavior by fixing call-overlap row constraints and adjusting smoke tests for scroll-dependent sections.",
        "Fixed converter units-row layout so swap no longer consumes a full expanded column, preventing unit-label clipping in tool modals.",
        "Validated focused and full gates (`dart format .`, `flutter analyze`, `flutter test`) with no regressions."
      ]
    }
  ]
}
