{
  "project": "Unitana",
  "date": "2025-12-27",
  "high_level": {
    "north_star": "A travel-first decoder ring that teaches by repeated dual-reality exposure.",
    "operator_mode": "User runs commands; assistant provides precise, small, reversible steps."
  },
  "stability_lessons": [
    {
      "theme": "Small-tile layout budgets",
      "symptom": "RenderFlex overflowed by N pixels on the bottom",
      "root_cause": "Column children taller than a fixed tile height (often ~147x147 on small iPhones).",
      "fix_pattern": [
        "Make secondary/footer/hint sections optional and omit when empty",
        "Use maxLines + ellipsis for title and value",
        "Introduce a compact mode keyed off constraints",
        "Keep placeholder tiles minimal until final copy is locked"
      ],
      "anti_patterns": [
        "Fixed vertical spacing assuming unlimited height",
        "Always-rendered footers/hints",
        "Using internal scroll views inside tiles"
      ]
    },
    {
      "theme": "Null safety",
      "symptom": "Null check operator used on a null value",
      "root_cause": "Force-unwrapping theme extensions or optional values in widget build.",
      "fix_pattern": [
        "Avoid `!` for theme extensions; provide safe fallbacks",
        "Treat optional copy as optional UI",
        "Fail closed: render a minimal tile instead of crashing"
      ]
    },
    {
      "theme": "Unicode and copy/paste brittleness",
      "symptom": "Symbols render inconsistently or break patches",
      "fix_pattern": [
        "Prefer \\u00B0 for degrees and \\u20AC for euro in source strings",
        "Keep currency symbols in a centralized formatter"
      ]
    },
    {
      "theme": "Widget API drift",
      "symptom": "flutter analyze fails with undefined identifiers, missing required named parameters, and nullable vs non-nullable argument mismatches.",
      "root_cause": "Refactor changed call sites, constructor signatures, and helper methods in different steps, introducing parameter drift and invented types not present in the model layer.",
      "fix_pattern": [
        "Freeze the public widget API while refactoring internals; change signatures only in a single coordinated pass.",
        "Do an import/type audit before referencing domain enums or models; verify the symbol exists in the repo.",
        "Make nullability explicit: either handle null locally or require non-null at the boundary, but do not mix.",
        "Run flutter analyze after each local refactor chunk; do not proceed when red.",
        "Add focused widget tests around the refactored surface before switching the dashboard to use it."
      ],
      "anti_patterns": [
        "Adding new named parameters without updating all call sites",
        "Referencing types that are not defined in the current codebase",
        "Using placeholder helper methods that are never implemented",
        "Duplicating named parameters in constructors or ButtonStyle"
      ]
    }
  ],
  "workflow": {
    "change_slicing": [
      "One feature or fix per patch",
      "Keep patches to a small set of files",
      "Always include verification commands"
    ],
    "verification": [
      "dart format .",
      "flutter analyze",
      "flutter run"
    ],
    "patching": {
      "preferred": "diff-based apply_patch edits",
      "avoid": "rewriting large files without necessity"
    }
  }
}
